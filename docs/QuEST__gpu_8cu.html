<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Quantum Exact Simulation Toolkit: QuEST_gpu.cu File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>QuEST_gpu.cu File Reference</h1>
<p>An implementation of the pure backend in .  
<a href="#_details">More...</a></p>
<code>#include &quot;../QuEST.h&quot;</code><br/>
<code>#include &quot;../QuEST_precision.h&quot;</code><br/>
<code>#include &quot;../mt19937ar.h&quot;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>

<p><a href="QuEST__gpu_8cu_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#aa57d77a0903e334e963c66ddc5ed3f53">REDUCE_SHARED_SIZE</a>&nbsp;&nbsp;&nbsp;512</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#aea20d173141544e6c5359955a1fbe997">copySharedReduceBlock</a> (qreal *arrayIn, qreal *reducedArray, int length)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a924ef2dbda6b733b4041270077c76ece">copyStateFromGPU</a> (<a class="el" href="structQureg.html">Qureg</a> qureg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a11448560006dd165128e404b54ebb2f7">copyStateToGPU</a> (<a class="el" href="structQureg.html">Qureg</a> qureg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a8ba2c3388dd64d9348c3b091852d36d4">createQuESTEnv</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create the QuEST execution environment.  <a href="#a8ba2c3388dd64d9348c3b091852d36d4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a7c14b7f97aac42f390383893e703841f">densmatr_addDensityMatrix</a> (<a class="el" href="structQureg.html">Qureg</a> combineQureg, qreal otherProb, <a class="el" href="structQureg.html">Qureg</a> otherQureg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ac12545f9573072f0f5f9b7dd08b2fbab">densmatr_addDensityMatrixKernel</a> (<a class="el" href="structQureg.html">Qureg</a> combineQureg, qreal otherProb, <a class="el" href="structQureg.html">Qureg</a> otherQureg, long long int numAmpsToVisit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">qreal&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#aa6c3f86010ad398f42b0577ea3bb5bcf">densmatr_calcFidelity</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, <a class="el" href="structQureg.html">Qureg</a> pureState)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a090901670793c53a1b08629712b2cdae">densmatr_calcFidelityKernel</a> (<a class="el" href="structQureg.html">Qureg</a> dens, <a class="el" href="structQureg.html">Qureg</a> vec, long long int dim, qreal *reducedArray)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">computes one term of (vec^*T) dens * vec  <a href="#a090901670793c53a1b08629712b2cdae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">qreal&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ad405e3fac20997043e0236b751e44270">densmatr_calcProbOfOutcome</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int measureQubit, int outcome)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">qreal&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ae45eefa65f4ecd37bab84fade7cf7f1f">densmatr_calcPurity</a> (<a class="el" href="structQureg.html">Qureg</a> qureg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Computes the trace of the density matrix squared.  <a href="#ae45eefa65f4ecd37bab84fade7cf7f1f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#afe005f9f69319901bb56c4d022359ad5">densmatr_calcPurityKernel</a> (qreal *vecReal, qreal *vecImag, long long int numAmpsToSum, qreal *reducedArray)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">qreal&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a6153547f245c05874161a105e9a2f02c">densmatr_calcTotalProb</a> (<a class="el" href="structQureg.html">Qureg</a> qureg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ab321af37fe3490253e12b7c70b8d2a98">densmatr_collapseToKnownProbOutcome</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int measureQubit, int outcome, qreal outcomeProb)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This involves finding |...i.  <a href="#ab321af37fe3490253e12b7c70b8d2a98"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#afc4dcedaf429d823f4da83d3521d8293">densmatr_collapseToKnownProbOutcomeKernel</a> (qreal outcomeProb, qreal *vecReal, qreal *vecImag, long long int numBasesToVisit, long long int part1, long long int part2, long long int part3, long long int rowBit, long long int colBit, long long int desired, long long int undesired)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Maps thread ID to a |..0.  <a href="#afc4dcedaf429d823f4da83d3521d8293"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">qreal&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#afbb044d76bf22d5c81a2a70a977f29bc">densmatr_findProbabilityOfZero</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int measureQubit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a3414d9307ecfd0caa2be560a00eb7c61">densmatr_findProbabilityOfZeroKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int measureQubit, qreal *reducedArray)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a20a155f53efc45c16803d7539c2c199d">densmatr_initClassicalState</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, long long int stateInd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a9f4bb112d5e95abb8e35bf051a02a06e">densmatr_initClassicalStateKernel</a> (long long int densityNumElems, qreal *densityReal, qreal *densityImag, long long int densityInd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ad5b2ac0b00afa495f385520b2c5fa839">densmatr_initPlusState</a> (<a class="el" href="structQureg.html">Qureg</a> qureg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a4cf98d55602d1138a2101c158095afdc">densmatr_initPlusStateKernel</a> (long long int stateVecSize, qreal probFactor, qreal *stateVecReal, qreal *stateVecImag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ae5ad68d054875913d0f7ec654840a9ec">densmatr_initPureState</a> (<a class="el" href="structQureg.html">Qureg</a> targetQureg, <a class="el" href="structQureg.html">Qureg</a> copyQureg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a664339e2afc50b0418a56adfc1bc512e">densmatr_initPureStateKernel</a> (long long int numPureAmps, qreal *targetVecReal, qreal *targetVecImag, qreal *copyVecReal, qreal *copyVecImag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a56b32228c24a7c4e1894d991ef4b6b99">densmatr_oneQubitDephase</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit, qreal dephase)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a30533aceb5c9a03be270633c8416965f">densmatr_oneQubitDephaseKernel</a> (qreal fac, qreal *vecReal, qreal *vecImag, long long int numAmpsToVisit, long long int part1, long long int part2, long long int part3, long long int colBit, long long int rowBit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Called once for every 4 amplitudes in density matrix Works by establishing the |..0.  <a href="#a30533aceb5c9a03be270633c8416965f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ae5bf84ca607e1484e0ddb5570726848d">densmatr_oneQubitDepolarise</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit, qreal depolLevel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a0a3a7bb274a939766fee5cbb5871398d">densmatr_oneQubitDepolariseKernel</a> (qreal depolLevel, qreal *vecReal, qreal *vecImag, long long int numAmpsToVisit, long long int part1, long long int part2, long long int part3, long long int bothBits)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Works like oneQubitDephase but modifies every other element, and elements are averaged in pairs.  <a href="#a0a3a7bb274a939766fee5cbb5871398d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a9dc44ff714f25796d82286ae5202fe7a">densmatr_twoQubitDephase</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, int qubit1, int qubit2, qreal dephase)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#afb969c7a2f5693c1a53c922f0ed88de9">densmatr_twoQubitDephaseKernel</a> (qreal fac, qreal *vecReal, qreal *vecImag, long long int numBackgroundStates, long long int numAmpsToVisit, long long int part1, long long int part2, long long int part3, long long int part4, long long int part5, long long int colBit1, long long int rowBit1, long long int colBit2, long long int rowBit2)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Called 12 times for every 16 amplitudes in density matrix Each sums from the |..0..0.  <a href="#afb969c7a2f5693c1a53c922f0ed88de9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#aa500e14a9ed1683f9c056f03f4c24cea">densmatr_twoQubitDepolarise</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, int qubit1, int qubit2, qreal depolLevel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a207113dd5e09aafbb9b435695cfcdc6e">densmatr_twoQubitDepolariseKernel</a> (qreal depolLevel, qreal *vecReal, qreal *vecImag, long long int numAmpsToVisit, long long int part1, long long int part2, long long int part3, long long int part4, long long int part5, long long int rowCol1, long long int rowCol2)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Called once for every 16 amplitudes.  <a href="#a207113dd5e09aafbb9b435695cfcdc6e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#aeff624226629d7063a8a776958a4f991">destroyQuESTEnv</a> (<a class="el" href="structQuESTEnv.html">QuESTEnv</a> env)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy the QuEST environment.  <a href="#aeff624226629d7063a8a776958a4f991"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static __device__ int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a6ffa51987d8ad8f6c0fc07fd3492277f">extractBit</a> (int locationOfBitFromRight, long long int theEncodedNumber)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a2d955c6e51067371eee69795532a2d62">getEnvironmentString</a> (<a class="el" href="structQuESTEnv.html">QuESTEnv</a> env, <a class="el" href="structQureg.html">Qureg</a> qureg, char str[200])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a112c74b3365bda6697813d9931b55377">getNumReductionLevels</a> (long long int numValuesToReduce, int numReducedPerLevel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a0aabd5ed69a74e5bc0b46a17af45c886">GPUExists</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__device__ __host__ unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a8ce1e311ea72b862a8757dc71082fbf3">log2Int</a> (unsigned int <a class="el" href="README_8md.html#a6a52a27535805eddc782c67f42c20c69">x</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__device__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ac82f3dbf68f877f57d4abbb72fae1254">reduceBlock</a> (qreal *arrayIn, qreal *reducedArray, int length)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#af8a14ae79c3fb2c0b5f6255cc37bebf9">reportQuESTEnv</a> (<a class="el" href="structQuESTEnv.html">QuESTEnv</a> env)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Report information about the QuEST environment.  <a href="#af8a14ae79c3fb2c0b5f6255cc37bebf9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a7ebd3198a198f4cd20840f64fd8b84d0">statevec_calcInnerProduct</a> (<a class="el" href="structQureg.html">Qureg</a> bra, <a class="el" href="structQureg.html">Qureg</a> ket)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Terrible code which unnecessarily individually computes and sums the real and imaginary components of the inner product, so as to not have to worry about keeping the sums separated during reduction.  <a href="#a7ebd3198a198f4cd20840f64fd8b84d0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a4f3c49fa4904bb120bbb6ae2e6395dfd">statevec_calcInnerProductKernel</a> (int getRealComp, qreal *vecReal1, qreal *vecImag1, qreal *vecReal2, qreal *vecImag2, long long int numTermsToSum, qreal *reducedArray)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">computes either a real or imag term in the inner product  <a href="#a4f3c49fa4904bb120bbb6ae2e6395dfd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">qreal&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ab33cdf01831c4545e51299178acf7f27">statevec_calcProbOfOutcome</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int measureQubit, int outcome)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">qreal&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ad65ad1b5ea6f30b0c6b4ffda96e1a8e6">statevec_calcTotalProb</a> (<a class="el" href="structQureg.html">Qureg</a> qureg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#aa4b77089145184d990848cd66993aa8b">statevec_cloneQureg</a> (<a class="el" href="structQureg.html">Qureg</a> targetQureg, <a class="el" href="structQureg.html">Qureg</a> copyQureg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">works for both statevectors and density matrices  <a href="#aa4b77089145184d990848cd66993aa8b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ae7f25bb40734e18a992403b17355893b">statevec_collapseToKnownProbOutcome</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int measureQubit, int outcome, qreal outcomeProb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a5d2202221eed63dc9b003d716a46e879">statevec_collapseToKnownProbOutcomeKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, int measureQubit, int outcome, qreal totalProbability)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a94ee4df9faba286ad7a5bc829ef5174d">statevec_compactUnitary</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit, <a class="el" href="structComplex.html">Complex</a> alpha, <a class="el" href="structComplex.html">Complex</a> beta)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a1338d7ca4e83bbb81da02aca456c53e6">statevec_compactUnitaryKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int rotQubit, <a class="el" href="structComplex.html">Complex</a> alpha, <a class="el" href="structComplex.html">Complex</a> beta)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ae6cecbad32a03416138b321cdc1a2c33">statevec_compareStates</a> (<a class="el" href="structQureg.html">Qureg</a> mq1, <a class="el" href="structQureg.html">Qureg</a> mq2, qreal precision)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a47b467a5445c7f15d1a8b0b2ec0ef2de">statevec_controlledCompactUnitary</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int controlQubit, const int targetQubit, <a class="el" href="structComplex.html">Complex</a> alpha, <a class="el" href="structComplex.html">Complex</a> beta)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a55fdf6604434dab8a5c0b8522b6cc10c">statevec_controlledCompactUnitaryKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int controlQubit, const int targetQubit, <a class="el" href="structComplex.html">Complex</a> alpha, <a class="el" href="structComplex.html">Complex</a> beta)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a114038296eb404b9b8a66aaad7b48800">statevec_controlledNot</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int controlQubit, const int targetQubit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#aca8a32f46dbaabdbffc38d7b8023bf20">statevec_controlledNotKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int controlQubit, const int targetQubit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a708246b16236c492094c2633da0c08ff">statevec_controlledPauliY</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int controlQubit, const int targetQubit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a9e647339720bf82b30c6331fad544ec5">statevec_controlledPauliYConj</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int controlQubit, const int targetQubit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a9c7dfe745a3bb35f18440891d267e963">statevec_controlledPauliYKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int controlQubit, const int targetQubit, const int conjFac)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a7c0067cb9f243ead20de7392aea328bc">statevec_controlledPhaseFlip</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int idQubit1, const int idQubit2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#abf9e7eae332bbbd2e8b7b9c3ca3bad92">statevec_controlledPhaseFlipKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int idQubit1, const int idQubit2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#adeb715f3f2c167f9bfbe92b75f5988ce">statevec_controlledPhaseShift</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int idQubit1, const int idQubit2, qreal angle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#af7723faf3f94342480a54fc2137522ce">statevec_controlledPhaseShiftKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int idQubit1, const int idQubit2, qreal cosAngle, qreal sinAngle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a2600999a19c817bfcf7ca14779e33b9a">statevec_controlledUnitary</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int controlQubit, const int targetQubit, <a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a> <a class="el" href="README_8md.html#a5d1c311241dc8d8ffa4badf059977dc5">u</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a032043d9f255e8419bb5efe1aec13532">statevec_controlledUnitaryKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int controlQubit, const int targetQubit, <a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a> <a class="el" href="README_8md.html#a5d1c311241dc8d8ffa4badf059977dc5">u</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a365bbb1b80cb00405c8bf1a4fa1ea8e5">statevec_createQureg</a> (<a class="el" href="structQureg.html">Qureg</a> *qureg, int numQubits, <a class="el" href="structQuESTEnv.html">QuESTEnv</a> env)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a2a52ad9f9ad9b2fd6a76f6d433b3b217">statevec_destroyQureg</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, <a class="el" href="structQuESTEnv.html">QuESTEnv</a> env)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">qreal&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a067da9fba487d5821fbd689718b19de2">statevec_findProbabilityOfZero</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int measureQubit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#aae568d73d0de878acffe3798779de474">statevec_findProbabilityOfZeroKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int measureQubit, qreal *reducedArray)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">qreal&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#abd509244d57657e148e4084c5ab5d28f">statevec_getImagAmp</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, long long int index)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">qreal&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#abc9a9ef4344c7faaaf28ac25c76649b9">statevec_getRealAmp</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, long long int index)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a9226f386d010aaa85efc0e8889d341d5">statevec_hadamard</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a14b5999f157b704aced4776c9ccbc982">statevec_hadamardKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a288dc4b46bdacd69cbf4a6fd070d26a7">statevec_initClassicalState</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, long long int stateInd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a0f1817fe73e2911937af3979b6506ebd">statevec_initClassicalStateKernel</a> (long long int stateVecSize, qreal *stateVecReal, qreal *stateVecImag, long long int stateInd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a482fc361fd5f08075404c72e536316a0">statevec_initPlusState</a> (<a class="el" href="structQureg.html">Qureg</a> qureg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#aaa36e3e86a5b79e676c6268fa2b02222">statevec_initPlusStateKernel</a> (long long int stateVecSize, qreal *stateVecReal, qreal *stateVecImag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a38445cdb2a18671a7c73112ce3337acb">statevec_initStateDebug</a> (<a class="el" href="structQureg.html">Qureg</a> qureg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialise the state vector of probability amplitudes to an (unphysical) state with each component of each probability amplitude a unique floating point value.  <a href="#a38445cdb2a18671a7c73112ce3337acb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a11c729ef89f1c145507a3018b3a52a06">statevec_initStateDebugKernel</a> (long long int stateVecSize, qreal *stateVecReal, qreal *stateVecImag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a05756b45f10135bb2eeb07380f806c20">statevec_initStateFromSingleFile</a> (<a class="el" href="structQureg.html">Qureg</a> *qureg, char filename[200], <a class="el" href="structQuESTEnv.html">QuESTEnv</a> env)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a923906770cac0da9e3459bae58de9e64">statevec_initStateOfSingleQubit</a> (<a class="el" href="structQureg.html">Qureg</a> *qureg, int qubitId, int outcome)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialise the state vector of probability amplitudes such that one qubit is set to 'outcome' and all other qubits are in an equal superposition of zero and one.  <a href="#a923906770cac0da9e3459bae58de9e64"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ace807c2089e172363db9ffe083f60f71">statevec_initStateOfSingleQubitKernel</a> (long long int stateVecSize, qreal *stateVecReal, qreal *stateVecImag, int qubitId, int outcome)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a2ca0c6ba07ab2b4b437321bf17efc966">statevec_initZeroState</a> (<a class="el" href="structQureg.html">Qureg</a> qureg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a43b35abfab0d6093b052e2c2e4b15064">statevec_initZeroStateKernel</a> (long long int stateVecSize, qreal *stateVecReal, qreal *stateVecImag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ac4ee5979d475e8c729294b8ef7e0270d">statevec_multiControlledPhaseFlip</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, int *controlQubits, int numControlQubits)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ab1f13b1980ec46bac75e97c578d15e98">statevec_multiControlledPhaseFlipKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, long long int mask)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#aa662796ea6e0f471143c53becae8c12c">statevec_multiControlledPhaseShift</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, int *controlQubits, int numControlQubits, qreal angle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a11dc3581b1efe1332854eac7594bc647">statevec_multiControlledPhaseShiftKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, long long int mask, qreal cosAngle, qreal sinAngle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ae03bdeff36235ac294d1570add427c41">statevec_multiControlledUnitary</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, int *controlQubits, int numControlQubits, const int targetQubit, <a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a> <a class="el" href="README_8md.html#a5d1c311241dc8d8ffa4badf059977dc5">u</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a42b5655729d07e16ab2f61d90706989a">statevec_multiControlledUnitaryKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, long long int mask, const int targetQubit, <a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a> <a class="el" href="README_8md.html#a5d1c311241dc8d8ffa4badf059977dc5">u</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#abdb6e0ee1e407755e1b944086cedd90e">statevec_pauliX</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ab1662a828dc725610a71168a58430fae">statevec_pauliXKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a73b56fbac6e464a37805fa9d9657a8f9">statevec_pauliY</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#aee97816cfabeea7874cd837a8d105412">statevec_pauliYConj</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a1f5b1f46708a7c96275e379b873ba2f6">statevec_pauliYKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit, const int conjFac)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a8972669148af60d7e1c09687f69673d4">statevec_phaseShiftByTerm</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit, <a class="el" href="structComplex.html">Complex</a> term)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a5ef71ca3bb26774d7317253128a4aeab">statevec_phaseShiftByTermKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit, qreal cosAngle, qreal sinAngle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a1e57230c7995447039e62a84c0a36524">statevec_reportStateToScreen</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, <a class="el" href="structQuESTEnv.html">QuESTEnv</a> env, int reportRank)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Print the current state vector of probability amplitudes for a set of qubits to standard out.  <a href="#a1e57230c7995447039e62a84c0a36524"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#aa121d55f2ca09c06a96ddcd433c60b0f">statevec_setAmps</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, long long int startInd, qreal *reals, qreal *imags, long long int numAmps)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a4bea7ed7967083cbabd8a8e5acdd48c0">statevec_unitary</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit, <a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a> <a class="el" href="README_8md.html#a5d1c311241dc8d8ffa4badf059977dc5">u</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__global__ void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a839403bc90931dac70995f4887c05fd8">statevec_unitaryKernel</a> (<a class="el" href="structQureg.html">Qureg</a> qureg, const int targetQubit, <a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a> <a class="el" href="README_8md.html#a5d1c311241dc8d8ffa4badf059977dc5">u</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a31772904f024efd8d75a022e84c8207b">swapDouble</a> (qreal **a, qreal **b)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#a8d31fe2d1ad4d01e2a1f5f6b8bc15b77">syncQuESTEnv</a> (<a class="el" href="structQuESTEnv.html">QuESTEnv</a> env)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Guarantees that all code up to the given point has been executed on all nodes (if running in distributed mode).  <a href="#a8d31fe2d1ad4d01e2a1f5f6b8bc15b77"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="QuEST__gpu_8cu.html#ac7e38d768a1bd79019f88cc1e6295092">syncQuESTSuccess</a> (int successCode)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Performs a logical AND on all successCodes held by all processes.  <a href="#ac7e38d768a1bd79019f88cc1e6295092"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>An implementation of the pure backend in . </p>
<p>./QuEST_ops_pure.h for a GPU environment. </p>

<p>Definition in file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ad72dbcf6d0153db1b8d8a58001feed83"></a><!-- doxytag: member="QuEST_gpu.cu::DEBUG" ref="ad72dbcf6d0153db1b8d8a58001feed83" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00016">16</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>Referenced by <a class="el" href="QuEST__gpu_8cu_source.html#l00291">copyStateFromGPU()</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l00277">copyStateToGPU()</a>.</p>

</div>
</div>
<a class="anchor" id="aa57d77a0903e334e963c66ddc5ed3f53"></a><!-- doxytag: member="QuEST_gpu.cu::REDUCE_SHARED_SIZE" ref="aa57d77a0903e334e963c66ddc5ed3f53" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REDUCE_SHARED_SIZE&nbsp;&nbsp;&nbsp;512</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00015">15</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>Referenced by <a class="el" href="QuEST__gpu_8cu_source.html#l01727">densmatr_calcFidelity()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01797">densmatr_calcPurity()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01466">densmatr_findProbabilityOfZero()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01600">statevec_calcInnerProduct()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00155">statevec_createQureg()</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01514">statevec_findProbabilityOfZero()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aea20d173141544e6c5359955a1fbe997"></a><!-- doxytag: member="QuEST_gpu.cu::copySharedReduceBlock" ref="aea20d173141544e6c5359955a1fbe997" args="(qreal *arrayIn, qreal *reducedArray, int length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void copySharedReduceBlock </td>
          <td>(</td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>arrayIn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>reducedArray</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01353">1353</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01334">reduceBlock()</a>.</p>

<p>Referenced by <a class="el" href="QuEST__gpu_8cu_source.html#l01727">densmatr_calcFidelity()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01797">densmatr_calcPurity()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01466">densmatr_findProbabilityOfZero()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01600">statevec_calcInnerProduct()</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01514">statevec_findProbabilityOfZero()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01353"></a>01353                                                                                      {
<a name="l01354"></a>01354     <span class="keyword">extern</span> __shared__ <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> tempReductionArray[];
<a name="l01355"></a>01355     <span class="keywordtype">int</span> blockOffset = blockIdx.x*length;
<a name="l01356"></a>01356     tempReductionArray[threadIdx.x*2] = arrayIn[blockOffset + threadIdx.x*2];
<a name="l01357"></a>01357     tempReductionArray[threadIdx.x*2+1] = arrayIn[blockOffset + threadIdx.x*2+1];
<a name="l01358"></a>01358     __syncthreads();
<a name="l01359"></a>01359     <a class="code" href="QuEST__gpu_8cu.html#ac82f3dbf68f877f57d4abbb72fae1254">reduceBlock</a>(tempReductionArray, reducedArray, length);
<a name="l01360"></a>01360 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a924ef2dbda6b733b4041270077c76ece"></a><!-- doxytag: member="QuEST_gpu.cu::copyStateFromGPU" ref="a924ef2dbda6b733b4041270077c76ece" args="(Qureg qureg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void copyStateFromGPU </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00291">291</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l00016">DEBUG</a>, <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST_8h_source.html#l00100">Qureg::stateVec</a>.</p>

<p>Referenced by <a class="el" href="QuEST__gpu_8cu_source.html#l01110">densmatr_calcTotalProb()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01133">statevec_calcTotalProb()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00512">statevec_compareStates()</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l00305">statevec_reportStateToScreen()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00292"></a>00292 {
<a name="l00293"></a>00293     cudaDeviceSynchronize();
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (<a class="code" href="QuEST__gpu_8cu.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>) printf(<span class="stringliteral">&quot;Copying data from GPU\n&quot;</span>);
<a name="l00295"></a>00295     cudaMemcpy(qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, 
<a name="l00296"></a>00296             qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>*<span class="keyword">sizeof</span>(*(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real)), cudaMemcpyDeviceToHost);
<a name="l00297"></a>00297     cudaMemcpy(qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, 
<a name="l00298"></a>00298             qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>*<span class="keyword">sizeof</span>(*(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag)), cudaMemcpyDeviceToHost);
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (<a class="code" href="QuEST__gpu_8cu.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>) printf(<span class="stringliteral">&quot;Finished copying data from GPU\n&quot;</span>);
<a name="l00300"></a>00300 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a11448560006dd165128e404b54ebb2f7"></a><!-- doxytag: member="QuEST_gpu.cu::copyStateToGPU" ref="a11448560006dd165128e404b54ebb2f7" args="(Qureg qureg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void copyStateToGPU </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00277">277</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l00016">DEBUG</a>, <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST_8h_source.html#l00100">Qureg::stateVec</a>.</p>

<p>Referenced by <a class="el" href="QuEST__gpu_8cu_source.html#l00468">statevec_initStateFromSingleFile()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00278"></a>00278 {
<a name="l00279"></a>00279     <span class="keywordflow">if</span> (<a class="code" href="QuEST__gpu_8cu.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>) printf(<span class="stringliteral">&quot;Copying data to GPU\n&quot;</span>);
<a name="l00280"></a>00280     cudaMemcpy(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real, 
<a name="l00281"></a>00281             qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>*<span class="keyword">sizeof</span>(*(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real)), cudaMemcpyHostToDevice);
<a name="l00282"></a>00282     cudaMemcpy(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real, 
<a name="l00283"></a>00283             qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>*<span class="keyword">sizeof</span>(*(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real)), cudaMemcpyHostToDevice);
<a name="l00284"></a>00284     cudaMemcpy(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag, 
<a name="l00285"></a>00285             qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>*<span class="keyword">sizeof</span>(*(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag)), cudaMemcpyHostToDevice);
<a name="l00286"></a>00286     cudaMemcpy(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag, 
<a name="l00287"></a>00287             qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>*<span class="keyword">sizeof</span>(*(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag)), cudaMemcpyHostToDevice);
<a name="l00288"></a>00288     <span class="keywordflow">if</span> (<a class="code" href="QuEST__gpu_8cu.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>) printf(<span class="stringliteral">&quot;Finished copying data to GPU\n&quot;</span>);
<a name="l00289"></a>00289 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8ba2c3388dd64d9348c3b091852d36d4"></a><!-- doxytag: member="QuEST_gpu.cu::createQuESTEnv" ref="a8ba2c3388dd64d9348c3b091852d36d4" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structQuESTEnv.html">QuESTEnv</a> createQuESTEnv </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create the QuEST execution environment. </p>
<p>This should be called only once, and the environment should be freed with destroyQuESTEnv at the end of the user's code. If something needs to be done to set up the execution environment, such as initializing MPI when running in distributed mode, it is handled here.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>object representing the execution environment. A single instance is used for each program </dd></dl>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00233">233</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l00216">GPUExists()</a>, <a class="el" href="QuEST_8h_source.html#l00120">QuESTEnv::numRanks</a>, <a class="el" href="QuEST_8h_source.html#l00119">QuESTEnv::rank</a>, and <a class="el" href="QuEST__common_8c_source.html#l00135">seedQuESTDefault()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00233"></a>00233                               {
<a name="l00234"></a>00234     <span class="comment">// init MPI environment</span>
<a name="l00235"></a>00235     <span class="keywordflow">if</span> (!<a class="code" href="QuEST__gpu_8cu.html#a0aabd5ed69a74e5bc0b46a17af45c886">GPUExists</a>()){
<a name="l00236"></a>00236         printf(<span class="stringliteral">&quot;Trying to run GPU code with no GPU available\n&quot;</span>);
<a name="l00237"></a>00237         exit(EXIT_FAILURE);
<a name="l00238"></a>00238     }
<a name="l00239"></a>00239     
<a name="l00240"></a>00240     <a class="code" href="structQuESTEnv.html" title="Information about the environment the program is running in.">QuESTEnv</a> env;
<a name="l00241"></a>00241     env.<a class="code" href="structQuESTEnv.html#aa648bb336cf8598467cb62db00b9cee8">rank</a>=0;
<a name="l00242"></a>00242     env.<a class="code" href="structQuESTEnv.html#af22aacd7c9905accae28484785c193b4">numRanks</a>=1;
<a name="l00243"></a>00243     
<a name="l00244"></a>00244     <a class="code" href="QuEST_8h.html#aa8437ef3bf135231e2916e64dde1c94e" title="Seed the Mersenne Twister used for random number generation in the QuEST environment...">seedQuESTDefault</a>();
<a name="l00245"></a>00245     
<a name="l00246"></a>00246     <span class="keywordflow">return</span> env;
<a name="l00247"></a>00247 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7c14b7f97aac42f390383893e703841f"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_addDensityMatrix" ref="a7c14b7f97aac42f390383893e703841f" args="(Qureg combineQureg, qreal otherProb, Qureg otherQureg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void densmatr_addDensityMatrix </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>combineQureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>otherProb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>otherQureg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01979">1979</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00585">addDensityMatrix()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01979"></a>01979                                                                                       {
<a name="l01980"></a>01980     
<a name="l01981"></a>01981     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numAmpsToVisit = combineQureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l01982"></a>01982     
<a name="l01983"></a>01983     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l01984"></a>01984     threadsPerCUDABlock = 128;
<a name="l01985"></a>01985     CUDABlocks = ceil(numAmpsToVisit / (<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>) threadsPerCUDABlock);
<a name="l01986"></a>01986     densmatr_addDensityMatrixKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l01987"></a>01987         combineQureg, otherProb, otherQureg, numAmpsToVisit
<a name="l01988"></a>01988     );
<a name="l01989"></a>01989 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac12545f9573072f0f5f9b7dd08b2fbab"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_addDensityMatrixKernel" ref="ac12545f9573072f0f5f9b7dd08b2fbab" args="(Qureg combineQureg, qreal otherProb, Qureg otherQureg, long long int numAmpsToVisit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void densmatr_addDensityMatrixKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>combineQureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>otherProb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>otherQureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>numAmpsToVisit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01967">1967</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01967"></a>01967                                                                                                                                      {
<a name="l01968"></a>01968     
<a name="l01969"></a>01969     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> ampInd = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01970"></a>01970     <span class="keywordflow">if</span> (ampInd &gt;= numAmpsToVisit) <span class="keywordflow">return</span>;
<a name="l01971"></a>01971     
<a name="l01972"></a>01972     combineQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real[ampInd] *= 1-otherProb;
<a name="l01973"></a>01973     combineQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag[ampInd] *= 1-otherProb;
<a name="l01974"></a>01974   
<a name="l01975"></a>01975     combineQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real[ampInd] += otherProb*otherQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real[ampInd];
<a name="l01976"></a>01976     combineQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag[ampInd] += otherProb*otherQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag[ampInd];
<a name="l01977"></a>01977 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa6c3f86010ad398f42b0577ea3bb5bcf"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_calcFidelity" ref="aa6c3f86010ad398f42b0577ea3bb5bcf" args="(Qureg qureg, Qureg pureState)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">qreal densmatr_calcFidelity </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>pureState</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01727">1727</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l01353">copySharedReduceBlock()</a>, <a class="el" href="QuEST_8h_source.html#l00107">Qureg::firstLevelReduction</a>, <a class="el" href="QuEST_8h_source.html#l00086">Qureg::numQubitsRepresented</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00015">REDUCE_SHARED_SIZE</a>, <a class="el" href="QuEST_8h_source.html#l00107">Qureg::secondLevelReduction</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01459">swapDouble()</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00630">calcFidelity()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01727"></a>01727                                                           {
<a name="l01728"></a>01728     
<a name="l01729"></a>01729     <span class="comment">// we&apos;re summing the square of every term in the density matrix</span>
<a name="l01730"></a>01730     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> densityDim = 1LL &lt;&lt; qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>;
<a name="l01731"></a>01731     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numValuesToReduce = densityDim;
<a name="l01732"></a>01732     
<a name="l01733"></a>01733     <span class="keywordtype">int</span> valuesPerCUDABlock, numCUDABlocks, sharedMemSize;
<a name="l01734"></a>01734     <span class="keywordtype">int</span> maxReducedPerLevel = <a class="code" href="QuEST__gpu_8cu.html#aa57d77a0903e334e963c66ddc5ed3f53">REDUCE_SHARED_SIZE</a>;
<a name="l01735"></a>01735     <span class="keywordtype">int</span> firstTime = 1;
<a name="l01736"></a>01736     
<a name="l01737"></a>01737     <span class="keywordflow">while</span> (numValuesToReduce &gt; 1) {
<a name="l01738"></a>01738         
<a name="l01739"></a>01739         <span class="comment">// need less than one CUDA-BLOCK to reduce</span>
<a name="l01740"></a>01740         <span class="keywordflow">if</span> (numValuesToReduce &lt; maxReducedPerLevel) {
<a name="l01741"></a>01741             valuesPerCUDABlock = numValuesToReduce;
<a name="l01742"></a>01742             numCUDABlocks = 1;
<a name="l01743"></a>01743         }
<a name="l01744"></a>01744         <span class="comment">// otherwise use only full CUDA-BLOCKS</span>
<a name="l01745"></a>01745         <span class="keywordflow">else</span> {
<a name="l01746"></a>01746             valuesPerCUDABlock = maxReducedPerLevel; <span class="comment">// constrained by shared memory</span>
<a name="l01747"></a>01747             numCUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)numValuesToReduce/valuesPerCUDABlock);
<a name="l01748"></a>01748         }
<a name="l01749"></a>01749         <span class="comment">// dictates size of reduction array</span>
<a name="l01750"></a>01750         sharedMemSize = valuesPerCUDABlock*<span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>);
<a name="l01751"></a>01751         
<a name="l01752"></a>01752         <span class="comment">// spawn threads to sum the probs in each block</span>
<a name="l01753"></a>01753         <span class="comment">// store the reduction in the pureState array</span>
<a name="l01754"></a>01754         <span class="keywordflow">if</span> (firstTime) {
<a name="l01755"></a>01755              densmatr_calcFidelityKernel&lt;&lt;&lt;numCUDABlocks, valuesPerCUDABlock, sharedMemSize&gt;&gt;&gt;(
<a name="l01756"></a>01756                  qureg, pureState, densityDim, pureState.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>);
<a name="l01757"></a>01757             firstTime = 0;
<a name="l01758"></a>01758             
<a name="l01759"></a>01759         <span class="comment">// sum the block probs</span>
<a name="l01760"></a>01760         } <span class="keywordflow">else</span> {
<a name="l01761"></a>01761             cudaDeviceSynchronize();    
<a name="l01762"></a>01762             <a class="code" href="QuEST__gpu_8cu.html#aea20d173141544e6c5359955a1fbe997">copySharedReduceBlock</a>&lt;&lt;&lt;numCUDABlocks, valuesPerCUDABlock/2, sharedMemSize&gt;&gt;&gt;(
<a name="l01763"></a>01763                     pureState.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>, 
<a name="l01764"></a>01764                     pureState.<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>, valuesPerCUDABlock); 
<a name="l01765"></a>01765             cudaDeviceSynchronize();    
<a name="l01766"></a>01766             <a class="code" href="QuEST__gpu_8cu.html#a31772904f024efd8d75a022e84c8207b">swapDouble</a>(&amp;(pureState.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>), &amp;(pureState.<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>));
<a name="l01767"></a>01767         }
<a name="l01768"></a>01768         
<a name="l01769"></a>01769         numValuesToReduce = numValuesToReduce/maxReducedPerLevel;
<a name="l01770"></a>01770     }
<a name="l01771"></a>01771     
<a name="l01772"></a>01772     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> fidelity;
<a name="l01773"></a>01773     cudaMemcpy(&amp;fidelity, pureState.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>, <span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>), cudaMemcpyDeviceToHost);
<a name="l01774"></a>01774     <span class="keywordflow">return</span> fidelity;
<a name="l01775"></a>01775 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a090901670793c53a1b08629712b2cdae"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_calcFidelityKernel" ref="a090901670793c53a1b08629712b2cdae" args="(Qureg dens, Qureg vec, long long int dim, qreal *reducedArray)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void densmatr_calcFidelityKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>dens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>vec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>reducedArray</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>computes one term of (vec^*T) dens * vec </p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01688">1688</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01334">reduceBlock()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01688"></a>01688                                                                                                            {
<a name="l01689"></a>01689 
<a name="l01690"></a>01690     <span class="comment">// figure out which density matrix row to consider</span>
<a name="l01691"></a>01691     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> col;
<a name="l01692"></a>01692     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> row = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01693"></a>01693     <span class="keywordflow">if</span> (row &gt;= dim) <span class="keywordflow">return</span>;
<a name="l01694"></a>01694     
<a name="l01695"></a>01695     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>* densReal = dens.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l01696"></a>01696     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>* densImag = dens.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l01697"></a>01697     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>* vecReal  = vec.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l01698"></a>01698     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>* vecImag  = vec.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l01699"></a>01699     
<a name="l01700"></a>01700     <span class="comment">// compute the row-th element of the product dens*vec</span>
<a name="l01701"></a>01701     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> prodReal = 0;
<a name="l01702"></a>01702     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> prodImag = 0;
<a name="l01703"></a>01703     <span class="keywordflow">for</span> (col=0LL; col &lt; dim; col++) {
<a name="l01704"></a>01704         <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> densElemReal = densReal[dim*col + row];
<a name="l01705"></a>01705         <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> densElemImag = densImag[dim*col + row];
<a name="l01706"></a>01706         
<a name="l01707"></a>01707         prodReal += densElemReal*vecReal[col] - densElemImag*vecImag[col];
<a name="l01708"></a>01708         prodImag += densElemReal*vecImag[col] + densElemImag*vecReal[col];
<a name="l01709"></a>01709     }
<a name="l01710"></a>01710     
<a name="l01711"></a>01711     <span class="comment">// multiply with row-th elem of (vec^*)</span>
<a name="l01712"></a>01712     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> termReal = prodImag*vecImag[row] + prodReal*vecReal[row];
<a name="l01713"></a>01713     
<a name="l01714"></a>01714     <span class="comment">// imag of every term should be zero, because each is a valid fidelity calc of an eigenstate</span>
<a name="l01715"></a>01715     <span class="comment">//qreal termImag = prodImag*vecReal[row] - prodReal*vecImag[row];</span>
<a name="l01716"></a>01716     
<a name="l01717"></a>01717     <span class="keyword">extern</span> __shared__ <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> tempReductionArray[];
<a name="l01718"></a>01718     tempReductionArray[threadIdx.x] = termReal;
<a name="l01719"></a>01719     __syncthreads();
<a name="l01720"></a>01720     
<a name="l01721"></a>01721     <span class="comment">// every second thread reduces</span>
<a name="l01722"></a>01722     <span class="keywordflow">if</span> (threadIdx.x&lt;blockDim.x/2)
<a name="l01723"></a>01723         <a class="code" href="QuEST__gpu_8cu.html#ac82f3dbf68f877f57d4abbb72fae1254">reduceBlock</a>(tempReductionArray, reducedArray, blockDim.x);
<a name="l01724"></a>01724 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad405e3fac20997043e0236b751e44270"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_calcProbOfOutcome" ref="ad405e3fac20997043e0236b751e44270" args="(Qureg qureg, const int measureQubit, int outcome)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">qreal densmatr_calcProbOfOutcome </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>measureQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>outcome</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01560">1560</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l01466">densmatr_findProbabilityOfZero()</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00614">calcProbOfOutcome()</a>, <a class="el" href="QuEST_8c_source.html#l00539">collapseToOutcome()</a>, and <a class="el" href="QuEST__common_8c_source.html#l00320">densmatr_measureWithStats()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01561"></a>01561 {
<a name="l01562"></a>01562     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> outcomeProb = <a class="code" href="QuEST__gpu_8cu.html#afbb044d76bf22d5c81a2a70a977f29bc">densmatr_findProbabilityOfZero</a>(qureg, measureQubit);
<a name="l01563"></a>01563     <span class="keywordflow">if</span> (outcome==1) 
<a name="l01564"></a>01564         outcomeProb = 1.0 - outcomeProb;
<a name="l01565"></a>01565     <span class="keywordflow">return</span> outcomeProb;
<a name="l01566"></a>01566 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae45eefa65f4ecd37bab84fade7cf7f1f"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_calcPurity" ref="ae45eefa65f4ecd37bab84fade7cf7f1f" args="(Qureg qureg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">qreal densmatr_calcPurity </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Computes the trace of the density matrix squared. </p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01797">1797</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l01353">copySharedReduceBlock()</a>, <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00107">Qureg::firstLevelReduction</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00015">REDUCE_SHARED_SIZE</a>, <a class="el" href="QuEST_8h_source.html#l00107">Qureg::secondLevelReduction</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01459">swapDouble()</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00624">calcPurity()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01797"></a>01797                                        {
<a name="l01798"></a>01798     
<a name="l01799"></a>01799     <span class="comment">// we&apos;re summing the square of every term in the density matrix</span>
<a name="l01800"></a>01800     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numValuesToReduce = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l01801"></a>01801     
<a name="l01802"></a>01802     <span class="keywordtype">int</span> valuesPerCUDABlock, numCUDABlocks, sharedMemSize;
<a name="l01803"></a>01803     <span class="keywordtype">int</span> maxReducedPerLevel = <a class="code" href="QuEST__gpu_8cu.html#aa57d77a0903e334e963c66ddc5ed3f53">REDUCE_SHARED_SIZE</a>;
<a name="l01804"></a>01804     <span class="keywordtype">int</span> firstTime = 1;
<a name="l01805"></a>01805     
<a name="l01806"></a>01806     <span class="keywordflow">while</span> (numValuesToReduce &gt; 1) {
<a name="l01807"></a>01807         
<a name="l01808"></a>01808         <span class="comment">// need less than one CUDA-BLOCK to reduce</span>
<a name="l01809"></a>01809         <span class="keywordflow">if</span> (numValuesToReduce &lt; maxReducedPerLevel) {
<a name="l01810"></a>01810             valuesPerCUDABlock = numValuesToReduce;
<a name="l01811"></a>01811             numCUDABlocks = 1;
<a name="l01812"></a>01812         }
<a name="l01813"></a>01813         <span class="comment">// otherwise use only full CUDA-BLOCKS</span>
<a name="l01814"></a>01814         <span class="keywordflow">else</span> {
<a name="l01815"></a>01815             valuesPerCUDABlock = maxReducedPerLevel; <span class="comment">// constrained by shared memory</span>
<a name="l01816"></a>01816             numCUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)numValuesToReduce/valuesPerCUDABlock);
<a name="l01817"></a>01817         }
<a name="l01818"></a>01818         <span class="comment">// dictates size of reduction array</span>
<a name="l01819"></a>01819         sharedMemSize = valuesPerCUDABlock*<span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>);
<a name="l01820"></a>01820         
<a name="l01821"></a>01821         <span class="comment">// spawn threads to sum the probs in each block</span>
<a name="l01822"></a>01822         <span class="keywordflow">if</span> (firstTime) {
<a name="l01823"></a>01823              densmatr_calcPurityKernel&lt;&lt;&lt;numCUDABlocks, valuesPerCUDABlock, sharedMemSize&gt;&gt;&gt;(
<a name="l01824"></a>01824                  qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, 
<a name="l01825"></a>01825                  numValuesToReduce, qureg.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>);
<a name="l01826"></a>01826             firstTime = 0;
<a name="l01827"></a>01827             
<a name="l01828"></a>01828         <span class="comment">// sum the block probs</span>
<a name="l01829"></a>01829         } <span class="keywordflow">else</span> {
<a name="l01830"></a>01830             cudaDeviceSynchronize();    
<a name="l01831"></a>01831             <a class="code" href="QuEST__gpu_8cu.html#aea20d173141544e6c5359955a1fbe997">copySharedReduceBlock</a>&lt;&lt;&lt;numCUDABlocks, valuesPerCUDABlock/2, sharedMemSize&gt;&gt;&gt;(
<a name="l01832"></a>01832                     qureg.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>, 
<a name="l01833"></a>01833                     qureg.<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>, valuesPerCUDABlock); 
<a name="l01834"></a>01834             cudaDeviceSynchronize();    
<a name="l01835"></a>01835             <a class="code" href="QuEST__gpu_8cu.html#a31772904f024efd8d75a022e84c8207b">swapDouble</a>(&amp;(qureg.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>), &amp;(qureg.<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>));
<a name="l01836"></a>01836         }
<a name="l01837"></a>01837         
<a name="l01838"></a>01838         numValuesToReduce = numValuesToReduce/maxReducedPerLevel;
<a name="l01839"></a>01839     }
<a name="l01840"></a>01840     
<a name="l01841"></a>01841     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> traceDensSquared;
<a name="l01842"></a>01842     cudaMemcpy(&amp;traceDensSquared, qureg.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>, <span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>), cudaMemcpyDeviceToHost);
<a name="l01843"></a>01843     <span class="keywordflow">return</span> traceDensSquared;
<a name="l01844"></a>01844 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afe005f9f69319901bb56c4d022359ad5"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_calcPurityKernel" ref="afe005f9f69319901bb56c4d022359ad5" args="(qreal *vecReal, qreal *vecImag, long long int numAmpsToSum, qreal *reducedArray)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void densmatr_calcPurityKernel </td>
          <td>(</td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecImag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>numAmpsToSum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>reducedArray</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01778">1778</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01334">reduceBlock()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01778"></a>01778                                                                                                                            {
<a name="l01779"></a>01779     
<a name="l01780"></a>01780     <span class="comment">// figure out which density matrix term this thread is assigned</span>
<a name="l01781"></a>01781     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01782"></a>01782     <span class="keywordflow">if</span> (index &gt;= numAmpsToSum) <span class="keywordflow">return</span>;
<a name="l01783"></a>01783     
<a name="l01784"></a>01784     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> term = vecReal[index]*vecReal[index] + vecImag[index]*vecImag[index];
<a name="l01785"></a>01785     
<a name="l01786"></a>01786     <span class="comment">// array of each thread&apos;s collected probability, to be summed</span>
<a name="l01787"></a>01787     <span class="keyword">extern</span> __shared__ <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> tempReductionArray[];
<a name="l01788"></a>01788     tempReductionArray[threadIdx.x] = term;
<a name="l01789"></a>01789     __syncthreads();
<a name="l01790"></a>01790     
<a name="l01791"></a>01791     <span class="comment">// every second thread reduces</span>
<a name="l01792"></a>01792     <span class="keywordflow">if</span> (threadIdx.x&lt;blockDim.x/2)
<a name="l01793"></a>01793         <a class="code" href="QuEST__gpu_8cu.html#ac82f3dbf68f877f57d4abbb72fae1254">reduceBlock</a>(tempReductionArray, reducedArray, blockDim.x);
<a name="l01794"></a>01794 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6153547f245c05874161a105e9a2f02c"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_calcTotalProb" ref="a6153547f245c05874161a105e9a2f02c" args="(Qureg qureg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">qreal densmatr_calcTotalProb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01110">1110</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l00291">copyStateFromGPU()</a>, <a class="el" href="QuEST_8h_source.html#l00086">Qureg::numQubitsRepresented</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, <a class="el" href="QuEST_8h_source.html#l00100">Qureg::stateVec</a>, and <a class="el" href="README_8md_source.html#l00018">y</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00599">calcTotalProb()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01110"></a>01110                                           {
<a name="l01111"></a>01111     
<a name="l01112"></a>01112     <span class="comment">// computes the trace using Kahan summation</span>
<a name="l01113"></a>01113     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> pTotal=0;
<a name="l01114"></a>01114     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> <a class="code" href="README_8md.html#a003dc5701d53a819228f5417a8089139">y</a>, t, c;
<a name="l01115"></a>01115     c = 0;
<a name="l01116"></a>01116     
<a name="l01117"></a>01117     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numCols = 1LL &lt;&lt; qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>;
<a name="l01118"></a>01118     <span class="keywordtype">long</span> <span class="keywordtype">long</span> diagIndex;
<a name="l01119"></a>01119     
<a name="l01120"></a>01120     <a class="code" href="QuEST__gpu_8cu.html#a924ef2dbda6b733b4041270077c76ece">copyStateFromGPU</a>(qureg);
<a name="l01121"></a>01121     
<a name="l01122"></a>01122     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col=0; col&lt; numCols; col++) {
<a name="l01123"></a>01123         diagIndex = col*(numCols + 1);
<a name="l01124"></a>01124         y = qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real[diagIndex] - c;
<a name="l01125"></a>01125         t = pTotal + y;
<a name="l01126"></a>01126         c = ( t - pTotal ) - y; <span class="comment">// brackets are important</span>
<a name="l01127"></a>01127         pTotal = t;
<a name="l01128"></a>01128     }
<a name="l01129"></a>01129     
<a name="l01130"></a>01130     <span class="keywordflow">return</span> pTotal;
<a name="l01131"></a>01131 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab321af37fe3490253e12b7c70b8d2a98"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_collapseToKnownProbOutcome" ref="ab321af37fe3490253e12b7c70b8d2a98" args="(Qureg qureg, const int measureQubit, int outcome, qreal outcomeProb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void densmatr_collapseToKnownProbOutcome </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>measureQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>outcome</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>outcomeProb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This involves finding |...i. </p>
<p>Renorms (/prob) every | * outcome * &gt;&lt; * outcome * | state, setting all others to zero.</p>
<p>..&gt;&lt;...j...| states and killing those where i!=j </p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01938">1938</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST_8h_source.html#l00086">Qureg::numQubitsRepresented</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00539">collapseToOutcome()</a>, and <a class="el" href="QuEST__common_8c_source.html#l00320">densmatr_measureWithStats()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01938"></a>01938                                                                                                               {
<a name="l01939"></a>01939     
<a name="l01940"></a>01940         <span class="keywordtype">int</span> rowQubit = measureQubit + qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>;
<a name="l01941"></a>01941     
<a name="l01942"></a>01942     <span class="keywordtype">int</span> colBit = 1LL &lt;&lt; measureQubit;
<a name="l01943"></a>01943     <span class="keywordtype">int</span> rowBit = 1LL &lt;&lt; rowQubit;
<a name="l01944"></a>01944 
<a name="l01945"></a>01945     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numBasesToVisit = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>/4;
<a name="l01946"></a>01946         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part1 = colBit -1;        
<a name="l01947"></a>01947         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part2 = (rowBit &gt;&gt; 1) - colBit;
<a name="l01948"></a>01948         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part3 = numBasesToVisit - (rowBit &gt;&gt; 1);
<a name="l01949"></a>01949     
<a name="l01950"></a>01950     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> desired, undesired;
<a name="l01951"></a>01951     <span class="keywordflow">if</span> (outcome == 0) {
<a name="l01952"></a>01952         desired = 0;
<a name="l01953"></a>01953         undesired = colBit | rowBit;
<a name="l01954"></a>01954     } <span class="keywordflow">else</span> {
<a name="l01955"></a>01955         desired = colBit | rowBit;
<a name="l01956"></a>01956         undesired = 0;
<a name="l01957"></a>01957     }
<a name="l01958"></a>01958     
<a name="l01959"></a>01959     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l01960"></a>01960     threadsPerCUDABlock = 128;
<a name="l01961"></a>01961     CUDABlocks = ceil(numBasesToVisit / (<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>) threadsPerCUDABlock);
<a name="l01962"></a>01962     densmatr_collapseToKnownProbOutcomeKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l01963"></a>01963         outcomeProb, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, numBasesToVisit,
<a name="l01964"></a>01964         part1, part2, part3, rowBit, colBit, desired, undesired);
<a name="l01965"></a>01965 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afc4dcedaf429d823f4da83d3521d8293"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_collapseToKnownProbOutcomeKernel" ref="afc4dcedaf429d823f4da83d3521d8293" args="(qreal outcomeProb, qreal *vecReal, qreal *vecImag, long long int numBasesToVisit, long long int part1, long long int part2, long long int part3, long long int rowBit, long long int colBit, long long int desired, long long int undesired)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void densmatr_collapseToKnownProbOutcomeKernel </td>
          <td>(</td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>outcomeProb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecImag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>numBasesToVisit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>rowBit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>colBit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>desired</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>undesired</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Maps thread ID to a |..0. </p>
<p>.&gt;&lt;..0..| state and then locates |0&gt;&lt;1|, |1&gt;&lt;0| and |1&gt;&lt;1| </p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01912">1912</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01916"></a>01916 {
<a name="l01917"></a>01917     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> scanInd = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01918"></a>01918     <span class="keywordflow">if</span> (scanInd &gt;= numBasesToVisit) <span class="keywordflow">return</span>;
<a name="l01919"></a>01919     
<a name="l01920"></a>01920     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> base = (scanInd&amp;part1) + ((scanInd&amp;part2)&lt;&lt;1) + ((scanInd&amp;part3)&lt;&lt;2);
<a name="l01921"></a>01921     
<a name="l01922"></a>01922     <span class="comment">// renormalise desired outcome</span>
<a name="l01923"></a>01923     vecReal[base + desired] /= outcomeProb;
<a name="l01924"></a>01924     vecImag[base + desired] /= outcomeProb;
<a name="l01925"></a>01925     
<a name="l01926"></a>01926     <span class="comment">// kill undesired outcome</span>
<a name="l01927"></a>01927     vecReal[base + undesired] = 0;
<a name="l01928"></a>01928     vecImag[base + undesired] = 0;
<a name="l01929"></a>01929     
<a name="l01930"></a>01930     <span class="comment">// kill |..0..&gt;&lt;..1..| states</span>
<a name="l01931"></a>01931     vecReal[base + colBit] = 0;
<a name="l01932"></a>01932     vecImag[base + colBit] = 0;
<a name="l01933"></a>01933     vecReal[base + rowBit] = 0;
<a name="l01934"></a>01934     vecImag[base + rowBit] = 0;
<a name="l01935"></a>01935 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afbb044d76bf22d5c81a2a70a977f29bc"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_findProbabilityOfZero" ref="afbb044d76bf22d5c81a2a70a977f29bc" args="(Qureg qureg, const int measureQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">qreal densmatr_findProbabilityOfZero </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>measureQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01466">1466</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l01353">copySharedReduceBlock()</a>, <a class="el" href="QuEST_8h_source.html#l00107">Qureg::firstLevelReduction</a>, <a class="el" href="QuEST_8h_source.html#l00086">Qureg::numQubitsRepresented</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00015">REDUCE_SHARED_SIZE</a>, <a class="el" href="QuEST_8h_source.html#l00107">Qureg::secondLevelReduction</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01459">swapDouble()</a>.</p>

<p>Referenced by <a class="el" href="QuEST__gpu_8cu_source.html#l01560">densmatr_calcProbOfOutcome()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01467"></a>01467 {
<a name="l01468"></a>01468     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> densityDim = 1LL &lt;&lt; qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>;
<a name="l01469"></a>01469     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numValuesToReduce = densityDim &gt;&gt; 1;  <span class="comment">// half of the diagonal has measureQubit=0</span>
<a name="l01470"></a>01470     
<a name="l01471"></a>01471     <span class="keywordtype">int</span> valuesPerCUDABlock, numCUDABlocks, sharedMemSize;
<a name="l01472"></a>01472     <span class="keywordtype">int</span> maxReducedPerLevel = <a class="code" href="QuEST__gpu_8cu.html#aa57d77a0903e334e963c66ddc5ed3f53">REDUCE_SHARED_SIZE</a>;
<a name="l01473"></a>01473     <span class="keywordtype">int</span> firstTime = 1;
<a name="l01474"></a>01474     
<a name="l01475"></a>01475     <span class="keywordflow">while</span> (numValuesToReduce &gt; 1) {
<a name="l01476"></a>01476         
<a name="l01477"></a>01477         <span class="comment">// need less than one CUDA-BLOCK to reduce</span>
<a name="l01478"></a>01478         <span class="keywordflow">if</span> (numValuesToReduce &lt; maxReducedPerLevel) {
<a name="l01479"></a>01479             valuesPerCUDABlock = numValuesToReduce;
<a name="l01480"></a>01480             numCUDABlocks = 1;
<a name="l01481"></a>01481         }
<a name="l01482"></a>01482         <span class="comment">// otherwise use only full CUDA-BLOCKS</span>
<a name="l01483"></a>01483         <span class="keywordflow">else</span> {
<a name="l01484"></a>01484             valuesPerCUDABlock = maxReducedPerLevel; <span class="comment">// constrained by shared memory</span>
<a name="l01485"></a>01485             numCUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)numValuesToReduce/valuesPerCUDABlock);
<a name="l01486"></a>01486         }
<a name="l01487"></a>01487         
<a name="l01488"></a>01488         sharedMemSize = valuesPerCUDABlock*<span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>);
<a name="l01489"></a>01489         
<a name="l01490"></a>01490         <span class="comment">// spawn threads to sum the probs in each block</span>
<a name="l01491"></a>01491         <span class="keywordflow">if</span> (firstTime) {
<a name="l01492"></a>01492             densmatr_findProbabilityOfZeroKernel&lt;&lt;&lt;numCUDABlocks, valuesPerCUDABlock, sharedMemSize&gt;&gt;&gt;(
<a name="l01493"></a>01493                 qureg, measureQubit, qureg.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>);
<a name="l01494"></a>01494             firstTime = 0;
<a name="l01495"></a>01495             
<a name="l01496"></a>01496         <span class="comment">// sum the block probs</span>
<a name="l01497"></a>01497         } <span class="keywordflow">else</span> {
<a name="l01498"></a>01498             cudaDeviceSynchronize();    
<a name="l01499"></a>01499             <a class="code" href="QuEST__gpu_8cu.html#aea20d173141544e6c5359955a1fbe997">copySharedReduceBlock</a>&lt;&lt;&lt;numCUDABlocks, valuesPerCUDABlock/2, sharedMemSize&gt;&gt;&gt;(
<a name="l01500"></a>01500                     qureg.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>, 
<a name="l01501"></a>01501                     qureg.<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>, valuesPerCUDABlock); 
<a name="l01502"></a>01502             cudaDeviceSynchronize();    
<a name="l01503"></a>01503             <a class="code" href="QuEST__gpu_8cu.html#a31772904f024efd8d75a022e84c8207b">swapDouble</a>(&amp;(qureg.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>), &amp;(qureg.<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>));
<a name="l01504"></a>01504         }
<a name="l01505"></a>01505         
<a name="l01506"></a>01506         numValuesToReduce = numValuesToReduce/maxReducedPerLevel;
<a name="l01507"></a>01507     }
<a name="l01508"></a>01508     
<a name="l01509"></a>01509     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> zeroProb;
<a name="l01510"></a>01510     cudaMemcpy(&amp;zeroProb, qureg.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>, <span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>), cudaMemcpyDeviceToHost);
<a name="l01511"></a>01511     <span class="keywordflow">return</span> zeroProb;
<a name="l01512"></a>01512 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3414d9307ecfd0caa2be560a00eb7c61"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_findProbabilityOfZeroKernel" ref="a3414d9307ecfd0caa2be560a00eb7c61" args="(Qureg qureg, const int measureQubit, qreal *reducedArray)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void densmatr_findProbabilityOfZeroKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>measureQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>reducedArray</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01362">1362</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00086">Qureg::numQubitsRepresented</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01334">reduceBlock()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01364"></a>01364   {
<a name="l01365"></a>01365     <span class="comment">// run by each thread</span>
<a name="l01366"></a>01366     <span class="comment">// use of block here refers to contiguous amplitudes where measureQubit = 0, </span>
<a name="l01367"></a>01367     <span class="comment">// (then =1) and NOT the CUDA block, which is the partitioning of CUDA threads</span>
<a name="l01368"></a>01368     
<a name="l01369"></a>01369     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> densityDim    = 1LL &lt;&lt; qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>;
<a name="l01370"></a>01370     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numTasks      = densityDim &gt;&gt; 1;
<a name="l01371"></a>01371     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeHalfBlock = 1LL &lt;&lt; (measureQubit);
<a name="l01372"></a>01372     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock     = 2LL * sizeHalfBlock;
<a name="l01373"></a>01373     
<a name="l01374"></a>01374     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock;    <span class="comment">// which block this thread is processing</span>
<a name="l01375"></a>01375     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisTask;     <span class="comment">// which part of the block this thread is processing</span>
<a name="l01376"></a>01376     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> basisIndex;   <span class="comment">// index of this thread&apos;s computational basis state</span>
<a name="l01377"></a>01377     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> densityIndex; <span class="comment">// &quot; &quot; index of |basis&gt;&lt;basis| in the flat density matrix</span>
<a name="l01378"></a>01378     
<a name="l01379"></a>01379     <span class="comment">// array of each thread&apos;s collected probability, to be summed</span>
<a name="l01380"></a>01380     <span class="keyword">extern</span> __shared__ <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> tempReductionArray[];
<a name="l01381"></a>01381     
<a name="l01382"></a>01382     <span class="comment">// figure out which density matrix prob that this thread is assigned</span>
<a name="l01383"></a>01383     thisTask = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01384"></a>01384     <span class="keywordflow">if</span> (thisTask&gt;=numTasks) <span class="keywordflow">return</span>;
<a name="l01385"></a>01385     thisBlock = thisTask / sizeHalfBlock;
<a name="l01386"></a>01386     basisIndex = thisBlock*sizeBlock + thisTask%sizeHalfBlock;
<a name="l01387"></a>01387     densityIndex = (densityDim + 1) * basisIndex;
<a name="l01388"></a>01388     
<a name="l01389"></a>01389     <span class="comment">// record the probability in the CUDA-BLOCK-wide array</span>
<a name="l01390"></a>01390     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> prob = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real[densityIndex];   <span class="comment">// im[densityIndex] assumed ~ 0</span>
<a name="l01391"></a>01391     tempReductionArray[threadIdx.x] = prob;
<a name="l01392"></a>01392     
<a name="l01393"></a>01393     <span class="comment">// sum the probs collected by this CUDA-BLOCK&apos;s threads into a per-CUDA-BLOCK array</span>
<a name="l01394"></a>01394     __syncthreads();
<a name="l01395"></a>01395     <span class="keywordflow">if</span> (threadIdx.x&lt;blockDim.x/2){
<a name="l01396"></a>01396         <a class="code" href="QuEST__gpu_8cu.html#ac82f3dbf68f877f57d4abbb72fae1254">reduceBlock</a>(tempReductionArray, reducedArray, blockDim.x);
<a name="l01397"></a>01397     }
<a name="l01398"></a>01398 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a20a155f53efc45c16803d7539c2c199d"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_initClassicalState" ref="a20a155f53efc45c16803d7539c2c199d" args="(Qureg qureg, long long int stateInd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void densmatr_initClassicalState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>stateInd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00138">138</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST_8h_source.html#l00086">Qureg::numQubitsRepresented</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00107">initClassicalState()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00139"></a>00139 {
<a name="l00140"></a>00140     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00141"></a>00141     threadsPerCUDABlock = 128;
<a name="l00142"></a>00142     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l00143"></a>00143     
<a name="l00144"></a>00144     <span class="comment">// index of the desired state in the flat density matrix</span>
<a name="l00145"></a>00145     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> densityDim = 1LL &lt;&lt; qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>;
<a name="l00146"></a>00146     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> densityInd = (densityDim + 1)*stateInd;
<a name="l00147"></a>00147     
<a name="l00148"></a>00148     <span class="comment">// identical to pure version</span>
<a name="l00149"></a>00149     densmatr_initClassicalStateKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l00150"></a>00150         qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>, 
<a name="l00151"></a>00151         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, 
<a name="l00152"></a>00152         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, densityInd);
<a name="l00153"></a>00153 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9f4bb112d5e95abb8e35bf051a02a06e"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_initClassicalStateKernel" ref="a9f4bb112d5e95abb8e35bf051a02a06e" args="(long long int densityNumElems, qreal *densityReal, qreal *densityImag, long long int densityInd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void densmatr_initClassicalStateKernel </td>
          <td>(</td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>densityNumElems</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>densityReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>densityImag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>densityInd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00119">119</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00123"></a>00123 {
<a name="l00124"></a>00124     <span class="comment">// initialise the state to all zeros</span>
<a name="l00125"></a>00125     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00126"></a>00126     <span class="keywordflow">if</span> (index &gt;= densityNumElems) <span class="keywordflow">return</span>;
<a name="l00127"></a>00127     
<a name="l00128"></a>00128     densityReal[index] = 0.0;
<a name="l00129"></a>00129     densityImag[index] = 0.0;
<a name="l00130"></a>00130     
<a name="l00131"></a>00131     <span class="keywordflow">if</span> (index==densityInd){
<a name="l00132"></a>00132         <span class="comment">// classical state has probability 1</span>
<a name="l00133"></a>00133         densityReal[densityInd] = 1.0;
<a name="l00134"></a>00134         densityImag[densityInd] = 0.0;
<a name="l00135"></a>00135     }
<a name="l00136"></a>00136 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad5b2ac0b00afa495f385520b2c5fa839"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_initPlusState" ref="ad5b2ac0b00afa495f385520b2c5fa839" args="(Qureg qureg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void densmatr_initPlusState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00106">106</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST_8h_source.html#l00086">Qureg::numQubitsRepresented</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00098">initPlusState()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00107"></a>00107 {
<a name="l00108"></a>00108     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> probFactor = 1.0/((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>) (1LL &lt;&lt; qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>));
<a name="l00109"></a>00109     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00110"></a>00110     threadsPerCUDABlock = 128;
<a name="l00111"></a>00111     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l00112"></a>00112     densmatr_initPlusStateKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l00113"></a>00113         qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>, 
<a name="l00114"></a>00114         probFactor,
<a name="l00115"></a>00115         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, 
<a name="l00116"></a>00116         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag);
<a name="l00117"></a>00117 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4cf98d55602d1138a2101c158095afdc"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_initPlusStateKernel" ref="a4cf98d55602d1138a2101c158095afdc" args="(long long int stateVecSize, qreal probFactor, qreal *stateVecReal, qreal *stateVecImag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void densmatr_initPlusStateKernel </td>
          <td>(</td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>stateVecSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>probFactor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>stateVecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>stateVecImag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00096">96</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00096"></a>00096                                                                                                                                     {
<a name="l00097"></a>00097     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00100"></a>00100     <span class="keywordflow">if</span> (index&gt;=stateVecSize) <span class="keywordflow">return</span>;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     stateVecReal[index] = probFactor;
<a name="l00103"></a>00103     stateVecImag[index] = 0.0;
<a name="l00104"></a>00104 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae5ad68d054875913d0f7ec654840a9ec"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_initPureState" ref="ae5ad68d054875913d0f7ec654840a9ec" args="(Qureg targetQureg, Qureg copyQureg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void densmatr_initPureState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>targetQureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>copyQureg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00085">85</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00119">initPureState()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00086"></a>00086 {
<a name="l00087"></a>00087     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00088"></a>00088     threadsPerCUDABlock = 128;
<a name="l00089"></a>00089     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(copyQureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l00090"></a>00090     densmatr_initPureStateKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l00091"></a>00091         copyQureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>,
<a name="l00092"></a>00092         targetQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, targetQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag,
<a name="l00093"></a>00093         copyQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real,   copyQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag);
<a name="l00094"></a>00094 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a664339e2afc50b0418a56adfc1bc512e"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_initPureStateKernel" ref="a664339e2afc50b0418a56adfc1bc512e" args="(long long int numPureAmps, qreal *targetVecReal, qreal *targetVecImag, qreal *copyVecReal, qreal *copyVecImag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void densmatr_initPureStateKernel </td>
          <td>(</td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>numPureAmps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>targetVecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>targetVecImag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>copyVecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>copyVecImag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00066">66</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00070"></a>00070 {
<a name="l00071"></a>00071     <span class="comment">// this is a particular index of the pure copyQureg</span>
<a name="l00072"></a>00072     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00073"></a>00073     <span class="keywordflow">if</span> (index&gt;=numPureAmps) <span class="keywordflow">return</span>;
<a name="l00074"></a>00074     
<a name="l00075"></a>00075     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> realRow = copyVecReal[index];
<a name="l00076"></a>00076     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> imagRow = copyVecImag[index];
<a name="l00077"></a>00077     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> col=0; col &lt; numPureAmps; col++) {
<a name="l00078"></a>00078         <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> realCol =   copyVecReal[col];
<a name="l00079"></a>00079         <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> imagCol = - copyVecImag[col]; <span class="comment">// minus for conjugation</span>
<a name="l00080"></a>00080         targetVecReal[col*numPureAmps + index] = realRow*realCol - imagRow*imagCol;
<a name="l00081"></a>00081         targetVecImag[col*numPureAmps + index] = realRow*imagCol + imagRow*realCol;
<a name="l00082"></a>00082     }
<a name="l00083"></a>00083 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a56b32228c24a7c4e1894d991ef4b6b99"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_oneQubitDephase" ref="a56b32228c24a7c4e1894d991ef4b6b99" args="(Qureg qureg, const int targetQubit, qreal dephase)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void densmatr_oneQubitDephase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>dephase</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l02011">2011</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST_8h_source.html#l00086">Qureg::numQubitsRepresented</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00645">applyOneQubitDephaseError()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l02127">densmatr_oneQubitDepolarise()</a>, and <a class="el" href="QuEST__cpu_8c_source.html#l00159">densmatr_oneQubitDepolariseDistributed()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02011"></a>02011                                                                                  {
<a name="l02012"></a>02012     
<a name="l02013"></a>02013     <span class="keywordflow">if</span> (dephase == 0)
<a name="l02014"></a>02014         <span class="keywordflow">return</span>;
<a name="l02015"></a>02015     
<a name="l02016"></a>02016     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numAmpsToVisit = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>/4;
<a name="l02017"></a>02017     
<a name="l02018"></a>02018     <span class="keywordtype">int</span> rowQubit = targetQubit + qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>;
<a name="l02019"></a>02019     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> colBit = 1LL &lt;&lt; targetQubit;
<a name="l02020"></a>02020     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> rowBit = 1LL &lt;&lt; rowQubit;
<a name="l02021"></a>02021     
<a name="l02022"></a>02022     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part1 = colBit - 1;
<a name="l02023"></a>02023     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part2 = (rowBit &gt;&gt; 1) - colBit;
<a name="l02024"></a>02024     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part3 = numAmpsToVisit - (rowBit &gt;&gt; 1);
<a name="l02025"></a>02025     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> dephFac = 1 - dephase;
<a name="l02026"></a>02026     
<a name="l02027"></a>02027     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l02028"></a>02028     threadsPerCUDABlock = 128;
<a name="l02029"></a>02029     CUDABlocks = ceil(numAmpsToVisit / (<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>) threadsPerCUDABlock);
<a name="l02030"></a>02030     densmatr_oneQubitDephaseKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l02031"></a>02031         dephFac, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, numAmpsToVisit,
<a name="l02032"></a>02032         part1, part2, part3, colBit, rowBit);
<a name="l02033"></a>02033 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a30533aceb5c9a03be270633c8416965f"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_oneQubitDephaseKernel" ref="a30533aceb5c9a03be270633c8416965f" args="(qreal fac, qreal *vecReal, qreal *vecImag, long long int numAmpsToVisit, long long int part1, long long int part2, long long int part3, long long int colBit, long long int rowBit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void densmatr_oneQubitDephaseKernel </td>
          <td>(</td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>fac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecImag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>numAmpsToVisit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>colBit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>rowBit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Called once for every 4 amplitudes in density matrix Works by establishing the |..0. </p>
<p>.&gt;&lt;..0..| state (for its given index) then visiting |..1..&gt;&lt;..0..| and |..0..&gt;&lt;..1..|. Labels |part1 X pa&gt;&lt;rt2 NOT(X) part3| From the brain of Simon Benjamin </p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01996">1996</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02000"></a>02000 {
<a name="l02001"></a>02001     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> scanInd = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l02002"></a>02002     <span class="keywordflow">if</span> (scanInd &gt;= numAmpsToVisit) <span class="keywordflow">return</span>;
<a name="l02003"></a>02003     
<a name="l02004"></a>02004     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> ampInd = (scanInd&amp;part1) + ((scanInd&amp;part2)&lt;&lt;1) + ((scanInd&amp;part3)&lt;&lt;2);
<a name="l02005"></a>02005     vecReal[ampInd + colBit] *= fac;
<a name="l02006"></a>02006     vecImag[ampInd + colBit] *= fac;
<a name="l02007"></a>02007     vecReal[ampInd + rowBit] *= fac;
<a name="l02008"></a>02008     vecImag[ampInd + rowBit] *= fac;
<a name="l02009"></a>02009 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae5bf84ca607e1484e0ddb5570726848d"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_oneQubitDepolarise" ref="ae5bf84ca607e1484e0ddb5570726848d" args="(Qureg qureg, const int targetQubit, qreal depolLevel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void densmatr_oneQubitDepolarise </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>depolLevel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l02127">2127</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__cpu_8c_source.html#l00036">densmatr_oneQubitDephase()</a>, <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST_8h_source.html#l00086">Qureg::numQubitsRepresented</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00662">applyOneQubitDepolariseError()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02127"></a>02127                                                                                        {
<a name="l02128"></a>02128     
<a name="l02129"></a>02129     <span class="keywordflow">if</span> (depolLevel == 0)
<a name="l02130"></a>02130         <span class="keywordflow">return</span>;
<a name="l02131"></a>02131     
<a name="l02132"></a>02132     <a class="code" href="QuEST__internal_8h.html#a56b32228c24a7c4e1894d991ef4b6b99">densmatr_oneQubitDephase</a>(qureg, targetQubit, depolLevel);
<a name="l02133"></a>02133     
<a name="l02134"></a>02134     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numAmpsToVisit = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>/4;
<a name="l02135"></a>02135     <span class="keywordtype">int</span> rowQubit = targetQubit + qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>;
<a name="l02136"></a>02136     
<a name="l02137"></a>02137     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> colBit = 1LL &lt;&lt; targetQubit;
<a name="l02138"></a>02138     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> rowBit = 1LL &lt;&lt; rowQubit;
<a name="l02139"></a>02139     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> bothBits = colBit | rowBit;
<a name="l02140"></a>02140     
<a name="l02141"></a>02141     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part1 = colBit - 1;
<a name="l02142"></a>02142     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part2 = (rowBit &gt;&gt; 1) - colBit;
<a name="l02143"></a>02143     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part3 = numAmpsToVisit - (rowBit &gt;&gt; 1);
<a name="l02144"></a>02144     
<a name="l02145"></a>02145     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l02146"></a>02146     threadsPerCUDABlock = 128;
<a name="l02147"></a>02147     CUDABlocks = ceil(numAmpsToVisit / (<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>) threadsPerCUDABlock);
<a name="l02148"></a>02148     densmatr_oneQubitDepolariseKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l02149"></a>02149         depolLevel, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, numAmpsToVisit,
<a name="l02150"></a>02150         part1, part2, part3, bothBits);
<a name="l02151"></a>02151 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0a3a7bb274a939766fee5cbb5871398d"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_oneQubitDepolariseKernel" ref="a0a3a7bb274a939766fee5cbb5871398d" args="(qreal depolLevel, qreal *vecReal, qreal *vecImag, long long int numAmpsToVisit, long long int part1, long long int part2, long long int part3, long long int bothBits)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void densmatr_oneQubitDepolariseKernel </td>
          <td>(</td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>depolLevel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecImag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>numAmpsToVisit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>bothBits</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Works like oneQubitDephase but modifies every other element, and elements are averaged in pairs. </p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l02102">2102</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02106"></a>02106 {
<a name="l02107"></a>02107     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> scanInd = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l02108"></a>02108     <span class="keywordflow">if</span> (scanInd &gt;= numAmpsToVisit) <span class="keywordflow">return</span>;
<a name="l02109"></a>02109     
<a name="l02110"></a>02110     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> baseInd = (scanInd&amp;part1) + ((scanInd&amp;part2)&lt;&lt;1) + ((scanInd&amp;part3)&lt;&lt;2);
<a name="l02111"></a>02111     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> targetInd = baseInd + bothBits;
<a name="l02112"></a>02112     
<a name="l02113"></a>02113     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> realAvDepol = depolLevel * 0.5 * (vecReal[baseInd] + vecReal[targetInd]);
<a name="l02114"></a>02114     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> imagAvDepol = depolLevel * 0.5 * (vecImag[baseInd] + vecImag[targetInd]);
<a name="l02115"></a>02115     
<a name="l02116"></a>02116     vecReal[baseInd]   *= 1 - depolLevel;
<a name="l02117"></a>02117     vecImag[baseInd]   *= 1 - depolLevel;
<a name="l02118"></a>02118     vecReal[targetInd] *= 1 - depolLevel;
<a name="l02119"></a>02119     vecImag[targetInd] *= 1 - depolLevel;
<a name="l02120"></a>02120     
<a name="l02121"></a>02121     vecReal[baseInd]   += realAvDepol;
<a name="l02122"></a>02122     vecImag[baseInd]   += imagAvDepol;
<a name="l02123"></a>02123     vecReal[targetInd] += realAvDepol;
<a name="l02124"></a>02124     vecImag[targetInd] += imagAvDepol;
<a name="l02125"></a>02125 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9dc44ff714f25796d82286ae5202fe7a"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_twoQubitDephase" ref="a9dc44ff714f25796d82286ae5202fe7a" args="(Qureg qureg, int qubit1, int qubit2, qreal dephase)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void densmatr_twoQubitDephase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>qubit1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>qubit2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>dephase</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l02065">2065</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST_8h_source.html#l00086">Qureg::numQubitsRepresented</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00653">applyTwoQubitDephaseError()</a>, and <a class="el" href="QuEST__cpu__distributed_8c_source.html#l00703">densmatr_twoQubitDepolarise()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02065"></a>02065                                                                                   {
<a name="l02066"></a>02066     
<a name="l02067"></a>02067     <span class="keywordflow">if</span> (dephase == 0)
<a name="l02068"></a>02068         <span class="keywordflow">return</span>;
<a name="l02069"></a>02069     
<a name="l02070"></a>02070     <span class="comment">// assumes qubit2 &gt; qubit1</span>
<a name="l02071"></a>02071     
<a name="l02072"></a>02072     <span class="keywordtype">int</span> rowQubit1 = qubit1 + qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>;
<a name="l02073"></a>02073     <span class="keywordtype">int</span> rowQubit2 = qubit2 + qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>;
<a name="l02074"></a>02074     
<a name="l02075"></a>02075     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> colBit1 = 1LL &lt;&lt; qubit1;
<a name="l02076"></a>02076     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> rowBit1 = 1LL &lt;&lt; rowQubit1;
<a name="l02077"></a>02077     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> colBit2 = 1LL &lt;&lt; qubit2;
<a name="l02078"></a>02078     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> rowBit2 = 1LL &lt;&lt; rowQubit2;
<a name="l02079"></a>02079     
<a name="l02080"></a>02080     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part1 = colBit1 - 1;
<a name="l02081"></a>02081     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part2 = (colBit2 &gt;&gt; 1) - colBit1;
<a name="l02082"></a>02082     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part3 = (rowBit1 &gt;&gt; 2) - (colBit2 &gt;&gt; 1);
<a name="l02083"></a>02083     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part4 = (rowBit2 &gt;&gt; 3) - (rowBit1 &gt;&gt; 2);
<a name="l02084"></a>02084     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part5 = (qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>/16) - (rowBit2 &gt;&gt; 3);
<a name="l02085"></a>02085     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> dephFac = 1 - dephase;
<a name="l02086"></a>02086     
<a name="l02087"></a>02087     <span class="comment">// refers to states |a 0 b 0 c&gt;&lt;d 0 e 0 f| (target qubits are fixed)</span>
<a name="l02088"></a>02088     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numBackgroundStates = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>/16;
<a name="l02089"></a>02089     
<a name="l02090"></a>02090     <span class="comment">// 12 of these states experience dephasing</span>
<a name="l02091"></a>02091     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numAmpsToVisit = 12 * numBackgroundStates;
<a name="l02092"></a>02092     
<a name="l02093"></a>02093     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l02094"></a>02094     threadsPerCUDABlock = 128;
<a name="l02095"></a>02095     CUDABlocks = ceil(numAmpsToVisit / (<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>) threadsPerCUDABlock);
<a name="l02096"></a>02096     densmatr_twoQubitDephaseKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l02097"></a>02097         dephFac, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, numBackgroundStates, numAmpsToVisit,
<a name="l02098"></a>02098         part1, part2, part3, part4, part5, colBit1, rowBit1, colBit2, rowBit2);
<a name="l02099"></a>02099 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afb969c7a2f5693c1a53c922f0ed88de9"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_twoQubitDephaseKernel" ref="afb969c7a2f5693c1a53c922f0ed88de9" args="(qreal fac, qreal *vecReal, qreal *vecImag, long long int numBackgroundStates, long long int numAmpsToVisit, long long int part1, long long int part2, long long int part3, long long int part4, long long int part5, long long int colBit1, long long int rowBit1, long long int colBit2, long long int rowBit2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void densmatr_twoQubitDephaseKernel </td>
          <td>(</td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>fac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecImag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>numBackgroundStates</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>numAmpsToVisit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part4</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part5</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>colBit1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>rowBit1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>colBit2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>rowBit2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Called 12 times for every 16 amplitudes in density matrix Each sums from the |..0..0. </p>
<p>.&gt;&lt;..0..0..| index to visit either |..0..0..&gt;&lt;..0..1..|, |..0..0..&gt;&lt;..1..0..|, |..0..0..&gt;&lt;..1..1..|, |..0..1..&gt;&lt;..0..0..| etc and so on to |..1..1..&gt;&lt;..1..0|. Labels |part1 0 part2 0 par&gt;&lt;t3 0 part4 0 part5|. From the brain of Simon Benjamin </p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l02041">2041</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02045"></a>02045 {
<a name="l02046"></a>02046     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> outerInd = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l02047"></a>02047     <span class="keywordflow">if</span> (outerInd &gt;= numAmpsToVisit) <span class="keywordflow">return</span>;
<a name="l02048"></a>02048     
<a name="l02049"></a>02049     <span class="comment">// sets meta in 1...14 excluding 5, 10, creating bit string DCBA for |..D..C..&gt;&lt;..B..A|</span>
<a name="l02050"></a>02050     <span class="keywordtype">int</span> meta = 1 + (outerInd/numBackgroundStates);
<a name="l02051"></a>02051     <span class="keywordflow">if</span> (meta &gt; 4) meta++;
<a name="l02052"></a>02052     <span class="keywordflow">if</span> (meta &gt; 9) meta++;
<a name="l02053"></a>02053     
<a name="l02054"></a>02054     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> shift = rowBit2*((meta&gt;&gt;3)%2) + rowBit1*((meta&gt;&gt;2)%2) + colBit2*((meta&gt;&gt;1)%2) + colBit1*(meta%2);
<a name="l02055"></a>02055     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> scanInd = outerInd % numBackgroundStates;
<a name="l02056"></a>02056     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> stateInd = (
<a name="l02057"></a>02057         shift + 
<a name="l02058"></a>02058         (scanInd&amp;part1) + ((scanInd&amp;part2)&lt;&lt;1) + ((scanInd&amp;part3)&lt;&lt;2) + ((scanInd&amp;part4)&lt;&lt;3) + ((scanInd&amp;part5)&lt;&lt;4));
<a name="l02059"></a>02059     
<a name="l02060"></a>02060     vecReal[stateInd] *= fac;
<a name="l02061"></a>02061     vecImag[stateInd] *= fac;
<a name="l02062"></a>02062 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa500e14a9ed1683f9c056f03f4c24cea"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_twoQubitDepolarise" ref="aa500e14a9ed1683f9c056f03f4c24cea" args="(Qureg qureg, int qubit1, int qubit2, qreal depolLevel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void densmatr_twoQubitDepolarise </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>qubit1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>qubit2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>depolLevel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l02186">2186</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__cpu_8c_source.html#l00069">densmatr_twoQubitDephase()</a>, <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST_8h_source.html#l00086">Qureg::numQubitsRepresented</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00670">applyTwoQubitDepolariseError()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02186"></a>02186                                                                                         {
<a name="l02187"></a>02187     
<a name="l02188"></a>02188     <span class="keywordflow">if</span> (depolLevel == 0)
<a name="l02189"></a>02189         <span class="keywordflow">return</span>;
<a name="l02190"></a>02190     
<a name="l02191"></a>02191     <span class="comment">// assumes qubit2 &gt; qubit1</span>
<a name="l02192"></a>02192     
<a name="l02193"></a>02193     <a class="code" href="QuEST__internal_8h.html#a8fde996ce8ba014fce542549406813f9">densmatr_twoQubitDephase</a>(qureg, qubit1, qubit2, depolLevel);
<a name="l02194"></a>02194     
<a name="l02195"></a>02195     <span class="keywordtype">int</span> rowQubit1 = qubit1 + qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>;
<a name="l02196"></a>02196     <span class="keywordtype">int</span> rowQubit2 = qubit2 + qureg.<a class="code" href="structQureg.html#ad08dff5316b8937f4b2a1417591543dc" title="The number of qubits represented in either the state-vector or density matrix.">numQubitsRepresented</a>;
<a name="l02197"></a>02197     
<a name="l02198"></a>02198     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> colBit1 = 1LL &lt;&lt; qubit1;
<a name="l02199"></a>02199     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> rowBit1 = 1LL &lt;&lt; rowQubit1;
<a name="l02200"></a>02200     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> colBit2 = 1LL &lt;&lt; qubit2;
<a name="l02201"></a>02201     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> rowBit2 = 1LL &lt;&lt; rowQubit2;
<a name="l02202"></a>02202     
<a name="l02203"></a>02203     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> rowCol1 = colBit1 | rowBit1;
<a name="l02204"></a>02204     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> rowCol2 = colBit2 | rowBit2;
<a name="l02205"></a>02205     
<a name="l02206"></a>02206     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numAmpsToVisit = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>/16;
<a name="l02207"></a>02207     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part1 = colBit1 - 1;
<a name="l02208"></a>02208     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part2 = (colBit2 &gt;&gt; 1) - colBit1;
<a name="l02209"></a>02209     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part3 = (rowBit1 &gt;&gt; 2) - (colBit2 &gt;&gt; 1);
<a name="l02210"></a>02210     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part4 = (rowBit2 &gt;&gt; 3) - (rowBit1 &gt;&gt; 2);
<a name="l02211"></a>02211     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> part5 = numAmpsToVisit - (rowBit2 &gt;&gt; 3);
<a name="l02212"></a>02212     
<a name="l02213"></a>02213     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l02214"></a>02214     threadsPerCUDABlock = 128;
<a name="l02215"></a>02215     CUDABlocks = ceil(numAmpsToVisit / (<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>) threadsPerCUDABlock);
<a name="l02216"></a>02216     densmatr_twoQubitDepolariseKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l02217"></a>02217         depolLevel, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, numAmpsToVisit,
<a name="l02218"></a>02218         part1, part2, part3, part4, part5, rowCol1, rowCol2);
<a name="l02219"></a>02219 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a207113dd5e09aafbb9b435695cfcdc6e"></a><!-- doxytag: member="QuEST_gpu.cu::densmatr_twoQubitDepolariseKernel" ref="a207113dd5e09aafbb9b435695cfcdc6e" args="(qreal depolLevel, qreal *vecReal, qreal *vecImag, long long int numAmpsToVisit, long long int part1, long long int part2, long long int part3, long long int part4, long long int part5, long long int rowCol1, long long int rowCol2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void densmatr_twoQubitDepolariseKernel </td>
          <td>(</td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>depolLevel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecImag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>numAmpsToVisit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part4</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>part5</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>rowCol1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>rowCol2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Called once for every 16 amplitudes. </p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l02154">2154</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02159"></a>02159 {
<a name="l02160"></a>02160     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> scanInd = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l02161"></a>02161     <span class="keywordflow">if</span> (scanInd &gt;= numAmpsToVisit) <span class="keywordflow">return</span>;
<a name="l02162"></a>02162     
<a name="l02163"></a>02163     <span class="comment">// index of |..0..0..&gt;&lt;..0..0|</span>
<a name="l02164"></a>02164     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> ind00 = (scanInd&amp;part1) + ((scanInd&amp;part2)&lt;&lt;1) + ((scanInd&amp;part3)&lt;&lt;2) + ((scanInd&amp;part4)&lt;&lt;3) + ((scanInd&amp;part5)&lt;&lt;4);
<a name="l02165"></a>02165     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> ind01 = ind00 + rowCol1;
<a name="l02166"></a>02166     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> ind10 = ind00 + rowCol2;
<a name="l02167"></a>02167     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> ind11 = ind00 + rowCol1 + rowCol2;
<a name="l02168"></a>02168     
<a name="l02169"></a>02169     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> realAvDepol = depolLevel * 0.25 * (
<a name="l02170"></a>02170         vecReal[ind00] + vecReal[ind01] + vecReal[ind10] + vecReal[ind11]);
<a name="l02171"></a>02171     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> imagAvDepol = depolLevel * 0.25 * (
<a name="l02172"></a>02172         vecImag[ind00] + vecImag[ind01] + vecImag[ind10] + vecImag[ind11]);
<a name="l02173"></a>02173     
<a name="l02174"></a>02174     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> retain = 1 - depolLevel;
<a name="l02175"></a>02175     vecReal[ind00] *= retain; vecImag[ind00] *= retain;
<a name="l02176"></a>02176     vecReal[ind01] *= retain; vecImag[ind01] *= retain;
<a name="l02177"></a>02177     vecReal[ind10] *= retain; vecImag[ind10] *= retain;
<a name="l02178"></a>02178     vecReal[ind11] *= retain; vecImag[ind11] *= retain;
<a name="l02179"></a>02179 
<a name="l02180"></a>02180     vecReal[ind00] += realAvDepol; vecImag[ind00] += imagAvDepol;
<a name="l02181"></a>02181     vecReal[ind01] += realAvDepol; vecImag[ind01] += imagAvDepol;
<a name="l02182"></a>02182     vecReal[ind10] += realAvDepol; vecImag[ind10] += imagAvDepol;
<a name="l02183"></a>02183     vecReal[ind11] += realAvDepol; vecImag[ind11] += imagAvDepol;
<a name="l02184"></a>02184 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeff624226629d7063a8a776958a4f991"></a><!-- doxytag: member="QuEST_gpu.cu::destroyQuESTEnv" ref="aeff624226629d7063a8a776958a4f991" args="(QuESTEnv env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void destroyQuESTEnv </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td>
          <td class="paramname"> <em>env</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destroy the QuEST environment. </p>
<p>If something needs to be done to clean up the execution environment, such as finalizing MPI when running in distributed mode, it is handled here</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>object representing the execution environment. A single instance is used for each program </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00257">257</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00257"></a>00257                                   {
<a name="l00258"></a>00258     <span class="comment">// MPI finalize goes here in MPI version. Call this function anyway for consistency</span>
<a name="l00259"></a>00259 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6ffa51987d8ad8f6c0fc07fd3492277f"></a><!-- doxytag: member="QuEST_gpu.cu::extractBit" ref="a6ffa51987d8ad8f6c0fc07fd3492277f" args="(int locationOfBitFromRight, long long int theEncodedNumber)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static __device__ int extractBit </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>locationOfBitFromRight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>theEncodedNumber</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00019">19</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>Referenced by <a class="el" href="QuEST__gpu_8cu_source.html#l00593">statevec_controlledCompactUnitaryKernel()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01280">statevec_controlledNotKernel()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00946">statevec_controlledPauliYKernel()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01165">statevec_controlledPhaseFlipKernel()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01039">statevec_controlledPhaseShiftKernel()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00721">statevec_controlledUnitaryKernel()</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l00441">statevec_initStateOfSingleQubitKernel()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00020"></a>00020 {
<a name="l00021"></a>00021     <span class="keywordflow">return</span> (theEncodedNumber &amp; ( 1LL &lt;&lt; locationOfBitFromRight )) &gt;&gt; locationOfBitFromRight;
<a name="l00022"></a>00022 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2d955c6e51067371eee69795532a2d62"></a><!-- doxytag: member="QuEST_gpu.cu::getEnvironmentString" ref="a2d955c6e51067371eee69795532a2d62" args="(QuESTEnv env, Qureg qureg, char str[200])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void getEnvironmentString </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>str</em>[200]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00273">273</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00088">Qureg::numQubitsInStateVec</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00273"></a>00273                                                                    {
<a name="l00274"></a>00274     sprintf(str, <span class="stringliteral">&quot;%dqubits_GPU_noMpi_noOMP&quot;</span>, qureg.<a class="code" href="structQureg.html#a0a86e8a50ea8c998b4a0a6640c5a1218" title="Number of qubits in the state-vector - this is double the number represented for...">numQubitsInStateVec</a>);    
<a name="l00275"></a>00275 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a112c74b3365bda6697813d9931b55377"></a><!-- doxytag: member="QuEST_gpu.cu::getNumReductionLevels" ref="a112c74b3365bda6697813d9931b55377" args="(long long int numValuesToReduce, int numReducedPerLevel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int getNumReductionLevels </td>
          <td>(</td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>numValuesToReduce</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numReducedPerLevel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01450">1450</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01450"></a>01450                                                                                   {
<a name="l01451"></a>01451     <span class="keywordtype">int</span> levels=0;
<a name="l01452"></a>01452     <span class="keywordflow">while</span> (numValuesToReduce){
<a name="l01453"></a>01453         numValuesToReduce = numValuesToReduce/numReducedPerLevel;
<a name="l01454"></a>01454         levels++;
<a name="l01455"></a>01455     }
<a name="l01456"></a>01456     <span class="keywordflow">return</span> levels;
<a name="l01457"></a>01457 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0aabd5ed69a74e5bc0b46a17af45c886"></a><!-- doxytag: member="QuEST_gpu.cu::GPUExists" ref="a0aabd5ed69a74e5bc0b46a17af45c886" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GPUExists </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00216">216</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>Referenced by <a class="el" href="QuEST__gpu_8cu_source.html#l00233">createQuESTEnv()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00216"></a>00216                    {
<a name="l00217"></a>00217     <span class="keywordtype">int</span> deviceCount, device;
<a name="l00218"></a>00218     <span class="keywordtype">int</span> gpuDeviceCount = 0;
<a name="l00219"></a>00219     <span class="keyword">struct </span>cudaDeviceProp properties;
<a name="l00220"></a>00220     cudaError_t cudaResultCode = cudaGetDeviceCount(&amp;deviceCount);
<a name="l00221"></a>00221     <span class="keywordflow">if</span> (cudaResultCode != cudaSuccess) deviceCount = 0;
<a name="l00222"></a>00222     <span class="comment">/* machines with no GPUs can still report one emulation device */</span>
<a name="l00223"></a>00223     <span class="keywordflow">for</span> (device = 0; device &lt; deviceCount; ++device) {
<a name="l00224"></a>00224         cudaGetDeviceProperties(&amp;properties, device);
<a name="l00225"></a>00225         <span class="keywordflow">if</span> (properties.major != 9999) { <span class="comment">/* 9999 means emulation only */</span>
<a name="l00226"></a>00226             ++gpuDeviceCount;
<a name="l00227"></a>00227         }
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229     <span class="keywordflow">if</span> (gpuDeviceCount) <span class="keywordflow">return</span> 1;
<a name="l00230"></a>00230     <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;
<a name="l00231"></a>00231 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8ce1e311ea72b862a8757dc71082fbf3"></a><!-- doxytag: member="QuEST_gpu.cu::log2Int" ref="a8ce1e311ea72b862a8757dc71082fbf3" args="(unsigned int x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__device__ __host__ unsigned int log2Int </td>
          <td>(</td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>x</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01327">1327</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>Referenced by <a class="el" href="QuEST__gpu_8cu_source.html#l01334">reduceBlock()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01328"></a>01328 {
<a name="l01329"></a>01329     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ans = 0 ;
<a name="l01330"></a>01330     <span class="keywordflow">while</span>( <a class="code" href="README_8md.html#a6a52a27535805eddc782c67f42c20c69">x</a>&gt;&gt;=1 ) ans++;
<a name="l01331"></a>01331     <span class="keywordflow">return</span> ans ;
<a name="l01332"></a>01332 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac82f3dbf68f877f57d4abbb72fae1254"></a><!-- doxytag: member="QuEST_gpu.cu::reduceBlock" ref="ac82f3dbf68f877f57d4abbb72fae1254" args="(qreal *arrayIn, qreal *reducedArray, int length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__device__ void reduceBlock </td>
          <td>(</td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>arrayIn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>reducedArray</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01334">1334</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l01327">log2Int()</a>.</p>

<p>Referenced by <a class="el" href="QuEST__gpu_8cu_source.html#l01353">copySharedReduceBlock()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01688">densmatr_calcFidelityKernel()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01778">densmatr_calcPurityKernel()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01362">densmatr_findProbabilityOfZeroKernel()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01570">statevec_calcInnerProductKernel()</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01400">statevec_findProbabilityOfZeroKernel()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01334"></a>01334                                                                             {
<a name="l01335"></a>01335     <span class="keywordtype">int</span> i, l, r;
<a name="l01336"></a>01336     <span class="keywordtype">int</span> threadMax, maxDepth;
<a name="l01337"></a>01337     threadMax = length/2;
<a name="l01338"></a>01338     maxDepth = <a class="code" href="QuEST__gpu_8cu.html#a8ce1e311ea72b862a8757dc71082fbf3">log2Int</a>(length/2);
<a name="l01339"></a>01339 
<a name="l01340"></a>01340     <span class="keywordflow">for</span> (i=0; i&lt;maxDepth+1; i++){
<a name="l01341"></a>01341         <span class="keywordflow">if</span> (threadIdx.x&lt;threadMax){
<a name="l01342"></a>01342             l = threadIdx.x;
<a name="l01343"></a>01343             r = l + threadMax;
<a name="l01344"></a>01344             arrayIn[l] = arrayIn[r] + arrayIn[l];
<a name="l01345"></a>01345         }
<a name="l01346"></a>01346         threadMax = threadMax &gt;&gt; 1;
<a name="l01347"></a>01347         __syncthreads(); <span class="comment">// optimise -- use warp shuffle instead</span>
<a name="l01348"></a>01348     }
<a name="l01349"></a>01349 
<a name="l01350"></a>01350     <span class="keywordflow">if</span> (threadIdx.x==0) reducedArray[blockIdx.x] = arrayIn[0];
<a name="l01351"></a>01351 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af8a14ae79c3fb2c0b5f6255cc37bebf9"></a><!-- doxytag: member="QuEST_gpu.cu::reportQuESTEnv" ref="af8a14ae79c3fb2c0b5f6255cc37bebf9" args="(QuESTEnv env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reportQuESTEnv </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td>
          <td class="paramname"> <em>env</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Report information about the QuEST environment. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>object representing the execution environment. A single instance is used for each program </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00261">261</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00120">QuESTEnv::numRanks</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00261"></a>00261                                  {
<a name="l00262"></a>00262     printf(<span class="stringliteral">&quot;EXECUTION ENVIRONMENT:\n&quot;</span>);
<a name="l00263"></a>00263     printf(<span class="stringliteral">&quot;Running locally on one node with GPU\n&quot;</span>);
<a name="l00264"></a>00264     printf(<span class="stringliteral">&quot;Number of ranks is %d\n&quot;</span>, env.<a class="code" href="structQuESTEnv.html#af22aacd7c9905accae28484785c193b4">numRanks</a>);
<a name="l00265"></a>00265 <span class="preprocessor"># ifdef _OPENMP</span>
<a name="l00266"></a>00266 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;OpenMP enabled\n&quot;</span>);
<a name="l00267"></a>00267     printf(<span class="stringliteral">&quot;Number of threads available is %d\n&quot;</span>, omp_get_max_threads());
<a name="l00268"></a>00268 <span class="preprocessor"># else</span>
<a name="l00269"></a>00269 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;OpenMP disabled\n&quot;</span>);
<a name="l00270"></a>00270 <span class="preprocessor"># endif</span>
<a name="l00271"></a>00271 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7ebd3198a198f4cd20840f64fd8b84d0"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_calcInnerProduct" ref="a7ebd3198a198f4cd20840f64fd8b84d0" args="(Qureg bra, Qureg ket)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structComplex.html">Complex</a> statevec_calcInnerProduct </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>bra</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>ket</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Terrible code which unnecessarily individually computes and sums the real and imaginary components of the inner product, so as to not have to worry about keeping the sums separated during reduction. </p>
<p>Truly disgusting, probably doubles runtime, please fix.  could even do the kernel twice, storing real in bra.reduc and imag in ket.reduc? </p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01600">1600</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l01353">copySharedReduceBlock()</a>, <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00107">Qureg::firstLevelReduction</a>, <a class="el" href="QuEST_8h_source.html#l00060">Complex::imag</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, <a class="el" href="QuEST_8h_source.html#l00059">Complex::real</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00015">REDUCE_SHARED_SIZE</a>, <a class="el" href="QuEST_8h_source.html#l00107">Qureg::secondLevelReduction</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01459">swapDouble()</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00606">calcInnerProduct()</a>, and <a class="el" href="QuEST__common_8c_source.html#l00328">statevec_calcFidelity()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01600"></a>01600                                                         {
<a name="l01601"></a>01601     
<a name="l01602"></a>01602     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> innerProdReal, innerProdImag;
<a name="l01603"></a>01603     
<a name="l01604"></a>01604     <span class="keywordtype">int</span> getRealComp;
<a name="l01605"></a>01605     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numValuesToReduce;
<a name="l01606"></a>01606     <span class="keywordtype">int</span> valuesPerCUDABlock, numCUDABlocks, sharedMemSize;
<a name="l01607"></a>01607     <span class="keywordtype">int</span> maxReducedPerLevel;
<a name="l01608"></a>01608     <span class="keywordtype">int</span> firstTime;
<a name="l01609"></a>01609     
<a name="l01610"></a>01610     <span class="comment">// compute real component of inner product</span>
<a name="l01611"></a>01611     getRealComp = 1;
<a name="l01612"></a>01612     numValuesToReduce = bra.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l01613"></a>01613     maxReducedPerLevel = <a class="code" href="QuEST__gpu_8cu.html#aa57d77a0903e334e963c66ddc5ed3f53">REDUCE_SHARED_SIZE</a>;
<a name="l01614"></a>01614     firstTime = 1;
<a name="l01615"></a>01615     <span class="keywordflow">while</span> (numValuesToReduce &gt; 1) {
<a name="l01616"></a>01616         <span class="keywordflow">if</span> (numValuesToReduce &lt; maxReducedPerLevel) {
<a name="l01617"></a>01617             valuesPerCUDABlock = numValuesToReduce;
<a name="l01618"></a>01618             numCUDABlocks = 1;
<a name="l01619"></a>01619         }
<a name="l01620"></a>01620         <span class="keywordflow">else</span> {
<a name="l01621"></a>01621             valuesPerCUDABlock = maxReducedPerLevel;
<a name="l01622"></a>01622             numCUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)numValuesToReduce/valuesPerCUDABlock);
<a name="l01623"></a>01623         }
<a name="l01624"></a>01624         sharedMemSize = valuesPerCUDABlock*<span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>);
<a name="l01625"></a>01625         <span class="keywordflow">if</span> (firstTime) {
<a name="l01626"></a>01626              statevec_calcInnerProductKernel&lt;&lt;&lt;numCUDABlocks, valuesPerCUDABlock, sharedMemSize&gt;&gt;&gt;(
<a name="l01627"></a>01627                  getRealComp,
<a name="l01628"></a>01628                  bra.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, bra.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, 
<a name="l01629"></a>01629                  ket.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, ket.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, 
<a name="l01630"></a>01630                  numValuesToReduce, 
<a name="l01631"></a>01631                  bra.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>);
<a name="l01632"></a>01632             firstTime = 0;
<a name="l01633"></a>01633         } <span class="keywordflow">else</span> {
<a name="l01634"></a>01634             cudaDeviceSynchronize();    
<a name="l01635"></a>01635             <a class="code" href="QuEST__gpu_8cu.html#aea20d173141544e6c5359955a1fbe997">copySharedReduceBlock</a>&lt;&lt;&lt;numCUDABlocks, valuesPerCUDABlock/2, sharedMemSize&gt;&gt;&gt;(
<a name="l01636"></a>01636                     bra.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>, 
<a name="l01637"></a>01637                     bra.<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>, valuesPerCUDABlock); 
<a name="l01638"></a>01638             cudaDeviceSynchronize();    
<a name="l01639"></a>01639             <a class="code" href="QuEST__gpu_8cu.html#a31772904f024efd8d75a022e84c8207b">swapDouble</a>(&amp;(bra.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>), &amp;(bra.<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>));
<a name="l01640"></a>01640         }
<a name="l01641"></a>01641         numValuesToReduce = numValuesToReduce/maxReducedPerLevel;
<a name="l01642"></a>01642     }
<a name="l01643"></a>01643     cudaMemcpy(&amp;innerProdReal, bra.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>, <span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>), cudaMemcpyDeviceToHost);
<a name="l01644"></a>01644     
<a name="l01645"></a>01645     <span class="comment">// compute imag component of inner product</span>
<a name="l01646"></a>01646     getRealComp = 0;
<a name="l01647"></a>01647     numValuesToReduce = bra.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l01648"></a>01648     maxReducedPerLevel = <a class="code" href="QuEST__gpu_8cu.html#aa57d77a0903e334e963c66ddc5ed3f53">REDUCE_SHARED_SIZE</a>;
<a name="l01649"></a>01649     firstTime = 1;
<a name="l01650"></a>01650     <span class="keywordflow">while</span> (numValuesToReduce &gt; 1) {
<a name="l01651"></a>01651         <span class="keywordflow">if</span> (numValuesToReduce &lt; maxReducedPerLevel) {
<a name="l01652"></a>01652             valuesPerCUDABlock = numValuesToReduce;
<a name="l01653"></a>01653             numCUDABlocks = 1;
<a name="l01654"></a>01654         }
<a name="l01655"></a>01655         <span class="keywordflow">else</span> {
<a name="l01656"></a>01656             valuesPerCUDABlock = maxReducedPerLevel;
<a name="l01657"></a>01657             numCUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)numValuesToReduce/valuesPerCUDABlock);
<a name="l01658"></a>01658         }
<a name="l01659"></a>01659         sharedMemSize = valuesPerCUDABlock*<span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>);
<a name="l01660"></a>01660         <span class="keywordflow">if</span> (firstTime) {
<a name="l01661"></a>01661              statevec_calcInnerProductKernel&lt;&lt;&lt;numCUDABlocks, valuesPerCUDABlock, sharedMemSize&gt;&gt;&gt;(
<a name="l01662"></a>01662                  getRealComp,
<a name="l01663"></a>01663                  bra.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, bra.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, 
<a name="l01664"></a>01664                  ket.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, ket.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, 
<a name="l01665"></a>01665                  numValuesToReduce, 
<a name="l01666"></a>01666                  bra.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>);
<a name="l01667"></a>01667             firstTime = 0;
<a name="l01668"></a>01668         } <span class="keywordflow">else</span> {
<a name="l01669"></a>01669             cudaDeviceSynchronize();    
<a name="l01670"></a>01670             <a class="code" href="QuEST__gpu_8cu.html#aea20d173141544e6c5359955a1fbe997">copySharedReduceBlock</a>&lt;&lt;&lt;numCUDABlocks, valuesPerCUDABlock/2, sharedMemSize&gt;&gt;&gt;(
<a name="l01671"></a>01671                     bra.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>, 
<a name="l01672"></a>01672                     bra.<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>, valuesPerCUDABlock); 
<a name="l01673"></a>01673             cudaDeviceSynchronize();    
<a name="l01674"></a>01674             <a class="code" href="QuEST__gpu_8cu.html#a31772904f024efd8d75a022e84c8207b">swapDouble</a>(&amp;(bra.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>), &amp;(bra.<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>));
<a name="l01675"></a>01675         }
<a name="l01676"></a>01676         numValuesToReduce = numValuesToReduce/maxReducedPerLevel;
<a name="l01677"></a>01677     }
<a name="l01678"></a>01678     cudaMemcpy(&amp;innerProdImag, bra.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>, <span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>), cudaMemcpyDeviceToHost);
<a name="l01679"></a>01679     
<a name="l01680"></a>01680     <span class="comment">// return complex</span>
<a name="l01681"></a>01681     <a class="code" href="structComplex.html" title="Represents one complex number.">Complex</a> innerProd;
<a name="l01682"></a>01682     innerProd.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a> = innerProdReal;
<a name="l01683"></a>01683     innerProd.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a> = innerProdImag;
<a name="l01684"></a>01684     <span class="keywordflow">return</span> innerProd;
<a name="l01685"></a>01685 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4f3c49fa4904bb120bbb6ae2e6395dfd"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_calcInnerProductKernel" ref="a4f3c49fa4904bb120bbb6ae2e6395dfd" args="(int getRealComp, qreal *vecReal1, qreal *vecImag1, qreal *vecReal2, qreal *vecImag2, long long int numTermsToSum, qreal *reducedArray)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_calcInnerProductKernel </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>getRealComp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecReal1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecImag1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecReal2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>vecImag2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>numTermsToSum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>reducedArray</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>computes either a real or imag term in the inner product </p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01570">1570</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01334">reduceBlock()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01574"></a>01574 {
<a name="l01575"></a>01575     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01576"></a>01576     <span class="keywordflow">if</span> (index &gt;= numTermsToSum) <span class="keywordflow">return</span>;
<a name="l01577"></a>01577     
<a name="l01578"></a>01578     <span class="comment">// choose whether to calculate the real or imaginary term of the inner product</span>
<a name="l01579"></a>01579     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> innerProdTerm;
<a name="l01580"></a>01580     <span class="keywordflow">if</span> (getRealComp)
<a name="l01581"></a>01581         innerProdTerm = vecReal1[index]*vecReal2[index] + vecImag1[index]*vecImag2[index];
<a name="l01582"></a>01582     <span class="keywordflow">else</span>
<a name="l01583"></a>01583         innerProdTerm = vecReal1[index]*vecImag2[index] - vecImag1[index]*vecReal2[index];
<a name="l01584"></a>01584     
<a name="l01585"></a>01585     <span class="comment">// array of each thread&apos;s collected probability, to be summed</span>
<a name="l01586"></a>01586     <span class="keyword">extern</span> __shared__ <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> tempReductionArray[];
<a name="l01587"></a>01587     tempReductionArray[threadIdx.x] = innerProdTerm;
<a name="l01588"></a>01588     __syncthreads();
<a name="l01589"></a>01589     
<a name="l01590"></a>01590     <span class="comment">// every second thread reduces</span>
<a name="l01591"></a>01591     <span class="keywordflow">if</span> (threadIdx.x&lt;blockDim.x/2)
<a name="l01592"></a>01592         <a class="code" href="QuEST__gpu_8cu.html#ac82f3dbf68f877f57d4abbb72fae1254">reduceBlock</a>(tempReductionArray, reducedArray, blockDim.x);
<a name="l01593"></a>01593 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab33cdf01831c4545e51299178acf7f27"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_calcProbOfOutcome" ref="ab33cdf01831c4545e51299178acf7f27" args="(Qureg qureg, const int measureQubit, int outcome)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">qreal statevec_calcProbOfOutcome </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>measureQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>outcome</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01552">1552</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01514">statevec_findProbabilityOfZero()</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00614">calcProbOfOutcome()</a>, <a class="el" href="QuEST_8c_source.html#l00539">collapseToOutcome()</a>, and <a class="el" href="QuEST__common_8c_source.html#l00312">statevec_measureWithStats()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01553"></a>01553 {
<a name="l01554"></a>01554     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> outcomeProb = <a class="code" href="QuEST__gpu_8cu.html#a067da9fba487d5821fbd689718b19de2">statevec_findProbabilityOfZero</a>(qureg, measureQubit);
<a name="l01555"></a>01555     <span class="keywordflow">if</span> (outcome==1)
<a name="l01556"></a>01556         outcomeProb = 1.0 - outcomeProb;
<a name="l01557"></a>01557     <span class="keywordflow">return</span> outcomeProb;
<a name="l01558"></a>01558 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad65ad1b5ea6f30b0c6b4ffda96e1a8e6"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_calcTotalProb" ref="ad65ad1b5ea6f30b0c6b4ffda96e1a8e6" args="(Qureg qureg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">qreal statevec_calcTotalProb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01133">1133</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l00291">copyStateFromGPU()</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, <a class="el" href="QuEST_8h_source.html#l00100">Qureg::stateVec</a>, and <a class="el" href="README_8md_source.html#l00018">y</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00599">calcTotalProb()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01133"></a>01133                                          {
<a name="l01134"></a>01134     <span class="comment">/* IJB - implemented using Kahan summation for greater accuracy at a slight floating</span>
<a name="l01135"></a>01135 <span class="comment">       point operation overhead. For more details see https://en.wikipedia.org/wiki/Kahan_summation_algorithm */</span>
<a name="l01136"></a>01136     <span class="comment">/* Don&apos;t change the bracketing in this routine! */</span>
<a name="l01137"></a>01137     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> pTotal=0;
<a name="l01138"></a>01138     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> <a class="code" href="README_8md.html#a003dc5701d53a819228f5417a8089139">y</a>, t, c;
<a name="l01139"></a>01139     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l01140"></a>01140     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numAmpsPerRank = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     <a class="code" href="QuEST__gpu_8cu.html#a924ef2dbda6b733b4041270077c76ece">copyStateFromGPU</a>(qureg);
<a name="l01143"></a>01143 
<a name="l01144"></a>01144     c = 0.0;
<a name="l01145"></a>01145     <span class="keywordflow">for</span> (index=0; index&lt;numAmpsPerRank; index++){
<a name="l01146"></a>01146         <span class="comment">/* Perform pTotal+=qureg.stateVec.real[index]*qureg.stateVec.real[index]; by Kahan */</span>
<a name="l01147"></a>01147         <span class="comment">// pTotal+=qureg.stateVec.real[index]*qureg.stateVec.real[index];</span>
<a name="l01148"></a>01148         y = qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real[index]*qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real[index] - c;
<a name="l01149"></a>01149         t = pTotal + y;
<a name="l01150"></a>01150         c = ( t - pTotal ) - y;
<a name="l01151"></a>01151         pTotal = t;
<a name="l01152"></a>01152 
<a name="l01153"></a>01153         <span class="comment">/* Perform pTotal+=qureg.stateVec.imag[index]*qureg.stateVec.imag[index]; by Kahan */</span>
<a name="l01154"></a>01154         <span class="comment">//pTotal+=qureg.stateVec.imag[index]*qureg.stateVec.imag[index];</span>
<a name="l01155"></a>01155         y = qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag[index]*qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag[index] - c;
<a name="l01156"></a>01156         t = pTotal + y;
<a name="l01157"></a>01157         c = ( t - pTotal ) - y;
<a name="l01158"></a>01158         pTotal = t;
<a name="l01159"></a>01159 
<a name="l01160"></a>01160 
<a name="l01161"></a>01161     }
<a name="l01162"></a>01162     <span class="keywordflow">return</span> pTotal;
<a name="l01163"></a>01163 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa4b77089145184d990848cd66993aa8b"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_cloneQureg" ref="aa4b77089145184d990848cd66993aa8b" args="(Qureg targetQureg, Qureg copyQureg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_cloneQureg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>targetQureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>copyQureg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>works for both statevectors and density matrices </p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00050">50</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, and <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00148">cloneQureg()</a>, and <a class="el" href="QuEST_8c_source.html#l00119">initPureState()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00050"></a>00050                                                              {
<a name="l00051"></a>00051     
<a name="l00052"></a>00052     <span class="comment">// copy copyQureg&apos;s GPU statevec to targetQureg&apos;s GPU statevec</span>
<a name="l00053"></a>00053     cudaDeviceSynchronize();
<a name="l00054"></a>00054     cudaMemcpy(
<a name="l00055"></a>00055         targetQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, 
<a name="l00056"></a>00056         copyQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, 
<a name="l00057"></a>00057         targetQureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>*<span class="keyword">sizeof</span>(*(targetQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real)), 
<a name="l00058"></a>00058         cudaMemcpyDeviceToDevice);
<a name="l00059"></a>00059     cudaMemcpy(
<a name="l00060"></a>00060         targetQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, 
<a name="l00061"></a>00061         copyQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, 
<a name="l00062"></a>00062         targetQureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>*<span class="keyword">sizeof</span>(*(targetQureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag)), 
<a name="l00063"></a>00063         cudaMemcpyDeviceToDevice);
<a name="l00064"></a>00064 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae7f25bb40734e18a992403b17355893b"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_collapseToKnownProbOutcome" ref="ae7f25bb40734e18a992403b17355893b" args="(Qureg qureg, const int measureQubit, int outcome, qreal outcomeProb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_collapseToKnownProbOutcome </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>measureQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>outcome</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>outcomeProb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01903">1903</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00539">collapseToOutcome()</a>, and <a class="el" href="QuEST__common_8c_source.html#l00312">statevec_measureWithStats()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01904"></a>01904 {        
<a name="l01905"></a>01905     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l01906"></a>01906     threadsPerCUDABlock = 128;
<a name="l01907"></a>01907     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1)/threadsPerCUDABlock);
<a name="l01908"></a>01908     statevec_collapseToKnownProbOutcomeKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, measureQubit, outcome, outcomeProb);
<a name="l01909"></a>01909 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5d2202221eed63dc9b003d716a46e879"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_collapseToKnownProbOutcomeKernel" ref="a5d2202221eed63dc9b003d716a46e879" args="(Qureg qureg, int measureQubit, int outcome, qreal totalProbability)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_collapseToKnownProbOutcomeKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>measureQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>outcome</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>totalProbability</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01846">1846</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01847"></a>01847 {
<a name="l01848"></a>01848     <span class="comment">// ----- sizes</span>
<a name="l01849"></a>01849     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock,                                           <span class="comment">// size of blocks</span>
<a name="l01850"></a>01850          sizeHalfBlock;                                       <span class="comment">// size of blocks halved</span>
<a name="l01851"></a>01851     <span class="comment">// ----- indices</span>
<a name="l01852"></a>01852     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock,                                           <span class="comment">// current block</span>
<a name="l01853"></a>01853          index;                                               <span class="comment">// current index for first half block</span>
<a name="l01854"></a>01854     <span class="comment">// ----- measured probability</span>
<a name="l01855"></a>01855     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>   renorm;                                    <span class="comment">// probability (returned) value</span>
<a name="l01856"></a>01856     <span class="comment">// ----- temp variables</span>
<a name="l01857"></a>01857     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisTask;                                   <span class="comment">// task based approach for expose loop with small granularity</span>
<a name="l01858"></a>01858     <span class="comment">// (good for shared memory parallelism)</span>
<a name="l01859"></a>01859     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numTasks=qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1;
<a name="l01860"></a>01860 
<a name="l01861"></a>01861     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l01862"></a>01862     <span class="comment">//            dimensions                                            //</span>
<a name="l01863"></a>01863     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l01864"></a>01864     sizeHalfBlock = 1LL &lt;&lt; (measureQubit);                       <span class="comment">// number of state vector elements to sum,</span>
<a name="l01865"></a>01865     <span class="comment">// and then the number to skip</span>
<a name="l01866"></a>01866     sizeBlock     = 2LL * sizeHalfBlock;                           <span class="comment">// size of blocks (pairs of measure and skip entries)</span>
<a name="l01867"></a>01867 
<a name="l01868"></a>01868     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l01869"></a>01869     <span class="comment">//            find probability                                      //</span>
<a name="l01870"></a>01870     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l01871"></a>01871 
<a name="l01872"></a>01872     <span class="comment">//</span>
<a name="l01873"></a>01873     <span class="comment">// --- task-based shared-memory parallel implementation</span>
<a name="l01874"></a>01874     <span class="comment">//</span>
<a name="l01875"></a>01875     renorm=1/sqrt(totalProbability);
<a name="l01876"></a>01876     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l01877"></a>01877     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l01878"></a>01878 
<a name="l01879"></a>01879     thisTask = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01880"></a>01880     <span class="keywordflow">if</span> (thisTask&gt;=numTasks) <span class="keywordflow">return</span>;
<a name="l01881"></a>01881     thisBlock = thisTask / sizeHalfBlock;
<a name="l01882"></a>01882     index     = thisBlock*sizeBlock + thisTask%sizeHalfBlock;
<a name="l01883"></a>01883 
<a name="l01884"></a>01884     <span class="keywordflow">if</span> (outcome==0){
<a name="l01885"></a>01885         stateVecReal[index]=stateVecReal[index]*renorm;
<a name="l01886"></a>01886         stateVecImag[index]=stateVecImag[index]*renorm;
<a name="l01887"></a>01887 
<a name="l01888"></a>01888         stateVecReal[index+sizeHalfBlock]=0;
<a name="l01889"></a>01889         stateVecImag[index+sizeHalfBlock]=0;
<a name="l01890"></a>01890     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (outcome==1){
<a name="l01891"></a>01891         stateVecReal[index]=0;
<a name="l01892"></a>01892         stateVecImag[index]=0;
<a name="l01893"></a>01893 
<a name="l01894"></a>01894         stateVecReal[index+sizeHalfBlock]=stateVecReal[index+sizeHalfBlock]*renorm;
<a name="l01895"></a>01895         stateVecImag[index+sizeHalfBlock]=stateVecImag[index+sizeHalfBlock]*renorm;
<a name="l01896"></a>01896     }
<a name="l01897"></a>01897 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a94ee4df9faba286ad7a5bc829ef5174d"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_compactUnitary" ref="a94ee4df9faba286ad7a5bc829ef5174d" args="(Qureg qureg, const int targetQubit, Complex alpha, Complex beta)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_compactUnitary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>beta</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00585">585</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00280">compactUnitary()</a>, <a class="el" href="QuEST__common_8c_source.html#l00262">statevec_rotateAroundAxis()</a>, and <a class="el" href="QuEST__common_8c_source.html#l00269">statevec_rotateAroundAxisConj()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00586"></a>00586 {
<a name="l00587"></a>00587     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00588"></a>00588     threadsPerCUDABlock = 128;
<a name="l00589"></a>00589     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1)/threadsPerCUDABlock);
<a name="l00590"></a>00590     statevec_compactUnitaryKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, targetQubit, alpha, beta);
<a name="l00591"></a>00591 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1338d7ca4e83bbb81da02aca456c53e6"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_compactUnitaryKernel" ref="a1338d7ca4e83bbb81da02aca456c53e6" args="(Qureg qureg, const int rotQubit, Complex alpha, Complex beta)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_compactUnitaryKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>beta</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>fix -- no necessary for GPU version </p>
</p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00530">530</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00060">Complex::imag</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, and <a class="el" href="QuEST_8h_source.html#l00059">Complex::real</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00530"></a>00530                                                                                                             {
<a name="l00531"></a>00531     <span class="comment">// ----- sizes</span>
<a name="l00532"></a>00532     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock,                                           <span class="comment">// size of blocks</span>
<a name="l00533"></a>00533          sizeHalfBlock;                                       <span class="comment">// size of blocks halved</span>
<a name="l00534"></a>00534     <span class="comment">// ----- indices</span>
<a name="l00535"></a>00535     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock,                                           <span class="comment">// current block</span>
<a name="l00536"></a>00536          indexUp,indexLo;                                     <span class="comment">// current index and corresponding index in lower half block</span>
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="comment">// ----- temp variables</span>
<a name="l00539"></a>00539     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>   stateRealUp,stateRealLo,                             <span class="comment">// storage for previous state values</span>
<a name="l00540"></a>00540            stateImagUp,stateImagLo;                             <span class="comment">// (used in updates)</span>
<a name="l00541"></a>00541     <span class="comment">// ----- temp variables</span>
<a name="l00542"></a>00542     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisTask;                                   <span class="comment">// task based approach for expose loop with small granularity</span>
<a name="l00543"></a>00543     <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numTasks=qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545     sizeHalfBlock = 1LL &lt;&lt; rotQubit;                               <span class="comment">// size of blocks halved</span>
<a name="l00546"></a>00546     sizeBlock     = 2LL * sizeHalfBlock;                           <span class="comment">// size of blocks</span>
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l00549"></a>00549     <span class="comment">//            rotate                                                //</span>
<a name="l00550"></a>00550     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l00551"></a>00551 
<a name="l00553"></a>00553     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l00554"></a>00554     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l00555"></a>00555     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> alphaImag=alpha.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>, alphaReal=alpha.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>;
<a name="l00556"></a>00556     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> betaImag=beta.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>, betaReal=beta.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>;
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     thisTask = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00559"></a>00559     <span class="keywordflow">if</span> (thisTask&gt;=numTasks) <span class="keywordflow">return</span>;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561     thisBlock   = thisTask / sizeHalfBlock;
<a name="l00562"></a>00562     indexUp     = thisBlock*sizeBlock + thisTask%sizeHalfBlock;
<a name="l00563"></a>00563     indexLo     = indexUp + sizeHalfBlock;
<a name="l00564"></a>00564 
<a name="l00565"></a>00565     <span class="comment">// store current state vector values in temp variables</span>
<a name="l00566"></a>00566     stateRealUp = stateVecReal[indexUp];
<a name="l00567"></a>00567     stateImagUp = stateVecImag[indexUp];
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     stateRealLo = stateVecReal[indexLo];
<a name="l00570"></a>00570     stateImagLo = stateVecImag[indexLo];
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <span class="comment">// state[indexUp] = alpha * state[indexUp] - conj(beta)  * state[indexLo]</span>
<a name="l00573"></a>00573     stateVecReal[indexUp] = alphaReal*stateRealUp - alphaImag*stateImagUp 
<a name="l00574"></a>00574         - betaReal*stateRealLo - betaImag*stateImagLo;
<a name="l00575"></a>00575     stateVecImag[indexUp] = alphaReal*stateImagUp + alphaImag*stateRealUp 
<a name="l00576"></a>00576         - betaReal*stateImagLo + betaImag*stateRealLo;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578     <span class="comment">// state[indexLo] = beta  * state[indexUp] + conj(alpha) * state[indexLo]</span>
<a name="l00579"></a>00579     stateVecReal[indexLo] = betaReal*stateRealUp - betaImag*stateImagUp 
<a name="l00580"></a>00580         + alphaReal*stateRealLo + alphaImag*stateImagLo;
<a name="l00581"></a>00581     stateVecImag[indexLo] = betaReal*stateImagUp + betaImag*stateRealUp 
<a name="l00582"></a>00582         + alphaReal*stateImagLo - alphaImag*stateRealLo;
<a name="l00583"></a>00583 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae6cecbad32a03416138b321cdc1a2c33"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_compareStates" ref="ae6cecbad32a03416138b321cdc1a2c33" args="(Qureg mq1, Qureg mq2, qreal precision)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int statevec_compareStates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>mq1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>mq2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>precision</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00512">512</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l00291">copyStateFromGPU()</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, and <a class="el" href="QuEST_8h_source.html#l00100">Qureg::stateVec</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00684">compareStates()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00512"></a>00512                                                                  {
<a name="l00513"></a>00513     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> diff;
<a name="l00514"></a>00514     <span class="keywordtype">int</span> chunkSize = mq1.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     <a class="code" href="QuEST__gpu_8cu.html#a924ef2dbda6b733b4041270077c76ece">copyStateFromGPU</a>(mq1);
<a name="l00517"></a>00517     <a class="code" href="QuEST__gpu_8cu.html#a924ef2dbda6b733b4041270077c76ece">copyStateFromGPU</a>(mq2);
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;chunkSize; i++){
<a name="l00520"></a>00520         diff = mq1.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real[i] - mq2.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real[i];
<a name="l00521"></a>00521         <span class="keywordflow">if</span> (diff&lt;0) diff *= -1;
<a name="l00522"></a>00522         <span class="keywordflow">if</span> (diff&gt;precision) <span class="keywordflow">return</span> 0;
<a name="l00523"></a>00523         diff = mq1.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag[i] - mq2.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag[i];
<a name="l00524"></a>00524         <span class="keywordflow">if</span> (diff&lt;0) diff *= -1;
<a name="l00525"></a>00525         <span class="keywordflow">if</span> (diff&gt;precision) <span class="keywordflow">return</span> 0;
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527     <span class="keywordflow">return</span> 1;
<a name="l00528"></a>00528 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a47b467a5445c7f15d1a8b0b2ec0ef2de"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledCompactUnitary" ref="a47b467a5445c7f15d1a8b0b2ec0ef2de" args="(Qureg qureg, const int controlQubit, const int targetQubit, Complex alpha, Complex beta)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_controlledCompactUnitary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>controlQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>beta</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00652">652</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00293">controlledCompactUnitary()</a>, <a class="el" href="QuEST__common_8c_source.html#l00278">statevec_controlledRotateAroundAxis()</a>, and <a class="el" href="QuEST__common_8c_source.html#l00285">statevec_controlledRotateAroundAxisConj()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00653"></a>00653 {
<a name="l00654"></a>00654     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00655"></a>00655     threadsPerCUDABlock = 128;
<a name="l00656"></a>00656     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1)/threadsPerCUDABlock);
<a name="l00657"></a>00657     statevec_controlledCompactUnitaryKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, controlQubit, targetQubit, alpha, beta);
<a name="l00658"></a>00658 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a55fdf6604434dab8a5c0b8522b6cc10c"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledCompactUnitaryKernel" ref="a55fdf6604434dab8a5c0b8522b6cc10c" args="(Qureg qureg, const int controlQubit, const int targetQubit, Complex alpha, Complex beta)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_controlledCompactUnitaryKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>controlQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>beta</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>fix -- no necessary for GPU version </p>
</p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00593">593</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00019">extractBit()</a>, <a class="el" href="QuEST_8h_source.html#l00060">Complex::imag</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, and <a class="el" href="QuEST_8h_source.html#l00059">Complex::real</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00593"></a>00593                                                                                                                                                  {
<a name="l00594"></a>00594     <span class="comment">// ----- sizes</span>
<a name="l00595"></a>00595     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock,                                           <span class="comment">// size of blocks</span>
<a name="l00596"></a>00596          sizeHalfBlock;                                       <span class="comment">// size of blocks halved</span>
<a name="l00597"></a>00597     <span class="comment">// ----- indices</span>
<a name="l00598"></a>00598     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock,                                           <span class="comment">// current block</span>
<a name="l00599"></a>00599          indexUp,indexLo;                                     <span class="comment">// current index and corresponding index in lower half block</span>
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="comment">// ----- temp variables</span>
<a name="l00602"></a>00602     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>   stateRealUp,stateRealLo,                             <span class="comment">// storage for previous state values</span>
<a name="l00603"></a>00603            stateImagUp,stateImagLo;                             <span class="comment">// (used in updates)</span>
<a name="l00604"></a>00604     <span class="comment">// ----- temp variables</span>
<a name="l00605"></a>00605     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisTask;                                   <span class="comment">// task based approach for expose loop with small granularity</span>
<a name="l00606"></a>00606     <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numTasks=qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1;
<a name="l00607"></a>00607     <span class="keywordtype">int</span> controlBit;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     sizeHalfBlock = 1LL &lt;&lt; targetQubit;                               <span class="comment">// size of blocks halved</span>
<a name="l00610"></a>00610     sizeBlock     = 2LL * sizeHalfBlock;                           <span class="comment">// size of blocks</span>
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l00613"></a>00613     <span class="comment">//            rotate                                                //</span>
<a name="l00614"></a>00614     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l00615"></a>00615 
<a name="l00617"></a>00617     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l00618"></a>00618     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l00619"></a>00619     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> alphaImag=alpha.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>, alphaReal=alpha.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>;
<a name="l00620"></a>00620     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> betaImag=beta.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>, betaReal=beta.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622     thisTask = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00623"></a>00623     <span class="keywordflow">if</span> (thisTask&gt;=numTasks) <span class="keywordflow">return</span>;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     thisBlock   = thisTask / sizeHalfBlock;
<a name="l00626"></a>00626     indexUp     = thisBlock*sizeBlock + thisTask%sizeHalfBlock;
<a name="l00627"></a>00627     indexLo     = indexUp + sizeHalfBlock;
<a name="l00628"></a>00628 
<a name="l00629"></a>00629     controlBit = <a class="code" href="QuEST__gpu_8cu.html#a6ffa51987d8ad8f6c0fc07fd3492277f">extractBit</a>(controlQubit, indexUp);
<a name="l00630"></a>00630     <span class="keywordflow">if</span> (controlBit){
<a name="l00631"></a>00631         <span class="comment">// store current state vector values in temp variables</span>
<a name="l00632"></a>00632         stateRealUp = stateVecReal[indexUp];
<a name="l00633"></a>00633         stateImagUp = stateVecImag[indexUp];
<a name="l00634"></a>00634 
<a name="l00635"></a>00635         stateRealLo = stateVecReal[indexLo];
<a name="l00636"></a>00636         stateImagLo = stateVecImag[indexLo];
<a name="l00637"></a>00637 
<a name="l00638"></a>00638         <span class="comment">// state[indexUp] = alpha * state[indexUp] - conj(beta)  * state[indexLo]</span>
<a name="l00639"></a>00639         stateVecReal[indexUp] = alphaReal*stateRealUp - alphaImag*stateImagUp 
<a name="l00640"></a>00640             - betaReal*stateRealLo - betaImag*stateImagLo;
<a name="l00641"></a>00641         stateVecImag[indexUp] = alphaReal*stateImagUp + alphaImag*stateRealUp 
<a name="l00642"></a>00642             - betaReal*stateImagLo + betaImag*stateRealLo;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644         <span class="comment">// state[indexLo] = beta  * state[indexUp] + conj(alpha) * state[indexLo]</span>
<a name="l00645"></a>00645         stateVecReal[indexLo] = betaReal*stateRealUp - betaImag*stateImagUp 
<a name="l00646"></a>00646             + alphaReal*stateRealLo + alphaImag*stateImagLo;
<a name="l00647"></a>00647         stateVecImag[indexLo] = betaReal*stateImagUp + betaImag*stateRealUp 
<a name="l00648"></a>00648             + alphaReal*stateImagLo - alphaImag*stateRealLo;
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a114038296eb404b9b8a66aaad7b48800"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledNot" ref="a114038296eb404b9b8a66aaad7b48800" args="(Qureg qureg, const int controlQubit, const int targetQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_controlledNot </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>controlQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01319">1319</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00400">controlledNot()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01320"></a>01320 {
<a name="l01321"></a>01321     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l01322"></a>01322     threadsPerCUDABlock = 128;
<a name="l01323"></a>01323     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l01324"></a>01324     statevec_controlledNotKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, controlQubit, targetQubit);
<a name="l01325"></a>01325 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aca8a32f46dbaabdbffc38d7b8023bf20"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledNotKernel" ref="aca8a32f46dbaabdbffc38d7b8023bf20" args="(Qureg qureg, const int controlQubit, const int targetQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_controlledNotKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>controlQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01280">1280</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00019">extractBit()</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01281"></a>01281 {
<a name="l01282"></a>01282     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l01283"></a>01283     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock,                                           <span class="comment">// size of blocks</span>
<a name="l01284"></a>01284          sizeHalfBlock;                                       <span class="comment">// size of blocks halved</span>
<a name="l01285"></a>01285     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> stateVecSize;
<a name="l01286"></a>01286     <span class="keywordtype">int</span> controlBit;
<a name="l01287"></a>01287 
<a name="l01288"></a>01288     <span class="comment">// ----- temp variables</span>
<a name="l01289"></a>01289     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>   stateRealUp,                             <span class="comment">// storage for previous state values</span>
<a name="l01290"></a>01290            stateImagUp;                             <span class="comment">// (used in updates)</span>
<a name="l01291"></a>01291     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock,                                           <span class="comment">// current block</span>
<a name="l01292"></a>01292          indexUp,indexLo;                                     <span class="comment">// current index and corresponding index in lower half block</span>
<a name="l01293"></a>01293     sizeHalfBlock = 1LL &lt;&lt; targetQubit;                               <span class="comment">// size of blocks halved</span>
<a name="l01294"></a>01294     sizeBlock     = 2LL * sizeHalfBlock;                           <span class="comment">// size of blocks</span>
<a name="l01295"></a>01295 
<a name="l01296"></a>01296     stateVecSize = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l01297"></a>01297     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l01298"></a>01298     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l01299"></a>01299 
<a name="l01300"></a>01300     index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01301"></a>01301     <span class="keywordflow">if</span> (index&gt;=(stateVecSize&gt;&gt;1)) <span class="keywordflow">return</span>;
<a name="l01302"></a>01302     thisBlock   = index / sizeHalfBlock;
<a name="l01303"></a>01303     indexUp     = thisBlock*sizeBlock + index%sizeHalfBlock;
<a name="l01304"></a>01304     indexLo     = indexUp + sizeHalfBlock;
<a name="l01305"></a>01305 
<a name="l01306"></a>01306     controlBit = <a class="code" href="QuEST__gpu_8cu.html#a6ffa51987d8ad8f6c0fc07fd3492277f">extractBit</a>(controlQubit, indexUp);
<a name="l01307"></a>01307     <span class="keywordflow">if</span> (controlBit){
<a name="l01308"></a>01308         stateRealUp = stateVecReal[indexUp];
<a name="l01309"></a>01309         stateImagUp = stateVecImag[indexUp];
<a name="l01310"></a>01310 
<a name="l01311"></a>01311         stateVecReal[indexUp] = stateVecReal[indexLo];
<a name="l01312"></a>01312         stateVecImag[indexUp] = stateVecImag[indexLo];
<a name="l01313"></a>01313 
<a name="l01314"></a>01314         stateVecReal[indexLo] = stateRealUp;
<a name="l01315"></a>01315         stateVecImag[indexLo] = stateImagUp;
<a name="l01316"></a>01316     }
<a name="l01317"></a>01317 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a708246b16236c492094c2633da0c08ff"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledPauliY" ref="a708246b16236c492094c2633da0c08ff" args="(Qureg qureg, const int controlQubit, const int targetQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_controlledPauliY </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>controlQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00982">982</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00412">controlledPauliY()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00983"></a>00983 {
<a name="l00984"></a>00984     <span class="keywordtype">int</span> conjFactor = 1;
<a name="l00985"></a>00985     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00986"></a>00986     threadsPerCUDABlock = 128;
<a name="l00987"></a>00987     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l00988"></a>00988     statevec_controlledPauliYKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, controlQubit, targetQubit, conjFactor);
<a name="l00989"></a>00989 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9e647339720bf82b30c6331fad544ec5"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledPauliYConj" ref="a9e647339720bf82b30c6331fad544ec5" args="(Qureg qureg, const int controlQubit, const int targetQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_controlledPauliYConj </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>controlQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00991">991</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00412">controlledPauliY()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00992"></a>00992 {
<a name="l00993"></a>00993     <span class="keywordtype">int</span> conjFactor = -1;
<a name="l00994"></a>00994     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00995"></a>00995     threadsPerCUDABlock = 128;
<a name="l00996"></a>00996     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l00997"></a>00997     statevec_controlledPauliYKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, controlQubit, targetQubit, conjFactor);
<a name="l00998"></a>00998 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9c7dfe745a3bb35f18440891d267e963"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledPauliYKernel" ref="a9c7dfe745a3bb35f18440891d267e963" args="(Qureg qureg, const int controlQubit, const int targetQubit, const int conjFac)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_controlledPauliYKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>controlQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>conjFac</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00946">946</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00019">extractBit()</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00947"></a>00947 {
<a name="l00948"></a>00948     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l00949"></a>00949     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock, sizeHalfBlock;
<a name="l00950"></a>00950     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> stateVecSize;
<a name="l00951"></a>00951     <span class="keywordtype">int</span> controlBit;
<a name="l00952"></a>00952 
<a name="l00953"></a>00953     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>   stateRealUp, stateImagUp; 
<a name="l00954"></a>00954     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock, indexUp, indexLo;                                     
<a name="l00955"></a>00955     sizeHalfBlock = 1LL &lt;&lt; targetQubit;
<a name="l00956"></a>00956     sizeBlock     = 2LL * sizeHalfBlock;
<a name="l00957"></a>00957 
<a name="l00958"></a>00958     stateVecSize = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l00959"></a>00959     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l00960"></a>00960     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l00961"></a>00961 
<a name="l00962"></a>00962     index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00963"></a>00963     <span class="keywordflow">if</span> (index&gt;=(stateVecSize&gt;&gt;1)) <span class="keywordflow">return</span>;
<a name="l00964"></a>00964     thisBlock   = index / sizeHalfBlock;
<a name="l00965"></a>00965     indexUp     = thisBlock*sizeBlock + index%sizeHalfBlock;
<a name="l00966"></a>00966     indexLo     = indexUp + sizeHalfBlock;
<a name="l00967"></a>00967 
<a name="l00968"></a>00968     controlBit = <a class="code" href="QuEST__gpu_8cu.html#a6ffa51987d8ad8f6c0fc07fd3492277f">extractBit</a>(controlQubit, indexUp);
<a name="l00969"></a>00969     <span class="keywordflow">if</span> (controlBit){
<a name="l00970"></a>00970 
<a name="l00971"></a>00971         stateRealUp = stateVecReal[indexUp];
<a name="l00972"></a>00972         stateImagUp = stateVecImag[indexUp];
<a name="l00973"></a>00973 
<a name="l00974"></a>00974         <span class="comment">// update under +-{{0, -i}, {i, 0}}</span>
<a name="l00975"></a>00975         stateVecReal[indexUp] = conjFac * stateVecImag[indexLo];
<a name="l00976"></a>00976         stateVecImag[indexUp] = conjFac * -stateVecReal[indexLo];
<a name="l00977"></a>00977         stateVecReal[indexLo] = conjFac * -stateImagUp;
<a name="l00978"></a>00978         stateVecImag[indexLo] = conjFac * stateRealUp;
<a name="l00979"></a>00979     }
<a name="l00980"></a>00980 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7c0067cb9f243ead20de7392aea328bc"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledPhaseFlip" ref="a7c0067cb9f243ead20de7392aea328bc" args="(Qureg qureg, const int idQubit1, const int idQubit2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_controlledPhaseFlip </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>idQubit1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>idQubit2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01186">1186</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00424">controlledPhaseFlip()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01187"></a>01187 {
<a name="l01188"></a>01188     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l01189"></a>01189     threadsPerCUDABlock = 128;
<a name="l01190"></a>01190     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l01191"></a>01191     statevec_controlledPhaseFlipKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, idQubit1, idQubit2);
<a name="l01192"></a>01192 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abf9e7eae332bbbd2e8b7b9c3ca3bad92"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledPhaseFlipKernel" ref="abf9e7eae332bbbd2e8b7b9c3ca3bad92" args="(Qureg qureg, const int idQubit1, const int idQubit2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_controlledPhaseFlipKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>idQubit1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>idQubit2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01165">1165</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00019">extractBit()</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01166"></a>01166 {
<a name="l01167"></a>01167     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l01168"></a>01168     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> stateVecSize;
<a name="l01169"></a>01169     <span class="keywordtype">int</span> bit1, bit2;
<a name="l01170"></a>01170 
<a name="l01171"></a>01171     stateVecSize = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l01172"></a>01172     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l01173"></a>01173     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l01174"></a>01174 
<a name="l01175"></a>01175     index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01176"></a>01176     <span class="keywordflow">if</span> (index&gt;=stateVecSize) <span class="keywordflow">return</span>;
<a name="l01177"></a>01177 
<a name="l01178"></a>01178     bit1 = <a class="code" href="QuEST__gpu_8cu.html#a6ffa51987d8ad8f6c0fc07fd3492277f">extractBit</a> (idQubit1, index);
<a name="l01179"></a>01179     bit2 = <a class="code" href="QuEST__gpu_8cu.html#a6ffa51987d8ad8f6c0fc07fd3492277f">extractBit</a> (idQubit2, index);
<a name="l01180"></a>01180     <span class="keywordflow">if</span> (bit1 &amp;&amp; bit2) {
<a name="l01181"></a>01181         stateVecReal [index] = - stateVecReal [index];
<a name="l01182"></a>01182         stateVecImag [index] = - stateVecImag [index];
<a name="l01183"></a>01183     }
<a name="l01184"></a>01184 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adeb715f3f2c167f9bfbe92b75f5988ce"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledPhaseShift" ref="adeb715f3f2c167f9bfbe92b75f5988ce" args="(Qureg qureg, const int idQubit1, const int idQubit2, qreal angle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_controlledPhaseShift </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>idQubit1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>idQubit2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>angle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01064">1064</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00374">controlledPhaseShift()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01065"></a>01065 {
<a name="l01066"></a>01066     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> cosAngle = cos(angle);
<a name="l01067"></a>01067     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> sinAngle = sin(angle);
<a name="l01068"></a>01068     
<a name="l01069"></a>01069     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l01070"></a>01070     threadsPerCUDABlock = 128;
<a name="l01071"></a>01071     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1)/threadsPerCUDABlock);
<a name="l01072"></a>01072     statevec_controlledPhaseShiftKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, idQubit1, idQubit2, cosAngle, sinAngle);
<a name="l01073"></a>01073 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af7723faf3f94342480a54fc2137522ce"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledPhaseShiftKernel" ref="af7723faf3f94342480a54fc2137522ce" args="(Qureg qureg, const int idQubit1, const int idQubit2, qreal cosAngle, qreal sinAngle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_controlledPhaseShiftKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>idQubit1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>idQubit2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>cosAngle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>sinAngle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01039">1039</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00019">extractBit()</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01040"></a>01040 {
<a name="l01041"></a>01041     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l01042"></a>01042     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> stateVecSize;
<a name="l01043"></a>01043     <span class="keywordtype">int</span> bit1, bit2;
<a name="l01044"></a>01044     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> stateRealLo, stateImagLo;
<a name="l01045"></a>01045 
<a name="l01046"></a>01046     stateVecSize = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l01047"></a>01047     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l01048"></a>01048     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l01049"></a>01049 
<a name="l01050"></a>01050     index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01051"></a>01051     <span class="keywordflow">if</span> (index&gt;=stateVecSize) <span class="keywordflow">return</span>;
<a name="l01052"></a>01052 
<a name="l01053"></a>01053     bit1 = <a class="code" href="QuEST__gpu_8cu.html#a6ffa51987d8ad8f6c0fc07fd3492277f">extractBit</a> (idQubit1, index);
<a name="l01054"></a>01054     bit2 = <a class="code" href="QuEST__gpu_8cu.html#a6ffa51987d8ad8f6c0fc07fd3492277f">extractBit</a> (idQubit2, index);
<a name="l01055"></a>01055     <span class="keywordflow">if</span> (bit1 &amp;&amp; bit2) {
<a name="l01056"></a>01056         stateRealLo = stateVecReal[index];
<a name="l01057"></a>01057         stateImagLo = stateVecImag[index];
<a name="l01058"></a>01058         
<a name="l01059"></a>01059         stateVecReal[index] = cosAngle*stateRealLo - sinAngle*stateImagLo;
<a name="l01060"></a>01060         stateVecImag[index] = sinAngle*stateRealLo + cosAngle*stateImagLo;
<a name="l01061"></a>01061     }
<a name="l01062"></a>01062 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2600999a19c817bfcf7ca14779e33b9a"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledUnitary" ref="a2600999a19c817bfcf7ca14779e33b9a" args="(Qureg qureg, const int controlQubit, const int targetQubit, ComplexMatrix2 u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_controlledUnitary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>controlQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a>&nbsp;</td>
          <td class="paramname"> <em>u</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00779">779</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00252">controlledUnitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00780"></a>00780 {
<a name="l00781"></a>00781     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00782"></a>00782     threadsPerCUDABlock = 128;
<a name="l00783"></a>00783     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1)/threadsPerCUDABlock);
<a name="l00784"></a>00784     statevec_controlledUnitaryKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, controlQubit, targetQubit, u);
<a name="l00785"></a>00785 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a032043d9f255e8419bb5efe1aec13532"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_controlledUnitaryKernel" ref="a032043d9f255e8419bb5efe1aec13532" args="(Qureg qureg, const int controlQubit, const int targetQubit, ComplexMatrix2 u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_controlledUnitaryKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>controlQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a>&nbsp;</td>
          <td class="paramname"> <em>u</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>fix -- no necessary for GPU version </p>
</p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00721">721</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00019">extractBit()</a>, <a class="el" href="QuEST_8h_source.html#l00060">Complex::imag</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, <a class="el" href="QuEST_8h_source.html#l00067">ComplexMatrix2::r0c0</a>, <a class="el" href="QuEST_8h_source.html#l00067">ComplexMatrix2::r0c1</a>, <a class="el" href="QuEST_8h_source.html#l00068">ComplexMatrix2::r1c0</a>, <a class="el" href="QuEST_8h_source.html#l00068">ComplexMatrix2::r1c1</a>, and <a class="el" href="QuEST_8h_source.html#l00059">Complex::real</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00721"></a>00721                                                                                                                               {
<a name="l00722"></a>00722     <span class="comment">// ----- sizes</span>
<a name="l00723"></a>00723     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock,                                           <span class="comment">// size of blocks</span>
<a name="l00724"></a>00724          sizeHalfBlock;                                       <span class="comment">// size of blocks halved</span>
<a name="l00725"></a>00725     <span class="comment">// ----- indices</span>
<a name="l00726"></a>00726     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock,                                           <span class="comment">// current block</span>
<a name="l00727"></a>00727          indexUp,indexLo;                                     <span class="comment">// current index and corresponding index in lower half block</span>
<a name="l00728"></a>00728 
<a name="l00729"></a>00729     <span class="comment">// ----- temp variables</span>
<a name="l00730"></a>00730     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>   stateRealUp,stateRealLo,                             <span class="comment">// storage for previous state values</span>
<a name="l00731"></a>00731            stateImagUp,stateImagLo;                             <span class="comment">// (used in updates)</span>
<a name="l00732"></a>00732     <span class="comment">// ----- temp variables</span>
<a name="l00733"></a>00733     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisTask;                                   <span class="comment">// task based approach for expose loop with small granularity</span>
<a name="l00734"></a>00734     <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numTasks=qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     <span class="keywordtype">int</span> controlBit;
<a name="l00737"></a>00737 
<a name="l00738"></a>00738     sizeHalfBlock = 1LL &lt;&lt; targetQubit;                               <span class="comment">// size of blocks halved</span>
<a name="l00739"></a>00739     sizeBlock     = 2LL * sizeHalfBlock;                           <span class="comment">// size of blocks</span>
<a name="l00740"></a>00740 
<a name="l00741"></a>00741     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l00742"></a>00742     <span class="comment">//            rotate                                                //</span>
<a name="l00743"></a>00743     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l00744"></a>00744 
<a name="l00746"></a>00746     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l00747"></a>00747     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l00748"></a>00748 
<a name="l00749"></a>00749     thisTask = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00750"></a>00750     <span class="keywordflow">if</span> (thisTask&gt;=numTasks) <span class="keywordflow">return</span>;
<a name="l00751"></a>00751 
<a name="l00752"></a>00752     thisBlock   = thisTask / sizeHalfBlock;
<a name="l00753"></a>00753     indexUp     = thisBlock*sizeBlock + thisTask%sizeHalfBlock;
<a name="l00754"></a>00754     indexLo     = indexUp + sizeHalfBlock;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756     <span class="comment">// store current state vector values in temp variables</span>
<a name="l00757"></a>00757     stateRealUp = stateVecReal[indexUp];
<a name="l00758"></a>00758     stateImagUp = stateVecImag[indexUp];
<a name="l00759"></a>00759 
<a name="l00760"></a>00760     stateRealLo = stateVecReal[indexLo];
<a name="l00761"></a>00761     stateImagLo = stateVecImag[indexLo];
<a name="l00762"></a>00762 
<a name="l00763"></a>00763     controlBit = <a class="code" href="QuEST__gpu_8cu.html#a6ffa51987d8ad8f6c0fc07fd3492277f">extractBit</a>(controlQubit, indexUp);
<a name="l00764"></a>00764     <span class="keywordflow">if</span> (controlBit){
<a name="l00765"></a>00765         <span class="comment">// state[indexUp] = u00 * state[indexUp] + u01 * state[indexLo]</span>
<a name="l00766"></a>00766         stateVecReal[indexUp] = u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateRealUp - u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateImagUp 
<a name="l00767"></a>00767             + u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateRealLo - u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateImagLo;
<a name="l00768"></a>00768         stateVecImag[indexUp] = u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateImagUp + u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateRealUp 
<a name="l00769"></a>00769             + u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateImagLo + u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateRealLo;
<a name="l00770"></a>00770 
<a name="l00771"></a>00771         <span class="comment">// state[indexLo] = u10  * state[indexUp] + u11 * state[indexLo]</span>
<a name="l00772"></a>00772         stateVecReal[indexLo] = u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateRealUp  - u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateImagUp 
<a name="l00773"></a>00773             + u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateRealLo  -  u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateImagLo;
<a name="l00774"></a>00774         stateVecImag[indexLo] = u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateImagUp + u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateRealUp 
<a name="l00775"></a>00775             + u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateImagLo + u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateRealLo;
<a name="l00776"></a>00776     }
<a name="l00777"></a>00777 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a365bbb1b80cb00405c8bf1a4fa1ea8e5"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_createQureg" ref="a365bbb1b80cb00405c8bf1a4fa1ea8e5" args="(Qureg *qureg, int numQubits, QuESTEnv env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_createQureg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a> *&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numQubits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td>
          <td class="paramname"> <em>env</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00155">155</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00095">Qureg::chunkId</a>, <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00107">Qureg::firstLevelReduction</a>, <a class="el" href="QuEST_8h_source.html#l00084">Qureg::isDensityMatrix</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST_8h_source.html#l00093">Qureg::numAmpsTotal</a>, <a class="el" href="QuEST_8h_source.html#l00097">Qureg::numChunks</a>, <a class="el" href="QuEST_8h_source.html#l00088">Qureg::numQubitsInStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00120">QuESTEnv::numRanks</a>, <a class="el" href="QuEST_8h_source.html#l00102">Qureg::pairStateVec</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, <a class="el" href="QuEST_8h_source.html#l00119">QuESTEnv::rank</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00015">REDUCE_SHARED_SIZE</a>, <a class="el" href="QuEST_8h_source.html#l00107">Qureg::secondLevelReduction</a>, and <a class="el" href="QuEST_8h_source.html#l00100">Qureg::stateVec</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00042">createDensityQureg()</a>, and <a class="el" href="QuEST_8c_source.html#l00028">createQureg()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00156"></a>00156 {   
<a name="l00157"></a>00157     <span class="comment">// allocate CPU memory</span>
<a name="l00158"></a>00158     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numAmps = 1L &lt;&lt; numQubits;
<a name="l00159"></a>00159     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numAmpsPerRank = numAmps/env.<a class="code" href="structQuESTEnv.html#af22aacd7c9905accae28484785c193b4">numRanks</a>;
<a name="l00160"></a>00160     qureg-&gt;<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real = (<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>*) malloc(numAmpsPerRank * <span class="keyword">sizeof</span>(qureg-&gt;<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real));
<a name="l00161"></a>00161     qureg-&gt;<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag = (<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>*) malloc(numAmpsPerRank * <span class="keyword">sizeof</span>(qureg-&gt;<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag));
<a name="l00162"></a>00162     <span class="keywordflow">if</span> (env.<a class="code" href="structQuESTEnv.html#af22aacd7c9905accae28484785c193b4">numRanks</a>&gt;1){
<a name="l00163"></a>00163         qureg-&gt;<a class="code" href="structQureg.html#aba97773694870ef35e378c036f486bb7" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>.real = (<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>*) malloc(numAmpsPerRank * <span class="keyword">sizeof</span>(qureg-&gt;<a class="code" href="structQureg.html#aba97773694870ef35e378c036f486bb7" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>.real));
<a name="l00164"></a>00164         qureg-&gt;<a class="code" href="structQureg.html#aba97773694870ef35e378c036f486bb7" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>.imag = (<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>*) malloc(numAmpsPerRank * <span class="keyword">sizeof</span>(qureg-&gt;<a class="code" href="structQureg.html#aba97773694870ef35e378c036f486bb7" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>.imag));
<a name="l00165"></a>00165     }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <span class="comment">// check cpu memory allocation was successful</span>
<a name="l00168"></a>00168     <span class="keywordflow">if</span> ( (!(qureg-&gt;<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real) || !(qureg-&gt;<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag))
<a name="l00169"></a>00169             &amp;&amp; numAmpsPerRank ) {
<a name="l00170"></a>00170         printf(<span class="stringliteral">&quot;Could not allocate memory!\n&quot;</span>);
<a name="l00171"></a>00171         exit (EXIT_FAILURE);
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173     <span class="keywordflow">if</span> ( env.<a class="code" href="structQuESTEnv.html#af22aacd7c9905accae28484785c193b4">numRanks</a>&gt;1 &amp;&amp; (!(qureg-&gt;<a class="code" href="structQureg.html#aba97773694870ef35e378c036f486bb7" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>.real) || !(qureg-&gt;<a class="code" href="structQureg.html#aba97773694870ef35e378c036f486bb7" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>.imag))
<a name="l00174"></a>00174             &amp;&amp; numAmpsPerRank ) {
<a name="l00175"></a>00175         printf(<span class="stringliteral">&quot;Could not allocate memory!\n&quot;</span>);
<a name="l00176"></a>00176         exit (EXIT_FAILURE);
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     qureg-&gt;<a class="code" href="structQureg.html#a0a86e8a50ea8c998b4a0a6640c5a1218" title="Number of qubits in the state-vector - this is double the number represented for...">numQubitsInStateVec</a> = numQubits;
<a name="l00180"></a>00180     qureg-&gt;<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a> = numAmpsPerRank;
<a name="l00181"></a>00181     qureg-&gt;<a class="code" href="structQureg.html#adef4935cac95763c29164cf99b144ed4" title="Total number of amplitudes, which are possibly distributed among machines.">numAmpsTotal</a> = numAmps;
<a name="l00182"></a>00182     qureg-&gt;<a class="code" href="structQureg.html#ac2929e681d3d95591c18cf168dbbe4f0" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a> = env.<a class="code" href="structQuESTEnv.html#aa648bb336cf8598467cb62db00b9cee8">rank</a>;
<a name="l00183"></a>00183     qureg-&gt;<a class="code" href="structQureg.html#aa3deb7163aab90a61e755a1f200f5413" title="Number of chunks the state vector is broken up into -- the number of MPI processes...">numChunks</a> = env.<a class="code" href="structQuESTEnv.html#af22aacd7c9905accae28484785c193b4">numRanks</a>;
<a name="l00184"></a>00184     qureg-&gt;<a class="code" href="structQureg.html#acf78445e9435d09f44f0cc832c6aee79" title="Whether this instance is a density-state representation.">isDensityMatrix</a> = 0;
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <span class="comment">// allocate GPU memory</span>
<a name="l00187"></a>00187     cudaMalloc(&amp;(qureg-&gt;<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real), qureg-&gt;<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>*<span class="keyword">sizeof</span>(*(qureg-&gt;<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real)));
<a name="l00188"></a>00188     cudaMalloc(&amp;(qureg-&gt;<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag), qureg-&gt;<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>*<span class="keyword">sizeof</span>(*(qureg-&gt;<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag)));
<a name="l00189"></a>00189     cudaMalloc(&amp;(qureg-&gt;<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>), ceil(qureg-&gt;<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>/(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)<a class="code" href="QuEST__gpu_8cu.html#aa57d77a0903e334e963c66ddc5ed3f53">REDUCE_SHARED_SIZE</a>)*<span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>));
<a name="l00190"></a>00190     cudaMalloc(&amp;(qureg-&gt;<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>), ceil(qureg-&gt;<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>/(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(<a class="code" href="QuEST__gpu_8cu.html#aa57d77a0903e334e963c66ddc5ed3f53">REDUCE_SHARED_SIZE</a>*<a class="code" href="QuEST__gpu_8cu.html#aa57d77a0903e334e963c66ddc5ed3f53">REDUCE_SHARED_SIZE</a>))*
<a name="l00191"></a>00191             <span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>));
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <span class="comment">// check gpu memory allocation was successful</span>
<a name="l00194"></a>00194     <span class="keywordflow">if</span> (!(qureg-&gt;<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real) || !(qureg-&gt;<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag)){
<a name="l00195"></a>00195         printf(<span class="stringliteral">&quot;Could not allocate memory on GPU!\n&quot;</span>);
<a name="l00196"></a>00196         exit (EXIT_FAILURE);
<a name="l00197"></a>00197     }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2a52ad9f9ad9b2fd6a76f6d433b3b217"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_destroyQureg" ref="a2a52ad9f9ad9b2fd6a76f6d433b3b217" args="(Qureg qureg, QuESTEnv env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_destroyQureg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td>
          <td class="paramname"> <em>env</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00201">201</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00120">QuESTEnv::numRanks</a>, <a class="el" href="QuEST_8h_source.html#l00102">Qureg::pairStateVec</a>, and <a class="el" href="QuEST_8h_source.html#l00100">Qureg::stateVec</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00056">destroyQureg()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00202"></a>00202 {
<a name="l00203"></a>00203     <span class="comment">// Free CPU memory</span>
<a name="l00204"></a>00204     free(qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real);
<a name="l00205"></a>00205     free(qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag);
<a name="l00206"></a>00206     <span class="keywordflow">if</span> (env.<a class="code" href="structQuESTEnv.html#af22aacd7c9905accae28484785c193b4">numRanks</a>&gt;1){
<a name="l00207"></a>00207         free(qureg.<a class="code" href="structQureg.html#aba97773694870ef35e378c036f486bb7" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>.real);
<a name="l00208"></a>00208         free(qureg.<a class="code" href="structQureg.html#aba97773694870ef35e378c036f486bb7" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>.imag);
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211     <span class="comment">// Free GPU memory</span>
<a name="l00212"></a>00212     cudaFree(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real);
<a name="l00213"></a>00213     cudaFree(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag);
<a name="l00214"></a>00214 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a067da9fba487d5821fbd689718b19de2"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_findProbabilityOfZero" ref="a067da9fba487d5821fbd689718b19de2" args="(Qureg qureg, const int measureQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">qreal statevec_findProbabilityOfZero </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>measureQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01514">1514</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l01353">copySharedReduceBlock()</a>, <a class="el" href="QuEST_8h_source.html#l00107">Qureg::firstLevelReduction</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00015">REDUCE_SHARED_SIZE</a>, <a class="el" href="QuEST_8h_source.html#l00107">Qureg::secondLevelReduction</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01459">swapDouble()</a>.</p>

<p>Referenced by <a class="el" href="QuEST__gpu_8cu_source.html#l01552">statevec_calcProbOfOutcome()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01515"></a>01515 {
<a name="l01516"></a>01516     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numValuesToReduce = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1;
<a name="l01517"></a>01517     <span class="keywordtype">int</span> valuesPerCUDABlock, numCUDABlocks, sharedMemSize;
<a name="l01518"></a>01518     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> stateProb=0;
<a name="l01519"></a>01519     <span class="keywordtype">int</span> firstTime=1;
<a name="l01520"></a>01520     <span class="keywordtype">int</span> maxReducedPerLevel = <a class="code" href="QuEST__gpu_8cu.html#aa57d77a0903e334e963c66ddc5ed3f53">REDUCE_SHARED_SIZE</a>;
<a name="l01521"></a>01521 
<a name="l01522"></a>01522     <span class="keywordflow">while</span>(numValuesToReduce&gt;1){ 
<a name="l01523"></a>01523         <span class="keywordflow">if</span> (numValuesToReduce&lt;maxReducedPerLevel){
<a name="l01524"></a>01524             <span class="comment">// Need less than one CUDA block to reduce values</span>
<a name="l01525"></a>01525             valuesPerCUDABlock = numValuesToReduce;
<a name="l01526"></a>01526             numCUDABlocks = 1;
<a name="l01527"></a>01527         } <span class="keywordflow">else</span> {
<a name="l01528"></a>01528             <span class="comment">// Use full CUDA blocks, with block size constrained by shared mem usage</span>
<a name="l01529"></a>01529             valuesPerCUDABlock = maxReducedPerLevel;
<a name="l01530"></a>01530             numCUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)numValuesToReduce/valuesPerCUDABlock);
<a name="l01531"></a>01531         }
<a name="l01532"></a>01532         sharedMemSize = valuesPerCUDABlock*<span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>);
<a name="l01533"></a>01533 
<a name="l01534"></a>01534         <span class="keywordflow">if</span> (firstTime){
<a name="l01535"></a>01535             statevec_findProbabilityOfZeroKernel&lt;&lt;&lt;numCUDABlocks, valuesPerCUDABlock, sharedMemSize&gt;&gt;&gt;(
<a name="l01536"></a>01536                     qureg, measureQubit, qureg.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>);
<a name="l01537"></a>01537             firstTime=0;
<a name="l01538"></a>01538         } <span class="keywordflow">else</span> {
<a name="l01539"></a>01539             cudaDeviceSynchronize();    
<a name="l01540"></a>01540             <a class="code" href="QuEST__gpu_8cu.html#aea20d173141544e6c5359955a1fbe997">copySharedReduceBlock</a>&lt;&lt;&lt;numCUDABlocks, valuesPerCUDABlock/2, sharedMemSize&gt;&gt;&gt;(
<a name="l01541"></a>01541                     qureg.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>, 
<a name="l01542"></a>01542                     qureg.<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>, valuesPerCUDABlock); 
<a name="l01543"></a>01543             cudaDeviceSynchronize();    
<a name="l01544"></a>01544             <a class="code" href="QuEST__gpu_8cu.html#a31772904f024efd8d75a022e84c8207b">swapDouble</a>(&amp;(qureg.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>), &amp;(qureg.<a class="code" href="structQureg.html#a8bb9f7517470a0cc406951935f37b64f">secondLevelReduction</a>));
<a name="l01545"></a>01545         }
<a name="l01546"></a>01546         numValuesToReduce = numValuesToReduce/maxReducedPerLevel;
<a name="l01547"></a>01547     }
<a name="l01548"></a>01548     cudaMemcpy(&amp;stateProb, qureg.<a class="code" href="structQureg.html#a2d0007a026a4231b338a5037c4e861b2" title="Storage for reduction of probabilities on GPU.">firstLevelReduction</a>, <span class="keyword">sizeof</span>(<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>), cudaMemcpyDeviceToHost);
<a name="l01549"></a>01549     <span class="keywordflow">return</span> stateProb;
<a name="l01550"></a>01550 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aae568d73d0de878acffe3798779de474"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_findProbabilityOfZeroKernel" ref="aae568d73d0de878acffe3798779de474" args="(Qureg qureg, const int measureQubit, qreal *reducedArray)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_findProbabilityOfZeroKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>measureQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>reducedArray</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01400">1400</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01334">reduceBlock()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01402"></a>01402   {
<a name="l01403"></a>01403     <span class="comment">// ----- sizes</span>
<a name="l01404"></a>01404     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock,                                           <span class="comment">// size of blocks</span>
<a name="l01405"></a>01405          sizeHalfBlock;                                       <span class="comment">// size of blocks halved</span>
<a name="l01406"></a>01406     <span class="comment">// ----- indices</span>
<a name="l01407"></a>01407     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock,                                           <span class="comment">// current block</span>
<a name="l01408"></a>01408          index;                                               <span class="comment">// current index for first half block</span>
<a name="l01409"></a>01409     <span class="comment">// ----- temp variables</span>
<a name="l01410"></a>01410     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisTask;                                   <span class="comment">// task based approach for expose loop with small granularity</span>
<a name="l01411"></a>01411     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numTasks=qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1;
<a name="l01412"></a>01412     <span class="comment">// (good for shared memory parallelism)</span>
<a name="l01413"></a>01413 
<a name="l01414"></a>01414     <span class="keyword">extern</span> __shared__ <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> tempReductionArray[];
<a name="l01415"></a>01415 
<a name="l01416"></a>01416     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l01417"></a>01417     <span class="comment">//            dimensions                                            //</span>
<a name="l01418"></a>01418     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l01419"></a>01419     sizeHalfBlock = 1LL &lt;&lt; (measureQubit);                       <span class="comment">// number of state vector elements to sum,</span>
<a name="l01420"></a>01420     <span class="comment">// and then the number to skip</span>
<a name="l01421"></a>01421     sizeBlock     = 2LL * sizeHalfBlock;                           <span class="comment">// size of blocks (pairs of measure and skip entries)</span>
<a name="l01422"></a>01422 
<a name="l01423"></a>01423     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l01424"></a>01424     <span class="comment">//            find probability                                      //</span>
<a name="l01425"></a>01425     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l01426"></a>01426 
<a name="l01427"></a>01427     <span class="comment">//</span>
<a name="l01428"></a>01428     <span class="comment">// --- task-based shared-memory parallel implementation</span>
<a name="l01429"></a>01429     <span class="comment">//</span>
<a name="l01430"></a>01430 
<a name="l01431"></a>01431     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l01432"></a>01432     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l01433"></a>01433 
<a name="l01434"></a>01434     thisTask = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01435"></a>01435     <span class="keywordflow">if</span> (thisTask&gt;=numTasks) <span class="keywordflow">return</span>;
<a name="l01436"></a>01436 
<a name="l01437"></a>01437     thisBlock = thisTask / sizeHalfBlock;
<a name="l01438"></a>01438     index     = thisBlock*sizeBlock + thisTask%sizeHalfBlock;
<a name="l01439"></a>01439     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> realVal, imagVal;
<a name="l01440"></a>01440     realVal = stateVecReal[index];
<a name="l01441"></a>01441     imagVal = stateVecImag[index];  
<a name="l01442"></a>01442     tempReductionArray[threadIdx.x] = realVal*realVal + imagVal*imagVal;
<a name="l01443"></a>01443     __syncthreads();
<a name="l01444"></a>01444 
<a name="l01445"></a>01445     <span class="keywordflow">if</span> (threadIdx.x&lt;blockDim.x/2){
<a name="l01446"></a>01446         <a class="code" href="QuEST__gpu_8cu.html#ac82f3dbf68f877f57d4abbb72fae1254">reduceBlock</a>(tempReductionArray, reducedArray, blockDim.x);
<a name="l01447"></a>01447     }
<a name="l01448"></a>01448 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abd509244d57657e148e4084c5ab5d28f"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_getImagAmp" ref="abd509244d57657e148e4084c5ab5d28f" args="(Qureg qureg, long long int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">qreal statevec_getImagAmp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00338">338</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00512">getAmp()</a>, <a class="el" href="QuEST_8c_source.html#l00522">getDensityAmp()</a>, <a class="el" href="QuEST_8c_source.html#l00498">getImagAmp()</a>, and <a class="el" href="QuEST__common_8c_source.html#l00167">statevec_getProbAmp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00338"></a>00338                                                            {
<a name="l00339"></a>00339     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> el=0;
<a name="l00340"></a>00340     cudaMemcpy(&amp;el, &amp;(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag[index]), 
<a name="l00341"></a>00341             <span class="keyword">sizeof</span>(*(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag)), cudaMemcpyDeviceToHost);
<a name="l00342"></a>00342     <span class="keywordflow">return</span> el;
<a name="l00343"></a>00343 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abc9a9ef4344c7faaaf28ac25c76649b9"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_getRealAmp" ref="abc9a9ef4344c7faaaf28ac25c76649b9" args="(Qureg qureg, long long int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">qreal statevec_getRealAmp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00331">331</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00512">getAmp()</a>, <a class="el" href="QuEST_8c_source.html#l00522">getDensityAmp()</a>, <a class="el" href="QuEST_8c_source.html#l00491">getRealAmp()</a>, and <a class="el" href="QuEST__common_8c_source.html#l00167">statevec_getProbAmp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00331"></a>00331                                                            {
<a name="l00332"></a>00332     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> el=0;
<a name="l00333"></a>00333     cudaMemcpy(&amp;el, &amp;(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real[index]), 
<a name="l00334"></a>00334             <span class="keyword">sizeof</span>(*(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real)), cudaMemcpyDeviceToHost);
<a name="l00335"></a>00335     <span class="keywordflow">return</span> el;
<a name="l00336"></a>00336 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9226f386d010aaa85efc0e8889d341d5"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_hadamard" ref="a9226f386d010aaa85efc0e8889d341d5" args="(Qureg qureg, const int targetQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_hadamard </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01272">1272</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00160">hadamard()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01273"></a>01273 {
<a name="l01274"></a>01274     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l01275"></a>01275     threadsPerCUDABlock = 128;
<a name="l01276"></a>01276     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1)/threadsPerCUDABlock);
<a name="l01277"></a>01277     statevec_hadamardKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, targetQubit);
<a name="l01278"></a>01278 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a14b5999f157b704aced4776c9ccbc982"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_hadamardKernel" ref="a14b5999f157b704aced4776c9ccbc982" args="(Qureg qureg, const int targetQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_hadamardKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>fix -- no necessary for GPU version </p>
</p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01223">1223</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01223"></a>01223                                                                             {
<a name="l01224"></a>01224     <span class="comment">// ----- sizes</span>
<a name="l01225"></a>01225     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock,                                           <span class="comment">// size of blocks</span>
<a name="l01226"></a>01226          sizeHalfBlock;                                       <span class="comment">// size of blocks halved</span>
<a name="l01227"></a>01227     <span class="comment">// ----- indices</span>
<a name="l01228"></a>01228     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock,                                           <span class="comment">// current block</span>
<a name="l01229"></a>01229          indexUp,indexLo;                                     <span class="comment">// current index and corresponding index in lower half block</span>
<a name="l01230"></a>01230 
<a name="l01231"></a>01231     <span class="comment">// ----- temp variables</span>
<a name="l01232"></a>01232     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>   stateRealUp,stateRealLo,                             <span class="comment">// storage for previous state values</span>
<a name="l01233"></a>01233            stateImagUp,stateImagLo;                             <span class="comment">// (used in updates)</span>
<a name="l01234"></a>01234     <span class="comment">// ----- temp variables</span>
<a name="l01235"></a>01235     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisTask;                                   <span class="comment">// task based approach for expose loop with small granularity</span>
<a name="l01236"></a>01236     <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numTasks=qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1;
<a name="l01237"></a>01237 
<a name="l01238"></a>01238     sizeHalfBlock = 1LL &lt;&lt; targetQubit;                               <span class="comment">// size of blocks halved</span>
<a name="l01239"></a>01239     sizeBlock     = 2LL * sizeHalfBlock;                           <span class="comment">// size of blocks</span>
<a name="l01240"></a>01240 
<a name="l01241"></a>01241     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l01242"></a>01242     <span class="comment">//            rotate                                                //</span>
<a name="l01243"></a>01243     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l01244"></a>01244 
<a name="l01246"></a>01246     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l01247"></a>01247     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l01248"></a>01248 
<a name="l01249"></a>01249     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> recRoot2 = 1.0/sqrt(2.0);
<a name="l01250"></a>01250 
<a name="l01251"></a>01251     thisTask = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01252"></a>01252     <span class="keywordflow">if</span> (thisTask&gt;=numTasks) <span class="keywordflow">return</span>;
<a name="l01253"></a>01253 
<a name="l01254"></a>01254     thisBlock   = thisTask / sizeHalfBlock;
<a name="l01255"></a>01255     indexUp     = thisBlock*sizeBlock + thisTask%sizeHalfBlock;
<a name="l01256"></a>01256     indexLo     = indexUp + sizeHalfBlock;
<a name="l01257"></a>01257 
<a name="l01258"></a>01258     <span class="comment">// store current state vector values in temp variables</span>
<a name="l01259"></a>01259     stateRealUp = stateVecReal[indexUp];
<a name="l01260"></a>01260     stateImagUp = stateVecImag[indexUp];
<a name="l01261"></a>01261 
<a name="l01262"></a>01262     stateRealLo = stateVecReal[indexLo];
<a name="l01263"></a>01263     stateImagLo = stateVecImag[indexLo];
<a name="l01264"></a>01264 
<a name="l01265"></a>01265     stateVecReal[indexUp] = recRoot2*(stateRealUp + stateRealLo);
<a name="l01266"></a>01266     stateVecImag[indexUp] = recRoot2*(stateImagUp + stateImagLo);
<a name="l01267"></a>01267 
<a name="l01268"></a>01268     stateVecReal[indexLo] = recRoot2*(stateRealUp - stateRealLo);
<a name="l01269"></a>01269     stateVecImag[indexLo] = recRoot2*(stateImagUp - stateImagLo);
<a name="l01270"></a>01270 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a288dc4b46bdacd69cbf4a6fd070d26a7"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_initClassicalState" ref="a288dc4b46bdacd69cbf4a6fd070d26a7" args="(Qureg qureg, long long int stateInd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_initClassicalState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>stateInd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00409">409</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00107">initClassicalState()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00410"></a>00410 {
<a name="l00411"></a>00411     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00412"></a>00412     threadsPerCUDABlock = 128;
<a name="l00413"></a>00413     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l00414"></a>00414     statevec_initClassicalStateKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l00415"></a>00415         qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>, 
<a name="l00416"></a>00416         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, 
<a name="l00417"></a>00417         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, stateInd);
<a name="l00418"></a>00418 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0f1817fe73e2911937af3979b6506ebd"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_initClassicalStateKernel" ref="a0f1817fe73e2911937af3979b6506ebd" args="(long long int stateVecSize, qreal *stateVecReal, qreal *stateVecImag, long long int stateInd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_initClassicalStateKernel </td>
          <td>(</td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>stateVecSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>stateVecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>stateVecImag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>stateInd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00394">394</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00394"></a>00394                                                                                                                                                {
<a name="l00395"></a>00395     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <span class="comment">// initialise the state to |stateInd&gt;</span>
<a name="l00398"></a>00398     index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00399"></a>00399     <span class="keywordflow">if</span> (index&gt;=stateVecSize) <span class="keywordflow">return</span>;
<a name="l00400"></a>00400     stateVecReal[index] = 0.0;
<a name="l00401"></a>00401     stateVecImag[index] = 0.0;
<a name="l00402"></a>00402 
<a name="l00403"></a>00403     <span class="keywordflow">if</span> (index==stateInd){
<a name="l00404"></a>00404         <span class="comment">// classical state has probability 1</span>
<a name="l00405"></a>00405         stateVecReal[stateInd] = 1.0;
<a name="l00406"></a>00406         stateVecImag[stateInd] = 0.0;
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a482fc361fd5f08075404c72e536316a0"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_initPlusState" ref="a482fc361fd5f08075404c72e536316a0" args="(Qureg qureg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_initPlusState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00383">383</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00098">initPlusState()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00384"></a>00384 {
<a name="l00385"></a>00385     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00386"></a>00386     threadsPerCUDABlock = 128;
<a name="l00387"></a>00387     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l00388"></a>00388     statevec_initPlusStateKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l00389"></a>00389         qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>, 
<a name="l00390"></a>00390         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, 
<a name="l00391"></a>00391         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag);
<a name="l00392"></a>00392 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaa36e3e86a5b79e676c6268fa2b02222"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_initPlusStateKernel" ref="aaa36e3e86a5b79e676c6268fa2b02222" args="(long long int stateVecSize, qreal *stateVecReal, qreal *stateVecImag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_initPlusStateKernel </td>
          <td>(</td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>stateVecSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>stateVecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>stateVecImag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00372">372</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00372"></a>00372                                                                                                                   {
<a name="l00373"></a>00373     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00376"></a>00376     <span class="keywordflow">if</span> (index&gt;=stateVecSize) <span class="keywordflow">return</span>;
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> normFactor = 1.0/sqrt((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)stateVecSize);
<a name="l00379"></a>00379     stateVecReal[index] = normFactor;
<a name="l00380"></a>00380     stateVecImag[index] = 0.0;
<a name="l00381"></a>00381 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a38445cdb2a18671a7c73112ce3337acb"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_initStateDebug" ref="a38445cdb2a18671a7c73112ce3337acb" args="(Qureg qureg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_initStateDebug </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialise the state vector of probability amplitudes to an (unphysical) state with each component of each probability amplitude a unique floating point value. </p>
<p>For debugging processes </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>qureg</em>&nbsp;</td><td>object representing the set of qubits to be initialised </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00430">430</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00689">initStateDebug()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00431"></a>00431 {
<a name="l00432"></a>00432     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00433"></a>00433     threadsPerCUDABlock = 128;
<a name="l00434"></a>00434     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l00435"></a>00435     statevec_initStateDebugKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l00436"></a>00436         qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>,
<a name="l00437"></a>00437         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, 
<a name="l00438"></a>00438         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag);
<a name="l00439"></a>00439 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a11c729ef89f1c145507a3018b3a52a06"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_initStateDebugKernel" ref="a11c729ef89f1c145507a3018b3a52a06" args="(long long int stateVecSize, qreal *stateVecReal, qreal *stateVecImag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_initStateDebugKernel </td>
          <td>(</td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>stateVecSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>stateVecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>stateVecImag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00420">420</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00420"></a>00420                                                                                                                    {
<a name="l00421"></a>00421     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00424"></a>00424     <span class="keywordflow">if</span> (index&gt;=stateVecSize) <span class="keywordflow">return</span>;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426     stateVecReal[index] = (index*2.0)/10.0;
<a name="l00427"></a>00427     stateVecImag[index] = (index*2.0+1.0)/10.0;
<a name="l00428"></a>00428 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a05756b45f10135bb2eeb07380f806c20"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_initStateFromSingleFile" ref="a05756b45f10135bb2eeb07380f806c20" args="(Qureg *qureg, char filename[200], QuESTEnv env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int statevec_initStateFromSingleFile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a> *&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[200], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td>
          <td class="paramname"> <em>env</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00468">468</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00095">Qureg::chunkId</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00277">copyStateToGPU()</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST_8h_source.html#l00097">Qureg::numChunks</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, and <a class="el" href="QuEST_8h_source.html#l00100">Qureg::stateVec</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00693">initStateFromSingleFile()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00468"></a>00468                                                                                     {
<a name="l00469"></a>00469     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> chunkSize, stateVecSize;
<a name="l00470"></a>00470     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> indexInChunk, totalIndex;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     chunkSize = qureg-&gt;<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l00473"></a>00473     stateVecSize = chunkSize*qureg-&gt;<a class="code" href="structQureg.html#aa3deb7163aab90a61e755a1f200f5413" title="Number of chunks the state vector is broken up into -- the number of MPI processes...">numChunks</a>;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg-&gt;<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real;
<a name="l00476"></a>00476     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg-&gt;<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     FILE *fp;
<a name="l00479"></a>00479     <span class="keywordtype">char</span> line[200];
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     fp = fopen(filename, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l00482"></a>00482     <span class="keywordflow">if</span> (fp == NULL)
<a name="l00483"></a>00483         <span class="keywordflow">return</span> 0;
<a name="l00484"></a>00484     
<a name="l00485"></a>00485     indexInChunk = 0; totalIndex = 0;
<a name="l00486"></a>00486     <span class="keywordflow">while</span> (fgets(line, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*200, fp) != NULL &amp;&amp; totalIndex&lt;stateVecSize){
<a name="l00487"></a>00487         <span class="keywordflow">if</span> (line[0]!=<span class="charliteral">&apos;#&apos;</span>){
<a name="l00488"></a>00488             <span class="keywordtype">int</span> chunkId = totalIndex/chunkSize;
<a name="l00489"></a>00489             <span class="keywordflow">if</span> (chunkId==qureg-&gt;<a class="code" href="structQureg.html#ac2929e681d3d95591c18cf168dbbe4f0" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>){
<a name="l00490"></a>00490 <span class="preprocessor">                # if QuEST_PREC==1</span>
<a name="l00491"></a>00491 <span class="preprocessor"></span>                    sscanf(line, <span class="stringliteral">&quot;%f, %f&quot;</span>, &amp;(stateVecReal[indexInChunk]),
<a name="l00492"></a>00492                             &amp;(stateVecImag[indexInChunk]));
<a name="l00493"></a>00493 <span class="preprocessor">                # elif QuEST_PREC==2</span>
<a name="l00494"></a>00494 <span class="preprocessor"></span>                    sscanf(line, <span class="stringliteral">&quot;%lf, %lf&quot;</span>, &amp;(stateVecReal[indexInChunk]),
<a name="l00495"></a>00495                             &amp;(stateVecImag[indexInChunk]));
<a name="l00496"></a>00496 <span class="preprocessor">                # elif QuEST_PREC==4</span>
<a name="l00497"></a>00497 <span class="preprocessor"></span>                    sscanf(line, <span class="stringliteral">&quot;%lf, %lf&quot;</span>, &amp;(stateVecReal[indexInChunk]),
<a name="l00498"></a>00498                             &amp;(stateVecImag[indexInChunk]));
<a name="l00499"></a>00499 <span class="preprocessor">                # endif</span>
<a name="l00500"></a>00500 <span class="preprocessor"></span>                indexInChunk += 1;
<a name="l00501"></a>00501             }
<a name="l00502"></a>00502             totalIndex += 1;
<a name="l00503"></a>00503         }
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505     fclose(fp);
<a name="l00506"></a>00506     <a class="code" href="QuEST__gpu_8cu.html#a11448560006dd165128e404b54ebb2f7">copyStateToGPU</a>(*qureg);
<a name="l00507"></a>00507     
<a name="l00508"></a>00508     <span class="comment">// indicate success</span>
<a name="l00509"></a>00509     <span class="keywordflow">return</span> 1;
<a name="l00510"></a>00510 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a923906770cac0da9e3459bae58de9e64"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_initStateOfSingleQubit" ref="a923906770cac0da9e3459bae58de9e64" args="(Qureg *qureg, int qubitId, int outcome)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_initStateOfSingleQubit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a> *&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>qubitId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>outcome</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialise the state vector of probability amplitudes such that one qubit is set to 'outcome' and all other qubits are in an equal superposition of zero and one. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>qureg</em>&nbsp;</td><td>object representing the set of qubits to be initialised </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>qubitId</em>&nbsp;</td><td>id of qubit to set to state 'outcome' </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>value</em>&nbsp;</td><td>of qubit 'qubitId' </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00459">459</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00698">initStateOfSingleQubit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00460"></a>00460 {
<a name="l00461"></a>00461     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00462"></a>00462     threadsPerCUDABlock = 128;
<a name="l00463"></a>00463     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg-&gt;<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l00464"></a>00464     statevec_initStateOfSingleQubitKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg-&gt;<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>, qureg-&gt;<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, qureg-&gt;<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag, qubitId, outcome);
<a name="l00465"></a>00465 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ace807c2089e172363db9ffe083f60f71"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_initStateOfSingleQubitKernel" ref="ace807c2089e172363db9ffe083f60f71" args="(long long int stateVecSize, qreal *stateVecReal, qreal *stateVecImag, int qubitId, int outcome)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_initStateOfSingleQubitKernel </td>
          <td>(</td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>stateVecSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>stateVecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>stateVecImag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>qubitId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>outcome</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00441">441</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__gpu_8cu_source.html#l00019">extractBit()</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00441"></a>00441                                                                                                                                                      {
<a name="l00442"></a>00442     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l00443"></a>00443     <span class="keywordtype">int</span> bit;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00446"></a>00446     <span class="keywordflow">if</span> (index&gt;=stateVecSize) <span class="keywordflow">return</span>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> normFactor = 1.0/sqrt((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)stateVecSize/2);
<a name="l00449"></a>00449     bit = <a class="code" href="QuEST__gpu_8cu.html#a6ffa51987d8ad8f6c0fc07fd3492277f">extractBit</a>(qubitId, index);
<a name="l00450"></a>00450     <span class="keywordflow">if</span> (bit==outcome) {
<a name="l00451"></a>00451         stateVecReal[index] = normFactor;
<a name="l00452"></a>00452         stateVecImag[index] = 0.0;
<a name="l00453"></a>00453     } <span class="keywordflow">else</span> {
<a name="l00454"></a>00454         stateVecReal[index] = 0.0;
<a name="l00455"></a>00455         stateVecImag[index] = 0.0;
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2ca0c6ba07ab2b4b437321bf17efc966"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_initZeroState" ref="a2ca0c6ba07ab2b4b437321bf17efc966" args="(Qureg qureg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_initZeroState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00361">361</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00092">initZeroState()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00362"></a>00362 {
<a name="l00363"></a>00363     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00364"></a>00364     threadsPerCUDABlock = 128;
<a name="l00365"></a>00365     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l00366"></a>00366     statevec_initZeroStateKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(
<a name="l00367"></a>00367         qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>, 
<a name="l00368"></a>00368         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real, 
<a name="l00369"></a>00369         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag);
<a name="l00370"></a>00370 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a43b35abfab0d6093b052e2c2e4b15064"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_initZeroStateKernel" ref="a43b35abfab0d6093b052e2c2e4b15064" args="(long long int stateVecSize, qreal *stateVecReal, qreal *stateVecImag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_initZeroStateKernel </td>
          <td>(</td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>stateVecSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>stateVecReal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>stateVecImag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00345">345</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00345"></a>00345                                                                                                                   {
<a name="l00346"></a>00346     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348     <span class="comment">// initialise the state to |0000..0000&gt;</span>
<a name="l00349"></a>00349     index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00350"></a>00350     <span class="keywordflow">if</span> (index&gt;=stateVecSize) <span class="keywordflow">return</span>;
<a name="l00351"></a>00351     stateVecReal[index] = 0.0;
<a name="l00352"></a>00352     stateVecImag[index] = 0.0;
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     <span class="keywordflow">if</span> (index==0){
<a name="l00355"></a>00355         <span class="comment">// zero state |0000..0000&gt; has probability 1</span>
<a name="l00356"></a>00356         stateVecReal[0] = 1.0;
<a name="l00357"></a>00357         stateVecImag[0] = 0.0;
<a name="l00358"></a>00358     }
<a name="l00359"></a>00359 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac4ee5979d475e8c729294b8ef7e0270d"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_multiControlledPhaseFlip" ref="ac4ee5979d475e8c729294b8ef7e0270d" args="(Qureg qureg, int *controlQubits, int numControlQubits)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_multiControlledPhaseFlip </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>controlQubits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numControlQubits</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01212">1212</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00436">multiControlledPhaseFlip()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01213"></a>01213 {
<a name="l01214"></a>01214     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l01215"></a>01215     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> mask=0;
<a name="l01216"></a>01216     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numControlQubits; i++) mask = mask | (1LL&lt;&lt;controlQubits[i]);
<a name="l01217"></a>01217     threadsPerCUDABlock = 128;
<a name="l01218"></a>01218     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l01219"></a>01219     statevec_multiControlledPhaseFlipKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, mask);
<a name="l01220"></a>01220 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab1f13b1980ec46bac75e97c578d15e98"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_multiControlledPhaseFlipKernel" ref="ab1f13b1980ec46bac75e97c578d15e98" args="(Qureg qureg, long long int mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_multiControlledPhaseFlipKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>mask</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01194">1194</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01195"></a>01195 {
<a name="l01196"></a>01196     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l01197"></a>01197     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> stateVecSize;
<a name="l01198"></a>01198 
<a name="l01199"></a>01199     stateVecSize = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l01200"></a>01200     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l01201"></a>01201     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l01202"></a>01202 
<a name="l01203"></a>01203     index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01204"></a>01204     <span class="keywordflow">if</span> (index&gt;=stateVecSize) <span class="keywordflow">return</span>;
<a name="l01205"></a>01205 
<a name="l01206"></a>01206     <span class="keywordflow">if</span> (mask == (mask &amp; index) ){
<a name="l01207"></a>01207         stateVecReal [index] = - stateVecReal [index];
<a name="l01208"></a>01208         stateVecImag [index] = - stateVecImag [index];
<a name="l01209"></a>01209     }
<a name="l01210"></a>01210 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa662796ea6e0f471143c53becae8c12c"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_multiControlledPhaseShift" ref="aa662796ea6e0f471143c53becae8c12c" args="(Qureg qureg, int *controlQubits, int numControlQubits, qreal angle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_multiControlledPhaseShift </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>controlQubits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numControlQubits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>angle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01095">1095</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00386">multiControlledPhaseShift()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01096"></a>01096 {   
<a name="l01097"></a>01097     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> cosAngle = cos(angle);
<a name="l01098"></a>01098     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> sinAngle = sin(angle);
<a name="l01099"></a>01099 
<a name="l01100"></a>01100     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> mask=0;
<a name="l01101"></a>01101     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numControlQubits; i++) 
<a name="l01102"></a>01102         mask = mask | (1LL&lt;&lt;controlQubits[i]);
<a name="l01103"></a>01103         
<a name="l01104"></a>01104     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l01105"></a>01105     threadsPerCUDABlock = 128;
<a name="l01106"></a>01106     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>)/threadsPerCUDABlock);
<a name="l01107"></a>01107     statevec_multiControlledPhaseShiftKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, mask, cosAngle, sinAngle);
<a name="l01108"></a>01108 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a11dc3581b1efe1332854eac7594bc647"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_multiControlledPhaseShiftKernel" ref="a11dc3581b1efe1332854eac7594bc647" args="(Qureg qureg, long long int mask, qreal cosAngle, qreal sinAngle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_multiControlledPhaseShiftKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>cosAngle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>sinAngle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01075">1075</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01075"></a>01075                                                                                                                           {
<a name="l01076"></a>01076     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> stateRealLo, stateImagLo;
<a name="l01077"></a>01077     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l01078"></a>01078     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> stateVecSize;
<a name="l01079"></a>01079 
<a name="l01080"></a>01080     stateVecSize = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>;
<a name="l01081"></a>01081     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l01082"></a>01082     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l01083"></a>01083     
<a name="l01084"></a>01084     index = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01085"></a>01085     <span class="keywordflow">if</span> (index&gt;=stateVecSize) <span class="keywordflow">return</span>;
<a name="l01086"></a>01086 
<a name="l01087"></a>01087     <span class="keywordflow">if</span> (mask == (mask &amp; index) ){
<a name="l01088"></a>01088         stateRealLo = stateVecReal[index];
<a name="l01089"></a>01089         stateImagLo = stateVecImag[index];
<a name="l01090"></a>01090         stateVecReal[index] = cosAngle*stateRealLo - sinAngle*stateImagLo;
<a name="l01091"></a>01091         stateVecImag[index] = sinAngle*stateRealLo + cosAngle*stateImagLo;
<a name="l01092"></a>01092     }
<a name="l01093"></a>01093 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae03bdeff36235ac294d1570add427c41"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_multiControlledUnitary" ref="ae03bdeff36235ac294d1570add427c41" args="(Qureg qureg, int *controlQubits, int numControlQubits, const int targetQubit, ComplexMatrix2 u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_multiControlledUnitary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>controlQubits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numControlQubits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a>&nbsp;</td>
          <td class="paramname"> <em>u</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00843">843</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00265">multiControlledUnitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00844"></a>00844 {
<a name="l00845"></a>00845     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00846"></a>00846     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> mask=0;
<a name="l00847"></a>00847     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numControlQubits; i++) mask = mask | (1LL&lt;&lt;controlQubits[i]);
<a name="l00848"></a>00848     threadsPerCUDABlock = 128;
<a name="l00849"></a>00849     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1)/threadsPerCUDABlock);
<a name="l00850"></a>00850     statevec_multiControlledUnitaryKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, mask, targetQubit, u);
<a name="l00851"></a>00851 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a42b5655729d07e16ab2f61d90706989a"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_multiControlledUnitaryKernel" ref="a42b5655729d07e16ab2f61d90706989a" args="(Qureg qureg, long long int mask, const int targetQubit, ComplexMatrix2 u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_multiControlledUnitaryKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a>&nbsp;</td>
          <td class="paramname"> <em>u</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>fix -- no necessary for GPU version </p>
</p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00787">787</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00060">Complex::imag</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, <a class="el" href="QuEST_8h_source.html#l00067">ComplexMatrix2::r0c0</a>, <a class="el" href="QuEST_8h_source.html#l00067">ComplexMatrix2::r0c1</a>, <a class="el" href="QuEST_8h_source.html#l00068">ComplexMatrix2::r1c0</a>, <a class="el" href="QuEST_8h_source.html#l00068">ComplexMatrix2::r1c1</a>, and <a class="el" href="QuEST_8h_source.html#l00059">Complex::real</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00787"></a>00787                                                                                                                                {
<a name="l00788"></a>00788     <span class="comment">// ----- sizes</span>
<a name="l00789"></a>00789     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock,                                           <span class="comment">// size of blocks</span>
<a name="l00790"></a>00790          sizeHalfBlock;                                       <span class="comment">// size of blocks halved</span>
<a name="l00791"></a>00791     <span class="comment">// ----- indices</span>
<a name="l00792"></a>00792     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock,                                           <span class="comment">// current block</span>
<a name="l00793"></a>00793          indexUp,indexLo;                                     <span class="comment">// current index and corresponding index in lower half block</span>
<a name="l00794"></a>00794 
<a name="l00795"></a>00795     <span class="comment">// ----- temp variables</span>
<a name="l00796"></a>00796     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>   stateRealUp,stateRealLo,                             <span class="comment">// storage for previous state values</span>
<a name="l00797"></a>00797            stateImagUp,stateImagLo;                             <span class="comment">// (used in updates)</span>
<a name="l00798"></a>00798     <span class="comment">// ----- temp variables</span>
<a name="l00799"></a>00799     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisTask;                                   <span class="comment">// task based approach for expose loop with small granularity</span>
<a name="l00800"></a>00800     <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numTasks=qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802 
<a name="l00803"></a>00803     sizeHalfBlock = 1LL &lt;&lt; targetQubit;                               <span class="comment">// size of blocks halved</span>
<a name="l00804"></a>00804     sizeBlock     = 2LL * sizeHalfBlock;                           <span class="comment">// size of blocks</span>
<a name="l00805"></a>00805 
<a name="l00806"></a>00806     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l00807"></a>00807     <span class="comment">//            rotate                                                //</span>
<a name="l00808"></a>00808     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l00809"></a>00809 
<a name="l00811"></a>00811     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l00812"></a>00812     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l00813"></a>00813 
<a name="l00814"></a>00814     thisTask = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00815"></a>00815     <span class="keywordflow">if</span> (thisTask&gt;=numTasks) <span class="keywordflow">return</span>;
<a name="l00816"></a>00816 
<a name="l00817"></a>00817     thisBlock   = thisTask / sizeHalfBlock;
<a name="l00818"></a>00818     indexUp     = thisBlock*sizeBlock + thisTask%sizeHalfBlock;
<a name="l00819"></a>00819     indexLo     = indexUp + sizeHalfBlock;
<a name="l00820"></a>00820 
<a name="l00821"></a>00821     <span class="keywordflow">if</span> (mask == (mask &amp; indexUp) ){
<a name="l00822"></a>00822         <span class="comment">// store current state vector values in temp variables</span>
<a name="l00823"></a>00823         stateRealUp = stateVecReal[indexUp];
<a name="l00824"></a>00824         stateImagUp = stateVecImag[indexUp];
<a name="l00825"></a>00825 
<a name="l00826"></a>00826         stateRealLo = stateVecReal[indexLo];
<a name="l00827"></a>00827         stateImagLo = stateVecImag[indexLo];
<a name="l00828"></a>00828 
<a name="l00829"></a>00829         <span class="comment">// state[indexUp] = u00 * state[indexUp] + u01 * state[indexLo]</span>
<a name="l00830"></a>00830         stateVecReal[indexUp] = u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateRealUp - u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateImagUp 
<a name="l00831"></a>00831             + u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateRealLo - u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateImagLo;
<a name="l00832"></a>00832         stateVecImag[indexUp] = u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateImagUp + u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateRealUp 
<a name="l00833"></a>00833             + u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateImagLo + u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateRealLo;
<a name="l00834"></a>00834 
<a name="l00835"></a>00835         <span class="comment">// state[indexLo] = u10  * state[indexUp] + u11 * state[indexLo]</span>
<a name="l00836"></a>00836         stateVecReal[indexLo] = u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateRealUp  - u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateImagUp 
<a name="l00837"></a>00837             + u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateRealLo  -  u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateImagLo;
<a name="l00838"></a>00838         stateVecImag[indexLo] = u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateImagUp + u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateRealUp 
<a name="l00839"></a>00839             + u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateImagLo + u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateRealLo;
<a name="l00840"></a>00840     }
<a name="l00841"></a>00841 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abdb6e0ee1e407755e1b944086cedd90e"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_pauliX" ref="abdb6e0ee1e407755e1b944086cedd90e" args="(Qureg qureg, const int targetQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_pauliX </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00897">897</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00308">pauliX()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00898"></a>00898 {
<a name="l00899"></a>00899     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00900"></a>00900     threadsPerCUDABlock = 128;
<a name="l00901"></a>00901     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1)/threadsPerCUDABlock);
<a name="l00902"></a>00902     statevec_pauliXKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, targetQubit);
<a name="l00903"></a>00903 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab1662a828dc725610a71168a58430fae"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_pauliXKernel" ref="ab1662a828dc725610a71168a58430fae" args="(Qureg qureg, const int targetQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_pauliXKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>fix -- no necessary for GPU version </p>
</p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00853">853</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00853"></a>00853                                                                          {
<a name="l00854"></a>00854     <span class="comment">// ----- sizes</span>
<a name="l00855"></a>00855     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock,                                           <span class="comment">// size of blocks</span>
<a name="l00856"></a>00856          sizeHalfBlock;                                       <span class="comment">// size of blocks halved</span>
<a name="l00857"></a>00857     <span class="comment">// ----- indices</span>
<a name="l00858"></a>00858     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock,                                           <span class="comment">// current block</span>
<a name="l00859"></a>00859          indexUp,indexLo;                                     <span class="comment">// current index and corresponding index in lower half block</span>
<a name="l00860"></a>00860 
<a name="l00861"></a>00861     <span class="comment">// ----- temp variables</span>
<a name="l00862"></a>00862     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>   stateRealUp,                             <span class="comment">// storage for previous state values</span>
<a name="l00863"></a>00863            stateImagUp;                             <span class="comment">// (used in updates)</span>
<a name="l00864"></a>00864     <span class="comment">// ----- temp variables</span>
<a name="l00865"></a>00865     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisTask;                                   <span class="comment">// task based approach for expose loop with small granularity</span>
<a name="l00866"></a>00866     <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numTasks=qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1;
<a name="l00867"></a>00867 
<a name="l00868"></a>00868     sizeHalfBlock = 1LL &lt;&lt; targetQubit;                               <span class="comment">// size of blocks halved</span>
<a name="l00869"></a>00869     sizeBlock     = 2LL * sizeHalfBlock;                           <span class="comment">// size of blocks</span>
<a name="l00870"></a>00870 
<a name="l00871"></a>00871     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l00872"></a>00872     <span class="comment">//            rotate                                                //</span>
<a name="l00873"></a>00873     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l00874"></a>00874 
<a name="l00876"></a>00876     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l00877"></a>00877     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l00878"></a>00878 
<a name="l00879"></a>00879     thisTask = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00880"></a>00880     <span class="keywordflow">if</span> (thisTask&gt;=numTasks) <span class="keywordflow">return</span>;
<a name="l00881"></a>00881 
<a name="l00882"></a>00882     thisBlock   = thisTask / sizeHalfBlock;
<a name="l00883"></a>00883     indexUp     = thisBlock*sizeBlock + thisTask%sizeHalfBlock;
<a name="l00884"></a>00884     indexLo     = indexUp + sizeHalfBlock;
<a name="l00885"></a>00885 
<a name="l00886"></a>00886     <span class="comment">// store current state vector values in temp variables</span>
<a name="l00887"></a>00887     stateRealUp = stateVecReal[indexUp];
<a name="l00888"></a>00888     stateImagUp = stateVecImag[indexUp];
<a name="l00889"></a>00889 
<a name="l00890"></a>00890     stateVecReal[indexUp] = stateVecReal[indexLo];
<a name="l00891"></a>00891     stateVecImag[indexUp] = stateVecImag[indexLo];
<a name="l00892"></a>00892 
<a name="l00893"></a>00893     stateVecReal[indexLo] = stateRealUp;
<a name="l00894"></a>00894     stateVecImag[indexLo] = stateImagUp;
<a name="l00895"></a>00895 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a73b56fbac6e464a37805fa9d9657a8f9"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_pauliY" ref="a73b56fbac6e464a37805fa9d9657a8f9" args="(Qureg qureg, const int targetQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_pauliY </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00930">930</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00319">pauliY()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00931"></a>00931 {
<a name="l00932"></a>00932     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00933"></a>00933     threadsPerCUDABlock = 128;
<a name="l00934"></a>00934     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1)/threadsPerCUDABlock);
<a name="l00935"></a>00935     statevec_pauliYKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, targetQubit, 1);
<a name="l00936"></a>00936 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aee97816cfabeea7874cd837a8d105412"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_pauliYConj" ref="aee97816cfabeea7874cd837a8d105412" args="(Qureg qureg, const int targetQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_pauliYConj </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00938">938</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00319">pauliY()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00939"></a>00939 {
<a name="l00940"></a>00940     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00941"></a>00941     threadsPerCUDABlock = 128;
<a name="l00942"></a>00942     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1)/threadsPerCUDABlock);
<a name="l00943"></a>00943     statevec_pauliYKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, targetQubit, -1);
<a name="l00944"></a>00944 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1f5b1f46708a7c96275e379b873ba2f6"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_pauliYKernel" ref="a1f5b1f46708a7c96275e379b873ba2f6" args="(Qureg qureg, const int targetQubit, const int conjFac)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_pauliYKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>conjFac</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00905">905</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00905"></a>00905                                                                                             {
<a name="l00906"></a>00906 
<a name="l00907"></a>00907     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeHalfBlock = 1LL &lt;&lt; targetQubit;
<a name="l00908"></a>00908     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock     = 2LL * sizeHalfBlock;
<a name="l00909"></a>00909     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numTasks      = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a> &gt;&gt; 1;
<a name="l00910"></a>00910     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisTask      = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00911"></a>00911     <span class="keywordflow">if</span> (thisTask&gt;=numTasks) <span class="keywordflow">return</span>;
<a name="l00912"></a>00912     
<a name="l00913"></a>00913     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock     = thisTask / sizeHalfBlock;
<a name="l00914"></a>00914     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> indexUp       = thisBlock*sizeBlock + thisTask%sizeHalfBlock;
<a name="l00915"></a>00915     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> indexLo       = indexUp + sizeHalfBlock;
<a name="l00916"></a>00916     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>  stateRealUp, stateImagUp;
<a name="l00917"></a>00917 
<a name="l00918"></a>00918     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l00919"></a>00919     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l00920"></a>00920     stateRealUp = stateVecReal[indexUp];
<a name="l00921"></a>00921     stateImagUp = stateVecImag[indexUp];
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <span class="comment">// update under +-{{0, -i}, {i, 0}}</span>
<a name="l00924"></a>00924     stateVecReal[indexUp] = conjFac * stateVecImag[indexLo];
<a name="l00925"></a>00925     stateVecImag[indexUp] = conjFac * -stateVecReal[indexLo];
<a name="l00926"></a>00926     stateVecReal[indexLo] = conjFac * -stateImagUp;
<a name="l00927"></a>00927     stateVecImag[indexLo] = conjFac * stateRealUp;
<a name="l00928"></a>00928 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8972669148af60d7e1c09687f69673d4"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_phaseShiftByTerm" ref="a8972669148af60d7e1c09687f69673d4" args="(Qureg qureg, const int targetQubit, Complex term)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_phaseShiftByTerm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>term</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01028">1028</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00060">Complex::imag</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, and <a class="el" href="QuEST_8h_source.html#l00059">Complex::real</a>.</p>

<p>Referenced by <a class="el" href="QuEST__common_8c_source.html#l00209">statevec_pauliZ()</a>, <a class="el" href="QuEST__common_8c_source.html#l00202">statevec_phaseShift()</a>, <a class="el" href="QuEST__common_8c_source.html#l00216">statevec_sGate()</a>, <a class="el" href="QuEST__common_8c_source.html#l00230">statevec_sGateConj()</a>, <a class="el" href="QuEST__common_8c_source.html#l00223">statevec_tGate()</a>, and <a class="el" href="QuEST__common_8c_source.html#l00237">statevec_tGateConj()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01029"></a>01029 {   
<a name="l01030"></a>01030     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> cosAngle = term.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>;
<a name="l01031"></a>01031     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> sinAngle = term.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>;
<a name="l01032"></a>01032     
<a name="l01033"></a>01033     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l01034"></a>01034     threadsPerCUDABlock = 128;
<a name="l01035"></a>01035     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1)/threadsPerCUDABlock);
<a name="l01036"></a>01036     statevec_phaseShiftByTermKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, targetQubit, cosAngle, sinAngle);
<a name="l01037"></a>01037 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5ef71ca3bb26774d7317253128a4aeab"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_phaseShiftByTermKernel" ref="a5ef71ca3bb26774d7317253128a4aeab" args="(Qureg qureg, const int targetQubit, qreal cosAngle, qreal sinAngle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_phaseShiftByTermKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>cosAngle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal&nbsp;</td>
          <td class="paramname"> <em>sinAngle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01000">1000</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01000"></a>01000                                                                                                                     {
<a name="l01001"></a>01001 
<a name="l01002"></a>01002     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock, sizeHalfBlock;
<a name="l01003"></a>01003     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock, indexUp,indexLo;
<a name="l01004"></a>01004 
<a name="l01005"></a>01005     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> stateRealLo, stateImagLo;             
<a name="l01006"></a>01006     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisTask; 
<a name="l01007"></a>01007     <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numTasks = qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a> &gt;&gt; 1;
<a name="l01008"></a>01008 
<a name="l01009"></a>01009     sizeHalfBlock = 1LL &lt;&lt; targetQubit;
<a name="l01010"></a>01010     sizeBlock     = 2LL * sizeHalfBlock;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l01013"></a>01013     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l01014"></a>01014 
<a name="l01015"></a>01015     thisTask = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l01016"></a>01016     <span class="keywordflow">if</span> (thisTask&gt;=numTasks) <span class="keywordflow">return</span>;
<a name="l01017"></a>01017     thisBlock   = thisTask / sizeHalfBlock;
<a name="l01018"></a>01018     indexUp     = thisBlock*sizeBlock + thisTask%sizeHalfBlock;
<a name="l01019"></a>01019     indexLo     = indexUp + sizeHalfBlock;
<a name="l01020"></a>01020 
<a name="l01021"></a>01021     stateRealLo = stateVecReal[indexLo];
<a name="l01022"></a>01022     stateImagLo = stateVecImag[indexLo];
<a name="l01023"></a>01023 
<a name="l01024"></a>01024     stateVecReal[indexLo] = cosAngle*stateRealLo - sinAngle*stateImagLo;
<a name="l01025"></a>01025     stateVecImag[indexLo] = sinAngle*stateRealLo + cosAngle*stateImagLo;
<a name="l01026"></a>01026 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1e57230c7995447039e62a84c0a36524"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_reportStateToScreen" ref="a1e57230c7995447039e62a84c0a36524" args="(Qureg qureg, QuESTEnv env, int reportRank)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_reportStateToScreen </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>reportRank</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print the current state vector of probability amplitudes for a set of qubits to standard out. </p>
<p>For debugging purposes. Each rank should print output serially. Only print output for systems &lt;= 5 qubits </p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00305">305</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00095">Qureg::chunkId</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l00291">copyStateFromGPU()</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST_8h_source.html#l00097">Qureg::numChunks</a>, <a class="el" href="QuEST_8h_source.html#l00088">Qureg::numQubitsInStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00100">Qureg::stateVec</a>, and <a class="el" href="QuEST__cpu__distributed_8c_source.html#l00166">syncQuESTEnv()</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00705">reportStateToScreen()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00305"></a>00305                                                                             {
<a name="l00306"></a>00306     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l00307"></a>00307     <span class="keywordtype">int</span> rank;
<a name="l00308"></a>00308     <a class="code" href="QuEST__gpu_8cu.html#a924ef2dbda6b733b4041270077c76ece">copyStateFromGPU</a>(qureg); 
<a name="l00309"></a>00309     <span class="keywordflow">if</span> (qureg.<a class="code" href="structQureg.html#a0a86e8a50ea8c998b4a0a6640c5a1218" title="Number of qubits in the state-vector - this is double the number represented for...">numQubitsInStateVec</a>&lt;=5){
<a name="l00310"></a>00310         <span class="keywordflow">for</span> (rank=0; rank&lt;qureg.<a class="code" href="structQureg.html#aa3deb7163aab90a61e755a1f200f5413" title="Number of chunks the state vector is broken up into -- the number of MPI processes...">numChunks</a>; rank++){
<a name="l00311"></a>00311             <span class="keywordflow">if</span> (qureg.<a class="code" href="structQureg.html#ac2929e681d3d95591c18cf168dbbe4f0" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>==rank){
<a name="l00312"></a>00312                 <span class="keywordflow">if</span> (reportRank) {
<a name="l00313"></a>00313                     printf(<span class="stringliteral">&quot;Reporting state from rank %d [\n&quot;</span>, qureg.<a class="code" href="structQureg.html#ac2929e681d3d95591c18cf168dbbe4f0" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>);
<a name="l00314"></a>00314                     <span class="comment">//printf(&quot;\trank, index, real, imag\n&quot;);</span>
<a name="l00315"></a>00315                     printf(<span class="stringliteral">&quot;real, imag\n&quot;</span>);
<a name="l00316"></a>00316                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rank==0) {
<a name="l00317"></a>00317                     printf(<span class="stringliteral">&quot;Reporting state [\n&quot;</span>);
<a name="l00318"></a>00318                     printf(<span class="stringliteral">&quot;real, imag\n&quot;</span>);
<a name="l00319"></a>00319                 }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321                 <span class="keywordflow">for</span>(index=0; index&lt;qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>; index++){
<a name="l00322"></a>00322                     printf(REAL_STRING_FORMAT <span class="stringliteral">&quot;, &quot;</span> REAL_STRING_FORMAT <span class="stringliteral">&quot;\n&quot;</span>, qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.real[index], qureg.<a class="code" href="structQureg.html#a441e4cacef6bd17adb9813c7442d42fe" title="Computational state amplitudes - a subset thereof in the MPI version.">stateVec</a>.imag[index]);
<a name="l00323"></a>00323                 }
<a name="l00324"></a>00324                 <span class="keywordflow">if</span> (reportRank || rank==qureg.<a class="code" href="structQureg.html#aa3deb7163aab90a61e755a1f200f5413" title="Number of chunks the state vector is broken up into -- the number of MPI processes...">numChunks</a>-1) printf(<span class="stringliteral">&quot;]\n&quot;</span>);
<a name="l00325"></a>00325             }
<a name="l00326"></a>00326             <a class="code" href="QuEST_8h.html#a8d31fe2d1ad4d01e2a1f5f6b8bc15b77" title="Guarantees that all code up to the given point has been executed on all nodes (if...">syncQuESTEnv</a>(env);
<a name="l00327"></a>00327         }
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa121d55f2ca09c06a96ddcd433c60b0f"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_setAmps" ref="aa121d55f2ca09c06a96ddcd433c60b0f" args="(Qureg qureg, long long int startInd, qreal *reals, qreal *imags, long long int numAmps)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_setAmps </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>startInd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>reals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal *&nbsp;</td>
          <td class="paramname"> <em>imags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>numAmps</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00033">33</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00131">initStateFromAmps()</a>, and <a class="el" href="QuEST_8c_source.html#l00139">setAmps()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00033"></a>00033                                                                                                               {
<a name="l00034"></a>00034     
<a name="l00035"></a>00035     cudaDeviceSynchronize();
<a name="l00036"></a>00036     cudaMemcpy(
<a name="l00037"></a>00037         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real + startInd, 
<a name="l00038"></a>00038         reals,
<a name="l00039"></a>00039         numAmps * <span class="keyword">sizeof</span>(*(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real)), 
<a name="l00040"></a>00040         cudaMemcpyHostToDevice);
<a name="l00041"></a>00041     cudaMemcpy(
<a name="l00042"></a>00042         qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag + startInd,
<a name="l00043"></a>00043         imags,
<a name="l00044"></a>00044         numAmps * <span class="keyword">sizeof</span>(*(qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real)), 
<a name="l00045"></a>00045         cudaMemcpyHostToDevice);
<a name="l00046"></a>00046 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4bea7ed7967083cbabd8a8e5acdd48c0"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_unitary" ref="a4bea7ed7967083cbabd8a8e5acdd48c0" args="(Qureg qureg, const int targetQubit, ComplexMatrix2 u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statevec_unitary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a>&nbsp;</td>
          <td class="paramname"> <em>u</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00713">713</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, and <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST_8c_source.html#l00240">unitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00714"></a>00714 {
<a name="l00715"></a>00715     <span class="keywordtype">int</span> threadsPerCUDABlock, CUDABlocks;
<a name="l00716"></a>00716     threadsPerCUDABlock = 128;
<a name="l00717"></a>00717     CUDABlocks = ceil((<a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>)(qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1)/threadsPerCUDABlock);
<a name="l00718"></a>00718     statevec_unitaryKernel&lt;&lt;&lt;CUDABlocks, threadsPerCUDABlock&gt;&gt;&gt;(qureg, targetQubit, u);
<a name="l00719"></a>00719 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a839403bc90931dac70995f4887c05fd8"></a><!-- doxytag: member="QuEST_gpu.cu::statevec_unitaryKernel" ref="a839403bc90931dac70995f4887c05fd8" args="(Qureg qureg, const int targetQubit, ComplexMatrix2 u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void statevec_unitaryKernel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQureg.html">Qureg</a>&nbsp;</td>
          <td class="paramname"> <em>qureg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a>&nbsp;</td>
          <td class="paramname"> <em>u</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>fix -- no necessary for GPU version </p>
</p>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00660">660</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST_8h_source.html#l00105">Qureg::deviceStateVec</a>, <a class="el" href="QuEST_8h_source.html#l00060">Complex::imag</a>, <a class="el" href="QuEST_8h_source.html#l00091">Qureg::numAmpsPerChunk</a>, <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>, <a class="el" href="QuEST_8h_source.html#l00067">ComplexMatrix2::r0c0</a>, <a class="el" href="QuEST_8h_source.html#l00067">ComplexMatrix2::r0c1</a>, <a class="el" href="QuEST_8h_source.html#l00068">ComplexMatrix2::r1c0</a>, <a class="el" href="QuEST_8h_source.html#l00068">ComplexMatrix2::r1c1</a>, and <a class="el" href="QuEST_8h_source.html#l00059">Complex::real</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00660"></a>00660                                                                                             {
<a name="l00661"></a>00661     <span class="comment">// ----- sizes</span>
<a name="l00662"></a>00662     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock,                                           <span class="comment">// size of blocks</span>
<a name="l00663"></a>00663          sizeHalfBlock;                                       <span class="comment">// size of blocks halved</span>
<a name="l00664"></a>00664     <span class="comment">// ----- indices</span>
<a name="l00665"></a>00665     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisBlock,                                           <span class="comment">// current block</span>
<a name="l00666"></a>00666          indexUp,indexLo;                                     <span class="comment">// current index and corresponding index in lower half block</span>
<a name="l00667"></a>00667 
<a name="l00668"></a>00668     <span class="comment">// ----- temp variables</span>
<a name="l00669"></a>00669     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a>   stateRealUp,stateRealLo,                             <span class="comment">// storage for previous state values</span>
<a name="l00670"></a>00670            stateImagUp,stateImagLo;                             <span class="comment">// (used in updates)</span>
<a name="l00671"></a>00671     <span class="comment">// ----- temp variables</span>
<a name="l00672"></a>00672     <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> thisTask;                                   <span class="comment">// task based approach for expose loop with small granularity</span>
<a name="l00673"></a>00673     <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numTasks=qureg.<a class="code" href="structQureg.html#ab0ea0358482b62f43fdd781469607d97" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmpsPerChunk</a>&gt;&gt;1;
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     sizeHalfBlock = 1LL &lt;&lt; targetQubit;                               <span class="comment">// size of blocks halved</span>
<a name="l00676"></a>00676     sizeBlock     = 2LL * sizeHalfBlock;                           <span class="comment">// size of blocks</span>
<a name="l00677"></a>00677 
<a name="l00678"></a>00678     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l00679"></a>00679     <span class="comment">//            rotate                                                //</span>
<a name="l00680"></a>00680     <span class="comment">// ---------------------------------------------------------------- //</span>
<a name="l00681"></a>00681 
<a name="l00683"></a>00683     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecReal = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.real;
<a name="l00684"></a>00684     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *stateVecImag = qureg.<a class="code" href="structQureg.html#ac181d7b3b94fff179dc74d7935ecd9e1" title="Storage for wavefunction amplitudes in the GPU version.">deviceStateVec</a>.imag;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686     thisTask = blockIdx.x*blockDim.x + threadIdx.x;
<a name="l00687"></a>00687     <span class="keywordflow">if</span> (thisTask&gt;=numTasks) <span class="keywordflow">return</span>;
<a name="l00688"></a>00688 
<a name="l00689"></a>00689     thisBlock   = thisTask / sizeHalfBlock;
<a name="l00690"></a>00690     indexUp     = thisBlock*sizeBlock + thisTask%sizeHalfBlock;
<a name="l00691"></a>00691     indexLo     = indexUp + sizeHalfBlock;
<a name="l00692"></a>00692 
<a name="l00693"></a>00693     <span class="comment">// store current state vector values in temp variables</span>
<a name="l00694"></a>00694     stateRealUp = stateVecReal[indexUp];
<a name="l00695"></a>00695     stateImagUp = stateVecImag[indexUp];
<a name="l00696"></a>00696 
<a name="l00697"></a>00697     stateRealLo = stateVecReal[indexLo];
<a name="l00698"></a>00698     stateImagLo = stateVecImag[indexLo];
<a name="l00699"></a>00699 
<a name="l00700"></a>00700     <span class="comment">// state[indexUp] = u00 * state[indexUp] + u01 * state[indexLo]</span>
<a name="l00701"></a>00701     stateVecReal[indexUp] = u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateRealUp - u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateImagUp 
<a name="l00702"></a>00702         + u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateRealLo - u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateImagLo;
<a name="l00703"></a>00703     stateVecImag[indexUp] = u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateImagUp + u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateRealUp 
<a name="l00704"></a>00704         + u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateImagLo + u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateRealLo;
<a name="l00705"></a>00705 
<a name="l00706"></a>00706     <span class="comment">// state[indexLo] = u10  * state[indexUp] + u11 * state[indexLo]</span>
<a name="l00707"></a>00707     stateVecReal[indexLo] = u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateRealUp  - u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateImagUp 
<a name="l00708"></a>00708         + u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateRealLo  -  u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateImagLo;
<a name="l00709"></a>00709     stateVecImag[indexLo] = u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateImagUp + u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateRealUp 
<a name="l00710"></a>00710         + u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>.<a class="code" href="structComplex.html#ab5b2e2eca02131fc74b289a83636cbe3">real</a>*stateImagLo + u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>.<a class="code" href="structComplex.html#a84f5439aad0ef495efdd3b4c1c02d27e">imag</a>*stateRealLo;
<a name="l00711"></a>00711 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a31772904f024efd8d75a022e84c8207b"></a><!-- doxytag: member="QuEST_gpu.cu::swapDouble" ref="a31772904f024efd8d75a022e84c8207b" args="(qreal **a, qreal **b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void swapDouble </td>
          <td>(</td>
          <td class="paramtype">qreal **&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qreal **&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l01459">1459</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>References <a class="el" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6">qreal</a>.</p>

<p>Referenced by <a class="el" href="QuEST__gpu_8cu_source.html#l01727">densmatr_calcFidelity()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01797">densmatr_calcPurity()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01466">densmatr_findProbabilityOfZero()</a>, <a class="el" href="QuEST__gpu_8cu_source.html#l01600">statevec_calcInnerProduct()</a>, and <a class="el" href="QuEST__gpu_8cu_source.html#l01514">statevec_findProbabilityOfZero()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01459"></a>01459                                      {
<a name="l01460"></a>01460     <a class="code" href="QuEST__precision_8h.html#a7740e349b4f8bae6451547680f0ce2d6" title="A precision-agnostic floating point number, as determined by QuEST_PREC.">qreal</a> *temp;
<a name="l01461"></a>01461     temp = *a;
<a name="l01462"></a>01462     *a = *b;
<a name="l01463"></a>01463     *b = temp;
<a name="l01464"></a>01464 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8d31fe2d1ad4d01e2a1f5f6b8bc15b77"></a><!-- doxytag: member="QuEST_gpu.cu::syncQuESTEnv" ref="a8d31fe2d1ad4d01e2a1f5f6b8bc15b77" args="(QuESTEnv env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void syncQuESTEnv </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td>
          <td class="paramname"> <em>env</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Guarantees that all code up to the given point has been executed on all nodes (if running in distributed mode). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>object representing the execution environment. A single instance is used for each program </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00249">249</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p>Referenced by <a class="el" href="QuEST__cpu_8c_source.html#l01355">statevec_initStateFromSingleFile()</a>, and <a class="el" href="QuEST__cpu_8c_source.html#l01100">statevec_reportStateToScreen()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00249"></a>00249                                {
<a name="l00250"></a>00250     cudaDeviceSynchronize();
<a name="l00251"></a>00251 } 
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac7e38d768a1bd79019f88cc1e6295092"></a><!-- doxytag: member="QuEST_gpu.cu::syncQuESTSuccess" ref="ac7e38d768a1bd79019f88cc1e6295092" args="(int successCode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int syncQuESTSuccess </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>successCode</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Performs a logical AND on all successCodes held by all processes. </p>
<p>If any one process has a zero successCode all processes will return a zero success code.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>successCode</em>&nbsp;</td><td>1 if process task succeeded, 0 if process task failed </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 if all processes succeeded, 0 if any one process failed </dd></dl>

<p>Definition at line <a class="el" href="QuEST__gpu_8cu_source.html#l00253">253</a> of file <a class="el" href="QuEST__gpu_8cu_source.html">QuEST_gpu.cu</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00253"></a>00253                                      {
<a name="l00254"></a>00254     <span class="keywordflow">return</span> successCode;
<a name="l00255"></a>00255 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 11 Jan 2019 for Quantum Exact Simulation Toolkit by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
